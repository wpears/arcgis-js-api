//>>built
define("dgrid/tree","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/has dojo/query dojo/on dojo/aspect ./Grid dojo/has!touch?./util/touch put-selector/put".split(" "),function(B,w,x,p,y,t,z,l,A,u,m){p.getObject("dgrid.tree",!0);return dgrid.tree=function(c){var p=c.renderCell||A.defaultRenderCell,v,e;c||(c={});c.shouldExpand=c.shouldExpand||function(b,c,d){return d};l.after(c,"init",function(){var b=c.grid,n=".dgrid-content .dgrid-column-"+c.id,d,g=[];if(!b.store)throw Error("dgrid tree column plugin requires a store to operate.");
c.renderExpando||(c.renderExpando=function(a,b,c){var h=this.grid.isRTL?"right":"left",d=".dgrid-expando-icon";b&&(d+=".ui-icon.ui-icon-triangle-1-"+(c?"se":"e"));a=m("div"+d+"[style\x3dmargin-"+h+": "+a*(this.indentWidth||9)+"px; float: "+h+"]");a.innerHTML="\x26nbsp;";return a});g.push(b.on(c.expandOn||".dgrid-expando-icon:click,"+n+":dblclick,"+n+":keydown",function(a){var f=b.row(a);(!b.store.mayHaveChildren||b.store.mayHaveChildren(f.data))&&(("keydown"!=a.type||32==a.keyCode)&&!("dblclick"==
a.type&&e&&1<e.count&&f.id==e.id&&-1<a.target.className.indexOf("dgrid-expando-icon")))&&b.expand(f);-1<a.target.className.indexOf("dgrid-expando-icon")&&(e&&e.id==b.row(a).id?e.count++:e={id:b.row(a).id,count:1})}));y("touch")&&g.push(b.on(u.selector(n,u.dbltap),function(){b.expand(this)}));b._expanded||(b._expanded={});g.push(l.after(b,"insertRow",function(a){var b=this.row(a);c.shouldExpand(b,v,this._expanded[b.id])&&this.expand(a,!0,!0);return a}));g.push(l.before(b,"removeRow",function(a,c){var d=
a.connected;d&&(t("\x3e.dgrid-row",d).forEach(function(a){b.removeRow(a,!0)}),c||m(d,"!"))}));c.collapseOnRefresh&&g.push(l.after(b,"cleanup",function(){this._expanded={}}));b._calcRowHeight=function(a){var b=a.connected;return a.offsetHeight+(b?b.offsetHeight:0)};b.expand=function(a,f,g){var h=a.element?a:b.row(a);a=h.element;if((a=-1<a.className.indexOf("dgrid-expando-icon")?a:t(".dgrid-expando-icon",a)[0])&&a.mayHaveChildren){var e=void 0===f?!this._expanded[h.id]:f;a.className="dgrid-expando-icon ui-icon ui-icon-triangle-1-"+
(e?"se":"e");var l=a.preloadNode;f=h.element;var k,n;if(!l){k=f.connected=m("div.dgrid-tree-container");var l=a.preloadNode=m(f,"+",k,"div.dgrid-preload"),r=function(a){return b.store.getChildren(h.data,a)};r.level=a.level;c.allowDuplicates&&(n={parentId:h.id});x.when(b.renderQuery?b._trackError(function(){return b.renderQuery(r,l,n)}):b.renderArray(r(n),l,{query:r}),function(){if(b._expanded[h.id]){var a=k.scrollHeight;k.style.height=a?a+"px":"auto"}});var p=function(a){var b=this.style.height;b&&
(this.style.display="0px"==b?"none":"block");a?(m(this,".dgrid-tree-resetting"),setTimeout(function(){m(k,"!dgrid-tree-resetting")}),d=!0):d||(d=!1);this.style.height=""};z(k,"transitionend,webkitTransitionEnd,oTransitionEnd,MSTransitionEnd",p);d||setTimeout(function(){p.call(k)},600)}k=f.connected;k.hidden=!e;var q=k.style,s;!1===d||g?(q.display=e?"block":"none",q.height=""):(e?(q.display="block",s=k.scrollHeight,q.height="0px"):(m(k,".dgrid-tree-resetting"),q.height=k.scrollHeight+"px"),setTimeout(function(){m(k,
"!dgrid-tree-resetting");q.height=e?s?s+"px":"auto":"0px"}));e?this._expanded[h.id]=!0:delete this._expanded[h.id]}};l.after(c,"destroy",function(){w.forEach(g,function(a){a.remove()});delete b.expand;delete b._calcRowHeight})});c.renderCell=function(b,e,d,g){var a=c.grid,f=Number(g&&g.query&&g.query.level)+1,l=!a.store.mayHaveChildren||a.store.mayHaveChildren(b),h=g.parentId,f=v=isNaN(f)?0:f,a=c.renderExpando(f,l,a._expanded[(h?h+"-":"")+a.store.getIdentity(b)]);a.level=f;a.mayHaveChildren=l;(b=
p.call(c,b,e,d,g))&&b.nodeType?(m(d,a),m(d,b)):d.insertBefore(a,d.firstChild)};return c}});