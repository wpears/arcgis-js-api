/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/request esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/ImageServiceIdentifyResult".split(" "),function(l,d,n,h,s,m,f,c){l=l(f,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=d.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(a,e,v,u,
p){try{var k=new c(a);this._successHandler([k],"onComplete",v,p)}catch(g){this._errorHandler(g,u,p)}},execute:function(a,c,v,u){var p=u.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json"},a.toJson(p&&p[0])));var k=this._handler,g=this._errorHandler;return s({url:this._url.path,content:a,callbackParamName:"callback",load:function(b,a){k(b,a,c,v,u.dfd)},error:function(b){g(b,v,u.dfd)}})},onComplete:function(){}});m._createWrappers(l);n("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyTask",
l,h);return l})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/geometry/Point esri/tasks/query esri/layers/RenderMode esri/layers/GridLayout".split(" "),function(l,d,n,h,s,m,f,c,a,e){l=l([a],{declaredClass:"esri.layers._OnDemandMode",constructor:function(a){this.featureLayer=a;this._featureMap={};this._queryErrorHandler=n.hitch(this,this._queryErrorHandler)},initialize:function(a){this.inherited(arguments);
var c=this.featureLayer,p=c._srInfo;this._gridLayer=new e(new f(p?p.valid[0]:a.extent.xmin,a.extent.ymax,a.spatialReference),{width:c._tileWidth,height:c._tileHeight},{width:a.width,height:a.height},p);this._cellMap={};this._gridLayer.setResolution(a.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(a){this._init&&(2>a?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(a){var c=this._gridLayer,e=a.geometry,k=[];if(e)for(var k=c.getCellsInExtent("point"===e.type?{xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y}:e.getExtent(),!1).cells,c=this._cellMap,g,b=a.attributes[this.featureLayer.objectIdField],r,t,d,e=0;e<k.length;e++)g=k[e],r=g.latticeID,t=g.row,d=g.col,r?g=c[r]=c[r]||g:(c[t]=c[t]||{},g=c[t][d]=c[t][d]||g),g.features=
g.features||[],g.features.push(a),this._addFeatureIIf(b,a),this._incRefCount(b)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},_enableConnectors:function(){var a=this.map;this._zoomConnect=d.connect(a,"onZoomEnd",this,this._zoomHandler);this._panConnect=d.connect(a,"onPanEnd",this,this._panHandler);this._resizeConnect=d.connect(a,"onResize",this,this._panHandler)},_disableConnectors:function(){d.disconnect(this._zoomConnect);
d.disconnect(this._panConnect);d.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var a=this.featureLayer,c=this.map;a.suspended||(a._fireUpdateStart(),this._clearIIf(),(a=a._trackManager)&&a.clearTracks(),this._cellMap={},this._gridLayer.setResolution(c.extent),this._sendRequest())},_panHandler:function(a){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&a)},_getRequestId:function(a,c){return("_"+a.name+a.layerId+a._ulid+"_"+c.resolution+
"_"+(c.latticeID||c.row+"_"+c.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(a){this._exceeds=!1;var e=this.featureLayer,p=this.map;a=a||p.extent;p=this._gridLayer.getCellsInExtent(a,e.latticeTiling).cells;if(!e.isEditable())var k=this._cellMap,p=h.filter(p,function(b){if(b.lattice){if(k[b.latticeID])return!1}else if(k[b.row]&&k[b.row][b.col])return!1;return!0});var g=e.getOutFields(),b=e.getDefinitionExpression(),r=e._getOffsettedTE(e._mapTimeExtent),t=e.supportsAdvancedQueries?e.orderByFields:
null,d=e._usePatch,f=this._ioQueue,z,m=this,w=this._drawFeatures,A,y,C;this._pending=this._pending||0;for(z=0;z<p.length;z++){A=p[z];y=new c;y.geometry=A.extent||A.lattice;y.outFields=g;y.where=b;e.latticeTiling&&A.extent&&(y.spatialRelationship=c.SPATIAL_REL_CONTAINS);y.returnGeometry=!0;y.timeExtent=r;y.maxAllowableOffset=e._maxOffset;e._ts&&(y._ts=(new Date).getTime());y.orderByFields=t;C=null;if(d&&(C=this._getRequestId(e,A),this._isPending(C)))continue;this._pending++;f.push(e._task.execute(y,
function(){var b=A;return function(a){w.apply(m,[a,b])}}.call(this),this._queryErrorHandler,C))}this._removeOldCells(a);this._endCheck()},_drawFeatures:function(a,c){this._exceeds=this._exceeds||a.exceededTransferLimit;this._finalizeIO();var e=this.map.extent,k=c.extent,g=c.row,b=c.col,r=this.featureLayer.objectIdField,t=a.features,d=this._gridLayer,f=this._cellMap,z=c.latticeID,h=z?f[z]:f[g]&&f[g][b];if(c.resolution!=d._resolution||(z?z!==d.getLatticeID(e):!d.intersects(k,e)))h&&this._removeCell(g,
b,z);else if(h)this._updateCell(h,t);else{c.features=t;z?f[z]=c:(f[g]=f[g]||{},f[g][b]=c);k=t.length;for(e=0;e<k;e++)g=t[e],b=g.attributes[r],this._addFeatureIIf(b,g),this._incRefCount(b)}this._endCheck()},_queryErrorHandler:function(a){this._finalizeIO();this.featureLayer._errorHandler(a);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(a){if(0===this._pending){this._processIOQueue();var c=this.featureLayer,e=c._trackManager;e&&(e.clearTracks(),
e.addFeatures(c.graphics),c._ager&&h.forEach(c.graphics,function(a){a._shape&&c._repaint(a)}),e.moveLatestToFront(),e.drawTracks());this.featureLayer._fireUpdateEnd(a&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)c.onQueryLimitExceeded()}},_processIOQueue:function(a){this._ioQueue=h.filter(this._ioQueue,function(a){return-1<a.fired?!1:!0});a&&h.forEach(this._ioQueue,this._cancelPendingRequest)},_removeOldCells:function(a){var c=
this._cellMap,e=this._gridLayer,k,g;for(k in c)if(c[k]){var b=c[k],r=b.latticeID,d=0,q=0;if(r)d++,r!==e.getLatticeID(a)&&(this._removeCell(null,null,r),q++);else for(g in b)b[g]&&(d++,e.intersects(b[g].extent,a)||(this._removeCell(k,g),q++));q===d&&delete c[k]}},_updateCell:function(a,c){var e=this.featureLayer,k=e.objectIdField,e=e._selectedFeatures,g,b=c.length;a.features=a.features||[];for(g=0;g<b;g++){var r=c[g],d=r.attributes[k],q=this._addFeatureIIf(d,r);q===r?(this._incRefCount(d),a.features.push(q)):
d in e||(q.setGeometry(r.geometry),q.setAttributes(r.attributes))}},_removeCell:function(a,c,e){var k=this._cellMap,g=this.featureLayer,b=g.objectIdField,r=e?k[e]:k[a]&&k[a][c];if(r){e?delete k[e]:delete k[a][c];a=r.features;for(c=0;c<a.length;c++)e=a[c].attributes[b],this._decRefCount(e),e in g._selectedFeatures||this._removeFeatureIIf(e)}}});s("extend-esri")&&n.setObject("layers._OnDemandMode",l,m);return l})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on esri/Evented dijit/_WidgetBase".split(" "),
function(l,d,n,h,s,m){return l([m,s],{_onMap:function(d){var c=this.constructor._onMap,a;if(!c||!c.FINAL)delete this.constructor._onMap,c=this.registerConnectEvents(),c.FINAL=!0;d=d.toLowerCase();c[d]?a=this[c[d].method]:(d=this._onCamelCase(d),this[d]&&(a=d));return a},on:function(d,c){var a=this._onMap(d),e=d.replace(/\-/g,""),v="on"+e in this.domNode;return a||!v?this.inherited(arguments):this.own(h(this.domNode,e,c))[0]},emit:function(f,c,a){var e,v,u,p=f.toLowerCase(),k=this.constructor._onMap||
this.registerConnectEvents();v=this[this._onMap(p)];c=c||{};c.target||(c.target=this);v&&(k&&k[p])&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},k[p].argKeys)(c),u=d.mixin({},arguments),u[2]=e,u[0]=k[p].name.replace(/^on/,""));return this.inherited(u||arguments)}})})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(l,d,n,h,s,m,f){var c={_isElementShown:function(a){var c=h.get(a);return"hidden"!=
c.visibility&&"collapsed"!=c.visibility&&"none"!=c.display&&"hidden"!=n.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return n.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var c;try{var d=a.contentDocument;if("designMode"in d&&"on"==d.designMode)return!0;c=d.body}catch(f){try{c=a.contentWindow.document.body}catch(p){return!1}}return c&&("true"==c.contentEditable||c.firstChild&&"true"==
c.firstChild.contentEditable);default:return"true"==a.contentEditable}},isTabNavigable:function(a){return n.get(a,"disabled")?!1:n.has(a,"tabIndex")?0<=n.get(a,"tabIndex"):c.hasDefaultTabStop(a)},_getTabNavigable:function(a){function e(b){return b&&"input"==b.tagName.toLowerCase()&&b.type&&"radio"==b.type.toLowerCase()&&b.name&&b.name.toLowerCase()}var d,f,p,k,g,b,r={},t=c._isElementShown,q=c.isTabNavigable,x=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=m("ie")&&"HTML"!==
a.scopeName||!t(a))){if(q(a)){var c=+n.get(a,"tabIndex");if(!n.has(a,"tabIndex")||0==c)d||(d=a),f=a;else if(0<c){if(!p||c<k)k=c,p=a;if(!g||c>=b)b=c,g=a}c=e(a);n.get(a,"checked")&&c&&(r[c]=a)}"SELECT"!=a.nodeName.toUpperCase()&&x(a)}};t(a)&&x(a);return{first:r[e(d)]||d,last:r[e(f)]||f,lowest:r[e(p)]||p,highest:r[e(g)]||g}},getFirstInTabbingOrder:function(a,e){var f=c._getTabNavigable(d.byId(a,e));return f.lowest?f.lowest:f.first},getLastInTabbingOrder:function(a,e){var f=c._getTabNavigable(d.byId(a,
e));return f.last?f.last:f.highest}};s.mixin(f,c);return c})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has esri/kernel esri/SpatialReference esri/geometry/Extent esri/geometry/webMercatorUtils esri/renderers/SimpleRenderer esri/layers/layer esri/layers/FeatureLayer esri/dijit/PopupTemplate".split(" "),function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g){l=l([p],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(b,c){this.pointSymbol=c&&c.pointSymbol;this.polylineSymbol=c&&c.polylineSymbol;this.polygonSymbol=c&&c.polygonSymbol;this._outSR=c&&(c.outSpatialReference||c.outSR)||new a({wkid:4326});this._options=c},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var b=[];this._fLayers&&(b=b.concat(this._fLayers));return b},onRefresh:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._createLayer()},
_createLayer:function(b){var a=this;this._fireUpdateStart();b=this.parse(b);b.addCallback(function(b){a._io=null;a._initLayer(b)});b.addErrback(function(b){a._io=null;b=n.mixin(Error(),b);b.message="Unable to load resource: "+a.url+" "+(b.message||"");a._fireUpdateEnd(b);a.onError(b)})},_initLayer:function(b){this.loaded&&this._removeInternalLayers();this.name=b.name;this.description=b.description;this.snippet=b.snippet;this.defaultVisibility=void 0!==b.visibility?this.visible=!!b.visibility:this.visible=
!0;this.featureInfos=b.featureInfos;this.fullExtent=this.initialExtent=new e(b.lookAtExtent);this.copyright=b.author||b.copyright;var a;if((b=n.getObject("featureCollection.layers",!1,b))&&0<b.length)this._fLayers=[],h.forEach(b,function(b,c){var e=n.getObject("featureSet.features",!1,b);e&&0<e.length&&(a=n.mixin({outFields:["*"],infoTemplate:b.popupInfo?new g(b.popupInfo):null,editable:!1},this._options),a.id&&(a.id=a.id+"_"+c),b.layerDefinition.capabilities="Query,Data",e=new k(b,a),e.geometryType&&
(this["_"+e.geometryType]=e),this._fLayers.push(e))},this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(b=new u(this.pointSymbol),this._esriGeometryPoint.setRenderer(b)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(b=new u(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(b)));this._esriGeometryPolygon&&
(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(b=new u(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(b)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var b=this._map;this._fireUpdateStart();var a=b.spatialReference,c=this._outSR,g;if(a.wkid)g=a._isWebMercator()&&c._isWebMercator()||a.wkid===c.wkid;else if(a.wkt)g=a.wkt===c.wkt;else{console.log("_setMap - map has invalid spatial reference");
return}if(!g)if(a._isWebMercator()&&4326===c.wkid)this._converter=v.geographicToWebMercator;else if(c._isWebMercator()&&4326===a.wkid)this._converter=v.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(a=this._fLayers)&&0<a.length&&h.forEach(a,function(a){if(this._converter){var c=a.graphics,g,e,r=c?c.length:0;for(g=0;g<r;g++)(e=c[g].geometry)&&c[g].setGeometry(this._converter(e))}b.addLayer(a)},
this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var b=this._map;b&&h.forEach(this.getFeatureLayers(),b.removeLayer,b)},onVisibilityChange:function(b){this._fireUpdateStart();h.forEach(this.getFeatureLayers(),function(a){a.setVisibility(b)});this._fireUpdateEnd()},_setMap:function(b,a){this.inherited(arguments);this._map=b;var c=this._div=s.create("div",null,a);m.set(c,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return c},
_unsetMap:function(b,a){this._io&&this._io.cancel();d.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var c=this._div;c&&(a.removeChild(c),s.destroy(c));this._div=null;this.inherited(arguments)}});f("extend-esri")&&n.setObject("layers._ServiceGeneratedFeatureCollection",l,c);return l})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/config esri/request esri/layers/ServiceGeneratedFeatureCollection".split(" "),
function(l,d,n,h,s,m,f,c){l=l([c],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(a,c){m.defaults.geoRSSService&&(this.serviceUrl=m.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=f({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?n.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(a){this.inherited(arguments);
this.loaded||(this.loaded=!0,this.onLoad(this))}});h("extend-esri")&&d.setObject("layers.GeoRSSLayer",l,s);return l})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has esri/kernel esri/lang dojo/i18n!dojo/cldr/nls/number".split(" "),function(l,d,n,h,s,m,f,c){l=l(null,{declaredClass:"esri.PopupInfo",initialize:function(a,c){if(a){d.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;var f=this._fieldLabels=
{},u=this._fieldsMap={};a.fieldInfos&&n.forEach(a.fieldInfos,function(a){f[a.fieldName]=a.label;u[a.fieldName]=a})}},toJson:function(){return h.fromJson(h.toJson(this.info))},getTitle:function(){},getContent:function(){},getComponents:function(a){var e=this.info,f=a.getLayer(),u=d.clone(a.attributes)||{},p=d.clone(u),k=e.fieldInfos,g="",b="",r,t,q,h=f&&f._getDateOpts&&f._getDateOpts().properties,z={dateFormat:{properties:h,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
k&&n.forEach(k,function(b){var a=b.fieldName;p[a]=this._formatValue(p[a],a,z);h&&(b.format&&b.format.dateFormat)&&(b=n.indexOf(h,a),-1<b&&h.splice(b,1))},this);if(f){var m=f.types,w=f.typeIdField,A=w&&u[w];for(t in u)if(q=u[t],c.isDefined(q)){var y=this._getDomainName(f,m,A,t,q);c.isDefined(y)?p[t]=y:t===w&&(y=this._getTypeName(f,q),c.isDefined(y)&&(p[t]=y))}}e.title&&(g=d.trim(c.substitute(p,this._fixTokens(e.title),z)||""));e.description&&(b=d.trim(c.substitute(p,this._fixTokens(e.description),
z)||""));k&&(r=[],n.forEach(k,function(b){(t=b.fieldName)&&b.visible&&r.push([b.label||t,c.substitute(p,"${"+t+"}",z)||""])}));var C,L;e.mediaInfos&&(C=[],n.forEach(e.mediaInfos,function(b){L=0;q=b.value;switch(b.type){case "image":var a=q.sourceURL,a=a&&d.trim(c.substitute(u,this._fixTokens(a)));L=!!a;break;case "piechart":case "linechart":case "columnchart":case "barchart":L=n.some(q.fields,function(b){return c.isDefined(u[b])});break;default:return}if(L){b=d.clone(b);q=b.value;b.title=b.title?
d.trim(c.substitute(p,this._fixTokens(b.title),z)||""):"";b.caption=b.caption?d.trim(c.substitute(p,this._fixTokens(b.caption),z)||""):"";if("image"===b.type)q.sourceURL=c.substitute(u,this._fixTokens(q.sourceURL)),q.linkURL&&(q.linkURL=d.trim(c.substitute(u,this._fixTokens(q.linkURL))||""));else{var g=u[q.normalizeField]||0;q.fields=n.map(q.fields,function(b){var a=u[b];(a=void 0===a?null:a)&&g&&(a/=g);return{y:a,tooltip:(this._fieldLabels[b]||b)+":\x3cbr/\x3e"+this._formatValue(a,b,z,!!g)}},this)}C.push(b)}},
this));return{title:g,description:b,fields:r&&r.length?r:null,mediaInfos:C&&C.length?C:null,formatted:p,editSummary:f&&f.getEditSummary?f.getEditSummary(a):""}},getAttachments:function(a){var c=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(c&&c.hasAttachments&&c.objectIdField)&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_fixTokens:function(a){return a.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_formatValue:function(a,e,d,f){var p=this._fieldsMap[e];e=p&&p.format;if(!c.isDefined(a)||!p||!c.isDefined(e))return a;var k="",g=[],p=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),b=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(p)k="NumberFormat",g.push("places: "+(c.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),g.length&&(k+="("+g.join(",")+
")");else if(e.dateFormat)k="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return a;a=c.substitute({myKey:a},"${myKey:"+k+"}",d)||"";p&&!b&&(d=s.getLocalization("dojo.cldr","number"),d.group&&(a=a.replace(RegExp("\\"+d.group,"g"),"")));return a},_insertOffset:function(a){a&&(a=c.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,e,d,f,p){var k,g;e&&c.isDefined(d)&&n.some(e,
function(b){if(b.id==d){if((k=b.domains&&b.domains[f])&&"inherited"===k.type)k=this._getLayerDomain(a,f),g=!0;return!0}return!1},this);!g&&!k&&(k=this._getLayerDomain(a,f));if(k&&k.codedValues){var b;n.some(k.codedValues,function(a){return a.code==p?(b=a.name,!0):!1});return b}},_getLayerDomain:function(a,c){var d=a.fields;if(d){var f;n.some(d,function(a){return a.name===c?(f=a.domain,!0):!1});return f}},_getTypeName:function(a,c){var d=a.types;if(d){var f;n.some(d,function(a){return a.id==c?(f=a.name,
!0):!1});return f}}});m("extend-esri")&&(f.PopupInfo=f.PopupInfoTemplate=l);return l})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style esri/kernel esri/config esri/lang esri/request esri/SpatialReference esri/geometry/webMercatorUtils esri/dijit/PopupTemplate esri/layers/layer esri/layers/KMLFolder esri/layers/KMLGroundOverlay esri/layers/MapImageLayer esri/layers/FeatureLayer".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r,t,q,x,z,B){var w=d([t],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(b,a){b||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=a&&a.outSR||new g({wkid:4326});this._options=a;u.defaults.kmlService&&(this.serviceUrl=u.defaults.kmlService);var c=this.linkInfo=a&&a.linkInfo;c&&(this.visible=!!c.visibility,this._waitingForMap=!!c.viewFormat);(!c||c&&
c.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=h.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(b){if(b){var a=b.type,c=b.id,g;switch(a){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(b=this["_"+a])&&(g=h.getObject("_mode._featureMap."+c,!1,b));break;case "GroundOverlay":if(b=this._groundLyr){var e=b.getImages(),a=e.length;for(b=0;b<a;b++)if(e[b].id===c){g=e[b];break}}break;case "ScreenOverlay":break;
case "NetworkLink":s.some(this._links,function(b){return b.linkInfo&&b.linkInfo.id===c?(g=b,!0):!1});break;case "Folder":a=(e=this.folders)?e.length:0;for(b=0;b<a;b++)if(e[b].id===c){g=e[b];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return g}},getLayers:function(){var b=[];this._groundLyr&&b.push(this._groundLyr);this._fLayers&&(b=b.concat(this._fLayers));this._links&&s.forEach(this._links,function(a){a.declaredClass&&b.push(a)});return b},setFolderVisibility:function(b,
a){b&&(this._fireUpdateStart(),(b.visible=a)&&(a=this._areLocalAncestorsVisible(b)),this._setState(b,a),this._fireUpdateEnd())},onRefresh:function(){},_parseKml:function(b){var a=this;this._fireUpdateStart();this._io=k({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(b),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:m.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(b){a._io=null;a._initLayer(b)},error:function(b){a._io=null;b=h.mixin(Error(),
b);b.message="Unable to load KML: "+a.url+" "+(b.message||"");a._fireUpdateEnd(b);a.onError(b)}})},_initLayer:function(b){this.loaded&&this._removeInternalLayers();this.name=b.name;this.description=b.description;this.snippet=b.snippet;this.visibility=b.visibility;this.featureInfos=b.featureInfos;var a,c,g=this.folders=b.folders,e=[],d;if(g){c=g.length;for(a=0;a<c;a++)d=g[a]=new q(g[a]),-1===d.parentFolderId&&e.push(d)}var g=this._links=b.networkLinks,k;c=g?g.length:0;for(a=0;a<c;a++)g[a].viewRefreshMode&&
-1!==g[a].viewRefreshMode.toLowerCase().indexOf("onregion")||(k=h.mixin({},this._options),k.linkInfo=g[a],k.id&&(k.id=k.id+"_"+a),g[a]=new w(g[a].href,k),g[a]._parentLayer=this,g[a]._parentFolderId=this._getLinkParentId(g[a].linkInfo.id));if((g=b.groundOverlays)&&0<g.length){k=h.mixin({},this._options);k.id&&(k.id+="_mapImage");d=this._groundLyr=new z(k);c=g.length;for(a=0;a<c;a++)d.addImage(new x(g[a]))}if((b=h.getObject("featureCollection.layers",!1,b))&&0<b.length)this._fLayers=[],s.forEach(b,
function(b,a){var c=h.getObject("featureSet.features",!1,b);c&&0<c.length&&(k=h.mixin({outFields:["*"],infoTemplate:b.popupInfo?new r(b.popupInfo):null,editable:!1},this._options),k.id&&(k.id=k.id+"_"+a),b.layerDefinition.capabilities="Query,Data",c=new B(b,k),c.geometryType&&(this["_"+c.geometryType]=c),this._fLayers.push(c))},this),0===this._fLayers.length&&delete this._fLayers;c=e.length;for(a=0;a<c;a++)d=e[a],this._setState(d,d.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),
this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();this._links&&s.forEach(this._links,function(b){b.declaredClass&&(a.addLayer(b),b._waitingForMap&&(b._waitingForMap=null,b.visible?b._parseKml(a):b._wMap=a))});var c=a.spatialReference,g=this._outSR,e;if(!c.equals(g))if(c.isWebMercator()&&4326===g.wkid)e=b.geographicToWebMercator;else if(g.isWebMercator()&&4326===c.wkid)e=b.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");
return}this._groundLyr&&(e&&s.forEach(this._groundLyr.getImages(),function(b){b.extent=e(b.extent)}),a.addLayer(this._groundLyr));(c=this._fLayers)&&0<c.length&&s.forEach(c,function(b){if(e){var c=b.graphics,g,d,r=c?c.length:0;for(g=0;g<r;g++)(d=c[g].geometry)&&c[g].setGeometry(e(d))}a.addLayer(b)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var b=this._map;this._links&&s.forEach(this._links,function(b){b.declaredClass&&b._io&&b._io.cancel()});b&&s.forEach(this.getLayers(),
b.removeLayer,b)},_setState:function(b,a){var c=b.featureInfos,g,e,d,r=c?c.length:0,k=a?"show":"hide";for(d=0;d<r;d++)if(g=c[d],e=this.getFeature(g))if("Folder"===g.type)this._setState(e,a&&e.visible);else if("NetworkLink"===g.type)this._setInternalVisibility(e,a);else e[k]()},_areLocalAncestorsVisible:function(b){var a=b.parentFolderId;for(b=b.visible;b&&-1!==a;)a=this.getFeature({type:"Folder",id:a}),b=b&&a.visible,a=a.parentFolderId;return b},_setInternalVisibility:function(b,a){var c=b._parentLayer,
g=b._parentFolderId;for(a=a&&b.visible;a&&c;)a=a&&c.visible,-1<g&&(a=a&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",id:g}))),g=c._parentFolderId,c=c._parentLayer;this._setIntState(b,a)},_setIntState:function(b,a){b&&s.forEach(b.getLayers(),function(c){c.linkInfo?b._setIntState(c,a&&c.visible&&b._areLocalAncestorsVisible(b.getFeature({type:"Folder",id:c._parentFolderId}))):c.setVisibility(a)})},_getLinkParentId:function(b){var a=-1;this.folders&&s.some(this.folders,function(c){return c.networkLinkIds&&
-1!==s.indexOf(c.networkLinkIds,b)?(a=c.id,!0):!1});return a},_checkAutoRefresh:function(){var b=this.linkInfo;if(b)if(this.visible){if(this.loaded&&this._map){var a=b.refreshMode,c=b.refreshInterval,g=b.viewRefreshMode,b=b.viewRefreshTime;a&&(-1!==a.toLowerCase().indexOf("oninterval")&&0<c)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*c));g&&(-1!==g.toLowerCase().indexOf("onstop")&&0<b)&&!this._extChgHandle&&(this._extChgHandle=n.connect(this._map,"onExtentChange",this,
this._extentChanged))}}else this._stopAutoRefresh(),n.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(a){a=a||this._map;var g={},e=this.linkInfo,d=a&&a.extent,r;this._url.query&&(h.mixin(g,this._url.query),r=!!this._url.query.token);if(v.id&&!r&&(r=v.id.findCredential(this._url.path)))g.token=r.token;if(e){r=e.viewFormat;var k=e.httpQuery,e=e.viewBoundScale;if(d&&r){var f=
d,q=d,t=d.spatialReference;t&&(t.isWebMercator()?f=b.webMercatorToGeographic(d):4326===t.wkid&&(q=b.geographicToWebMercator(d)));d=f.getCenter();q=Math.max(q.getWidth(),q.getHeight());e&&(f=f.expand(e));r=r.replace(/\[bboxWest\]/ig,f.xmin).replace(/\[bboxEast\]/ig,f.xmax).replace(/\[bboxSouth\]/ig,f.ymin).replace(/\[bboxNorth\]/ig,f.ymax).replace(/\[lookatLon\]/ig,d.x).replace(/\[lookatLat\]/ig,d.y).replace(/\[lookatRange\]/ig,q).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,
d.x).replace(/\[lookatTerrainLat\]/ig,d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,d.x).replace(/\[cameraLat\]/ig,d.y).replace(/\[cameraAlt\]/ig,q).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,a.width).replace(/\[vertPixels\]/ig,a.height).replace(/\[terrainEnabled\]/ig,0);h.mixin(g,c.queryToObject(r))}k&&(k=k.replace(/\[clientVersion\]/ig,v.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,
l.locale),h.mixin(g,c.queryToObject(k)))}a=[];for(var w in g)p.isDefined(g[w])&&a.push(w+"\x3d"+g[w]);return(a=a.join("\x26"))?"?"+a:""},_setMap:function(b,c){this.inherited(arguments);this._map=b;var g=this._div=a.create("div",null,c);e.set(g,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return g},_unsetMap:function(b,c){this._io&&this._io.cancel();this._stopAutoRefresh();n.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var g=this._div;
g&&(c.removeChild(g),a.destroy(g));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(b){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,b),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&b&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._parseKml()},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});
f("extend-esri")&&h.setObject("layers.KMLLayer",w,v);return w})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(l,d,n,h,s,m,f){s.add("highcontrast",function(){var c=f.doc.createElement("div");c.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("+(d.blankGif||l.toUrl("./resources/blank.gif"))+");";f.body().appendChild(c);var a=h.getComputedStyle(c),
e=a.backgroundImage,a=a.borderTopColor==a.borderRightColor||e&&("none"==e||"url(invalid-url:)"==e);8>=s("ie")?c.outerHTML="":f.body().removeChild(c);return a});m(function(){s("highcontrast")&&n.add(f.body(),"dj_a11y")});return s})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang esri/geometry/jsonUtils".split(" "),function(l,d,n,h,s,m,f){l=l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",
geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(c){var a=c&&c.geometry||this.geometry;c={geometry:a,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?n.toJson(this.renderingRule.toJson()):null};a&&(c.geometryType=f.getJsonType(a));a=this.timeExtent;c.time=
a?a.toJson().join(","):null;m.isDefined(this.pixelSizeX)&&m.isDefined(this.pixelSizeY)?c.pixelSize=n.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?n.toJson(this.pixelSize.toJson()):null);return c}});h("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyParameters",l,s);return l})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r,t,q,x,z,B,w){function A(b){return function(a){c[a?"set":"remove"](this.domNode,b,a);this._set(b,a)}}p.add("dijit-legacy-requires",!k.isAsync);p.add("dojo-bidi",!1);p("dijit-legacy-requires")&&r(0,function(){l(["dijit/_base/manager"])});var y={};h=m("dijit._WidgetBase",[t,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:A("lang"),dir:"",_setDirAttr:A("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",
srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(b){this._set("ownerDocument",b)},attributeMap:{},_blankGif:h.blankGif||l.toUrl("dojo/resources/blank.gif"),_introspect:function(){var b=this.constructor;if(!b._setterAttrs){var a=b.prototype,c=b._setterAttrs=[],b=b._onMap={},g;for(g in a.attributeMap)c.push(g);for(g in a)/^on/.test(g)&&(b[g.substring(2).toLowerCase()]=g),/^_set[A-Z](.*)Attr$/.test(g)&&(g=g.charAt(4).toLowerCase()+g.substr(5,g.length-
9),(!a.attributeMap||!(g in a.attributeMap))&&c.push(g))}},postscript:function(b,a){this.create(b,a)},create:function(b,a){this._introspect();this.srcNodeRef=f.byId(a);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);b&&(this.params=b,g.mixin(this,b));this.postMixInProperties();this.id||(this.id=w.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=x.body(this.ownerDocument);w.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var e=this.srcNodeRef;e&&(e.parentNode&&this.domNode!==e)&&(e.parentNode.replaceChild(this.domNode,e),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var b={},a;for(a in this.params||{})b[a]=this._get(a);d.forEach(this.constructor._setterAttrs,
function(a){if(!(a in b)){var c=this._get(a);c&&this.set(a,c)}},this);for(a in b)this.set(a,b[a])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var b=this.baseClass.split(" ");this.isLeftToRight()||(b=b.concat(d.map(b,function(b){return b+"Rtl"})));a.add(this.domNode,b)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,d.forEach(this.getChildren(),function(b){!b._started&&
(!b._destroyed&&g.isFunction(b.startup))&&(b.startup(),b._started=!0)}))},destroyRecursive:function(b){this._beingDestroyed=!0;this.destroyDescendants(b);this.destroy(b)},destroy:function(b){function a(c){c.destroyRecursive?c.destroyRecursive(b):c.destroy&&c.destroy(b)}this._beingDestroyed=!0;this.uninitialize();d.forEach(this._connects,g.hitch(this,"disconnect"));d.forEach(this._supportingWidgets,a);this.domNode&&d.forEach(w.findWidgets(this.domNode,this.containerNode),a);this.destroyRendering(b);
w.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);this.domNode&&(b?c.remove(this.domNode,"widgetId"):e.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||e.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(b){d.forEach(this.getChildren(),function(a){a.destroyRecursive&&a.destroyRecursive(b)})},uninitialize:function(){return!1},_setStyleAttr:function(b){var a=this.domNode;g.isObject(b)?
u.set(a,b):a.style.cssText=a.style.cssText?a.style.cssText+("; "+b):b;this._set("style",b)},_attrToDom:function(b,e,r){r=3<=arguments.length?r:this.attributeMap[b];d.forEach(g.isArray(r)?r:[r],function(d){var r=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":g.isFunction(e)&&(e=g.hitch(this,e));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;r.tagName?c.set(r,d,e):r.set(d,e);break;case "innerText":r.innerHTML="";r.appendChild(this.ownerDocument.createTextNode(e));
break;case "innerHTML":r.innerHTML=e;break;case "class":a.replace(r,e,this[b])}},this)},get:function(b){var a=this._getAttrNames(b);return this[a.g]?this[a.g]():this._get(b)},set:function(b,a){if("object"===typeof b){for(var c in b)this.set(c,b[c]);return this}c=this._getAttrNames(b);var e=this[c.s];if(g.isFunction(e))var d=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&!g.isFunction(this.focusNode)?"focusNode":"domNode",r=this[e]&&this[e].tagName,k;if(k=r)if(!(k=
y[r])){k=this[e];var f={},q;for(q in k)f[q.toLowerCase()]=!0;k=y[r]=f}q=k;c=b in this.attributeMap?this.attributeMap[b]:c.s in this?this[c.s]:q&&c.l in q&&"function"!=typeof a||/^aria-|^data-|^role$/.test(b)?e:null;null!=c&&this._attrToDom(b,a,c);this._set(b,a)}return d||this},_attrPairNames:{},_getAttrNames:function(b){var a=this._attrPairNames;if(a[b])return a[b];var c=b.replace(/^[a-z]|-[a-zA-Z]/g,function(b){return b.charAt(b.length-1).toUpperCase()});return a[b]={n:b+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(b,a){var c=this[b];this[b]=a;this._created&&a!==c&&(this._watchCallbacks&&this._watchCallbacks(b,c,a),this.emit("attrmodified-"+b,{detail:{prevValue:c,newValue:a}}))},_get:function(b){return this[b]},emit:function(a,c,g){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var e,d=this["on"+a];d&&(e=d.apply(this,g?g:[c]));this._started&&!this._beingDestroyed&&b.emit(this.domNode,
a.toLowerCase(),c);return e},on:function(a,c){var g=this._onMap(a);return g?n.after(this,g,c,!0):this.own(b(this.domNode,a,c))[0]},_onMap:function(b){var a=this.constructor,c=a._onMap;if(!c){var c=a._onMap={},g;for(g in a.prototype)/^on/.test(g)&&(c[g.replace(/^on/,"").toLowerCase()]=g)}return c["string"==typeof b&&b.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?w.findWidgets(this.containerNode):
[]},getParent:function(){return w.getEnclosingWidget(this.domNode.parentNode)},connect:function(b,a,c){return this.own(s.connect(b,a,this,c))[0]},disconnect:function(b){b.remove()},subscribe:function(b,a){return this.own(q.subscribe(b,g.hitch(this,a)))[0]},unsubscribe:function(b){b.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:v.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=u.get(this.domNode,"display")},placeAt:function(b,a){var c=!b.tagName&&
w.byId(b);c&&c.addChild&&(!a||"number"===typeof a)?c.addChild(this,a):(c=c?c.containerNode&&!/after|before|replace/.test(a||"")?c.containerNode:c.domNode:f.byId(b,this.ownerDocument),e.place(this.domNode,c,a),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(b,a){var c=setTimeout(g.hitch(this,function(){c&&(c=null,this._destroyed||g.hitch(this,b)())}),a||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});p("dojo-bidi")&&h.extend(B);
return h})},"esri/layers/FeatureLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n esri/kernel esri/lang esri/request esri/deferredUtils esri/SpatialReference esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/jsonUtils esri/renderers/SimpleRenderer esri/renderers/UniqueValueRenderer esri/renderers/jsonUtils esri/tasks/QueryTask esri/tasks/query esri/tasks/FeatureSet esri/geometry/Extent esri/geometry/jsonUtils esri/geometry/normalizeUtils esri/layers/GraphicsLayer esri/layers/Field esri/layers/TimeInfo esri/layers/FeatureType esri/layers/FeatureTemplate esri/layers/FeatureEditResult esri/layers/LabelClass esri/layers/SnapshotMode esri/layers/OnDemandMode esri/layers/SelectionMode esri/layers/TrackManager dojo/i18n!esri/nls/jsapi dojo/has!extend-esri?esri/layers/agscommon".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r,t,q,x,z,B,w,A,y,C,L,I,J,U,ea,Q,M,F,D,E,X,N,G,H){l=l(U,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],
"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(b,a){this.i18n=v.getLocalization("esri","jsapi");this._outFields=a&&a.outFields;this._loadCallback=a&&a.loadCallback;var c=a&&a._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=a&&a.trackIdField;this.objectIdField=a&&a.objectIdField;this._maxOffset=a&&a.maxAllowableOffset;this._optEditable=a&&a.editable;
this._optAutoGen=a&&a.autoGeneralize;this.editSummaryCallback=a&&a.editSummaryCallback;this.userId=a&&a.userId;this.userIsAdmin=a&&a.userIsAdmin;this.useMapTime=a&&a.hasOwnProperty("useMapTime")?!!a.useMapTime:!0;this.source=a&&a.source;this.gdbVersion=a&&a.gdbVersion;this.orderByFields=a&&a.orderByFields;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();c=this.constructor;switch(this.mode=p.isDefined(a&&a.mode)?a.mode:
c.MODE_ONDEMAND){case c.MODE_SNAPSHOT:this._mode=new X(this);this._isSnapshot=!0;break;case c.MODE_ONDEMAND:this._tileWidth=a&&a.tileWidth||512;this._tileHeight=a&&a.tileHeight||512;this._mode=new N(this);this.latticeTiling=a&&a.latticeTiling;break;case c.MODE_SELECTION:this._mode=new G(this),this._isSelOnly=!0}this._initLayer=n.hitch(this,this._initLayer);this._selectHandler=n.hitch(this,this._selectHandler);this._editable=!1;if(n.isObject(b)&&b.layerDefinition)return this._collection=!0,this.mode=
c.MODE_SNAPSHOT,this._initLayer(b),this;this._task=new A(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);var g=a&&a.resourceInfo;g?this._initLayer(g):(this.source&&(g={source:this.source.toJson()},this._url.query=n.mixin(this._url.query,{layer:s.toJson(g)})),this.gdbVersion&&(this._url.query=n.mixin(this._url.query,{gdbVersion:this.gdbVersion})),k({url:c,content:n.mixin({f:"json"},this._url.query),
callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,g){if(a||g){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._mode=new X(this),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);if(a.hasOwnProperty("capabilities")){var e=this.capabilities=a.capabilities;e&&-1!==e.toLowerCase().indexOf("editing")?
this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);p.isDefined(this._optEditable)&&(this._editable=this._optEditable,delete this._optEditable);this._json=s.toJson(this._json);if(this.isEditable())delete this._maxOffset;else if(this.mode!==this.constructor.MODE_SNAPSHOT&&("esriGeometryPolyline"===a.geometryType||"esriGeometryPolygon"===a.geometryType))this._autoGeneralize=p.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===this.constructor.MODE_ONDEMAND,
delete this._optAutoGen;var e=a.effectiveMinScale||a.minScale,d=a.effectiveMaxScale||a.maxScale;!this._hasMin&&e&&this.setMinScale(e);!this._hasMax&&d&&this.setMaxScale(d);this.layerId=a.id;this.name=a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.geometryType=a.geometryType;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new L(a.extent);this.initialExtent=new L(this.fullExtent.toJson());this.fullExtent.spatialReference&&
(this.spatialReference=new b(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=a.supportsAdvancedQueries;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;
this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=p.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:
!0;this._isTable="Table"===this.type;for(var k=this.fields=[],d=a.fields,e=0;e<d.length;e++)k.push(new ea(d[e]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){d=a.fields;for(e=0;e<d.length;e++)if(k=d[e],"esriFieldTypeOID"===k.type){this.objectIdField=k.name;break}}this.objectIdField||console.debug("esri.layers.FeatureLayer: "+p.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!p.isDefined(this._nextId)){d=this.objectIdField;k=-1;if(this._collection&&
d)for(var f=(e=this._featureSet)&&e.features,y=f?f.length:0,u,e=0;e<y;e++)u=(u=f[e].attributes)&&u[d],u>k&&(k=u);this._nextId=k+1}this.globalIdField=a.globalIdField;if(e=this.typeIdField=a.typeIdField)if(e=!this._getField(e)&&this._getField(e,!0))this.typeIdField=e.name;this.visibilityField=a.visibilityField;if(d=a.defaultSymbol)this.defaultSymbol=x.fromJson(d);var m=this.types=[],A=a.types,v,l,k=(e=this.editFieldsInfo)&&e.creatorField,f=e&&e.editorField;u=k||f;y=[];if(A)for(e=0;e<A.length;e++)v=
new M(A[e]),l=v.templates,u&&(l&&l.length)&&(y=y.concat(l)),m.push(v);A=a.templates;v=this.templates=[];if(A)for(e=0;e<A.length;e++)m=new F(A[e]),u&&y.push(m),v.push(m);for(e=0;e<y.length;e++)if(u=n.getObject("prototype.attributes",!1,y[e]))k&&delete u[k],f&&delete u[f];if(e=a.timeInfo)this.timeInfo=new Q(e),this._startTimeField=e.startTimeField,this._endTimeField=e.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?e.trackIdField=this._trackIdField:
this._trackIdField=e.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var e=a.drawingInfo,I;if(k=e&&e.labelingInfo)this.labelingInfo=h.map(k,function(b){return new E(b)});if(!this.renderer)if(e&&e.renderer){if(I=e.renderer,this.setRenderer(w.fromJson(I)),"classBreaks"===I.type&&this.renderer.setMaxInclusive(!0),!this._collection){var J=I.type,d=[];I=this.renderer;switch(J){case "simple":d.push(I.symbol);break;case "uniqueValue":case "classBreaks":d.push(I.defaultSymbol),
d=d.concat(h.map(I.infos,function(b){return b.symbol}))}var d=h.filter(d,p.isDefined),U=this._url.path+"/images/",D=this._getToken();h.forEach(d,function(b){var a=b.url;a&&(-1===a.search(/https?\:/)&&-1===a.indexOf("data:")&&(b.url=U+a),D&&-1!==b.url.search(/https?\:/)&&(b.url+="?token\x3d"+D))})}}else if(d)A=this.types,0<A.length?(I=new B(this.defaultSymbol,this.typeIdField),h.forEach(A,function(b){I.addValue(b.id,b.symbol)})):I=new z(this.defaultSymbol),this.setRenderer(I);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":J=
new r;break;case "esriGeometryPolyline":J=new t;break;case "esriGeometryPolygon":J=new q}this.setRenderer(J?new z(J):null)}J=e&&e.transparency||0;!p.isDefined(this.opacity)&&0<J&&(this.opacity=1-J/100);this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);if((c("ie")||c("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;this.loaded=
!0;this._fixRendererFields();this._checkFields();this._updateCaps();J=function(){this.onLoad(this);var b=this._loadCallback;b&&(delete this._loadCallback,b(this))};this._collection?(this._fireUpdateStart(),e=this._featureSet,delete this._featureSet,this._mode._drawFeatures(new C(e)),this._fcAdded=!0,J.call(this)):this._forceIdentity(J)}},onRendererChange:function(){this.inherited(arguments);var b=this._getRenderer();this._ager=!(!b||!b.observationAger||!b.observationRenderer);if(b){var a=[],b=h.filter([b,
b.observationRenderer,b.latestObservationRenderer,b.trackRenderer],p.isDefined);h.forEach(b,function(b){n.isFunction(b.attributeField)||a.push(b.attributeField);a.push(b.attributeField2);a.push(b.attributeField3)},this);this._rendererFields=h.filter(a,p.isDefined)}else this._rendererFields=[];this.loaded&&(0<this._rendererFields.length&&(this._fixRendererFields(),this._checkFields(this._rendererFields)),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&
this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var b=this._getRenderer();this._ager=!(!b||!b.observationAger||!b.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(b&&b.trackRenderer)},_setMap:function(b){var a=this.inherited(arguments),c=this._mode,g=this;c&&c.initialize(b);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,
"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(b){b=b.graphic.attributes;(b=g._selectedFeatures[b&&b[g.objectIdField]])&&b.attr("data-selected","")});return a},_unsetMap:function(b){var a=this._mode;a&&a.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);d.disconnect(this._zoomConnect);d.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){var b=this._mode;
b&&b.refresh()},getOutFields:function(){return h.filter(this._getOutFields(),function(b){return"*"===b||!!this._getField(b)},this)},setEditable:function(b){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=b,this;var a=this._editable;this._editable=b;this._updateCaps();if(a!==b)this.onCapabilitiesChange();return this},getEditCapabilities:function(b){var a={canCreate:!1,
canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return a;var c=b&&b.feature;b=b&&b.userId;var g=h.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],n.trim),e=-1<h.indexOf(g,"editing"),d=e&&-1<h.indexOf(g,"create"),a=e&&-1<h.indexOf(g,"update"),g=e&&-1<h.indexOf(g,"delete"),r=this.ownershipBasedAccessControlForFeatures,k=this.editFieldsInfo,f=k&&k.creatorField,k=k&&k.realm,c=(c=c&&c.attributes)&&f?c[f]:void 0,q=!!this.userIsAdmin,f=!r||q||!(!r.allowOthersToUpdate&&
!r.allowUpdateToOthers),r=!r||q||!(!r.allowOthersToDelete&&!r.allowDeleteToOthers);if(q||e&&!d&&!a&&!g)d=a=g=!0;e={canCreate:d,canUpdate:a,canDelete:g};null===c?(e.canUpdate=a&&f,e.canDelete=g&&r):""!==c&&c&&((b=b||this.getUserId())&&k&&(b=b+"@"+k),b.toLowerCase()!==c.toLowerCase()&&(e.canUpdate=a&&f,e.canDelete=g&&r));return e},getUserId:function(){var b;this.loaded&&(b=this.credential&&this.credential.userId||this.userId||"");return b},setUserIsAdmin:function(b){this.userIsAdmin=b},setEditSummaryCallback:function(b){this.editSummaryCallback=
b},getEditSummary:function(b,a,c){c=p.isDefined(c)?c:(new Date).getTime();var g="";c=this.getEditInfo(b,a,c);(a=a&&a.callback||this.editSummaryCallback)&&(c=a(b,c)||"");if(n.isString(c))g=c;else{if(c){b=c.action;a=c.userId;var e=c.timeValue,d=0;b&&d++;a&&d++;p.isDefined(e)&&d++;1<d&&(g=("edit"===b?"edit":"create")+(a?"User":"")+(p.isDefined(e)?c.displayPattern:""))}g=g&&p.substitute(c,this.i18n.layers.FeatureLayer[g])}return g},getEditInfo:function(b,a,c){if(this.loaded){c=p.isDefined(c)?c:(new Date).getTime();
a=a&&a.action||"last";var g=this.editFieldsInfo,e=g&&g.creatorField,d=g&&g.creationDateField,r=g&&g.editorField,g=g&&g.editDateField,r=(b=b&&b.attributes)&&r?b[r]:void 0,g=b&&g?b[g]:null,e=this._getEditData(b&&e?b[e]:void 0,b&&d?b[d]:null,c);c=this._getEditData(r,g,c);var k;switch(a){case "creation":k=e;break;case "edit":k=c;break;case "last":k=c||e}k&&(k.action=k===c?"edit":"creation");return k}},_getEditData:function(b,a,c){var g,e,d;p.isDefined(a)&&(e=c-a,d=0>e?"Full":6E4>e?"Seconds":12E4>e?"Minute":
36E5>e?"Minutes":72E5>e?"Hour":864E5>e?"Hours":6048E5>e?"WeekDay":"Full");if(void 0!==b||d)g=g||{},g.userId=b,d&&(b=f.format,c=new Date(a),g.minutes=Math.floor(e/6E4),g.hours=Math.floor(e/36E5),g.weekDay=b(c,{datePattern:"EEEE",selector:"date"}),g.formattedDate=b(c,{selector:"date"}),g.formattedTime=b(c,{selector:"time"}),g.displayPattern=d,g.timeValue=a);return g},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(b){this.isEditable()||(this._maxOffset=
b);return this},getMaxAllowableOffset:function(){return this._maxOffset},setAutoGeneralize:function(b){if(this.loaded){if(!this.isEditable()&&this.mode!==this.constructor.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType))if(this._autoGeneralize=b){if((b=this._map)&&b.loaded)this._maxOffset=Math.floor(b.extent.getWidth()/b.width)}else delete this._maxOffset}else this._optAutoGen=b;return this},setGDBVersion:function(b){if(!this._collection&&b!==
this.gdbVersion&&(b||this.gdbVersion))this.gdbVersion=b,this._task.gdbVersion=b,this._url.query=n.mixin(this._url.query,{gdbVersion:b}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange();return this},setDefinitionExpression:function(b){this._defnExpr=b;(b=this._mode)&&b.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(b){this._isSnapshot?(this._timeDefn=b,(b=this._mode)&&b.propertyChangeHandler(2)):
console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(b,a){this._timeOffset=b;this._timeOffsetUnits=a;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(b){this.useMapTime=b;this._toggleTime(!this.suspended);(b=this._mode)&&b.propertyChangeHandler(0)},selectFeatures:function(a,
c,e,d){c=c||this.constructor.SELECTION_NEW;a=this._getShallowClone(a);var r=this._map,k=g._fixDfd(new m(g._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;r&&(a.outSpatialReference=new b(r.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return a={features:[]},this._selectHandler(a,c,e,d,k),k;if(r=this._canDoClientSideQuery(a))a={features:this._doQuery(a,r)},this._selectHandler(a,c,e,d,k);else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+
this.invalidParams)],null,d,k,!0),k;var f=this;this._ts&&(a._ts=(new Date).getTime());(k._pendingDfd=this._task.execute(a)).addCallbacks(function(b){f._selectHandler(b,c,e,d,k)},function(b){f._resolve([b],null,d,k,!0)})}return k},getSelectedFeatures:function(){var b=this._selectedFeatures,a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(b[c]);return a},clearSelection:function(b){var a=this._selectedFeatures,c=this._mode,g;for(g in a)a.hasOwnProperty(g)&&(this._unSelectFeatureIIf(g,c),c._removeFeatureIIf(g));
this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!b)this.onSelectionClear();return this},setSelectionSymbol:function(b){if(this._selectionSymbol=b){var a=this._selectedFeatures,c;for(c in a)a.hasOwnProperty(c)&&a[c].setSymbol(b)}return this},getSelectionSymbol:function(){return this._selectionSymbol},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(b,a,c,g,e,d){var r=d.assembly,f=d.dfd;this._applyNormalized(b,r&&r[0]);this._applyNormalized(a,r&&r[1]);
this.onBeforeApplyEdits(b,a,c);var q={},t=this.objectIdField,r={f:"json"},p=!1;if(this._collection)d={},d.addResults=b?h.map(b,function(){p=!0;return{objectId:this._nextId++,success:!0}},this):null,d.updateResults=a?h.map(a,function(b){p=!0;var a=b.attributes[t];q[a]=b;return{objectId:a,success:!0}},this):null,d.deleteResults=c?h.map(c,function(b){p=!0;return{objectId:b.attributes[t],success:!0}},this):null,p&&this._editHandler(d,b,q,g,e,f);else{b&&0<b.length&&(r.adds=this._convertFeaturesToJson(b,
0,1),p=!0);if(a&&0<a.length){for(d=0;d<a.length;d++){var w=a[d];q[w.attributes[t]]=w}r.updates=this._convertFeaturesToJson(a,0,0,1);p=!0}if(c&&0<c.length){a=[];for(d=0;d<c.length;d++)a.push(c[d].attributes[t]);r.deletes=a.join(",");p=!0}if(p){var y=this;return k({url:this._url.path+"/applyEdits",content:n.mixin(r,this._url.query),callbackParamName:"callback",load:function(a){y._editHandler(a,b,q,g,e,f)},error:function(b){y._resolve([b],null,e,f,!0)}},{usePost:!0})}}},queryFeatures:function(b,a,c){return this._query("execute",
"onQueryFeaturesComplete",b,a,c)},queryRelatedFeatures:function(b,a,c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",b,a,c)},queryIds:function(b,a,c){return this._query("executeForIds","onQueryIdsComplete",b,a,c)},queryCount:function(b,a,c){return this._query("executeForCount","onQueryCountComplete",b,a,c)},queryAttachmentInfos:function(b,c,e){var d=this._url.path+"/"+b+"/attachments",r=new m(g._dfdCanceller),f=this;r._pendingDfd=k({url:d,content:n.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:function(g){g=g.attachmentInfos;var e;h.forEach(g,function(c){e=a.objectToQuery({gdbVersion:f._url.query&&f._url.query.gdbVersion,layer:f._url.query&&f._url.query.layer,token:f._getToken()});c.url=d+"/"+c.id+(e?"?"+e:"");c.objectId=b});f._resolve([g],"onQueryAttachmentInfosComplete",c,r)},error:function(b){f._resolve([b],null,e,r,!0)}});return r},addAttachment:function(b,a,c,g){return this._sendAttachment("add",b,a,c,g)},updateAttachment:function(b,
a,c,g,d){c.appendChild(e.create("input",{type:"hidden",name:"attachmentId",value:a}));return this._sendAttachment("update",b,c,g,d)},deleteAttachments:function(b,a,c,e){var d=this._url.path+"/"+b+"/deleteAttachments",r=new m(g._dfdCanceller),f=this;a={f:"json",attachmentIds:a.join(",")};r._pendingDfd=k({url:d,content:n.mixin(a,this._url.query),callbackParamName:"callback",load:n.hitch(this,function(a){a=a.deleteAttachmentResults;a=h.map(a,function(a){a=new D(a);a.attachmentId=a.objectId;a.objectId=
b;return a});f._resolve([a],"onDeleteAttachmentsComplete",c,r)}),error:function(b){f._resolve([b],null,e,r,!0)}},{usePost:!0});return r},addType:function(b){var a=this.types;if(a){if(h.some(a,function(a){return a.id==b.id?!0:!1}))return!1;a.push(b)}else this.types=[b];return this._typesDirty=!0},deleteType:function(b){if(this._collection){var a=this.types;if(a){var c=-1;h.some(a,function(a,g){return a.id==b?(c=g,!0):!1});if(-1<c)return this._typesDirty=!0,a.splice(c,1)[0]}}},toJson:function(){var b=
this._json;if(b=n.isString(b)?s.fromJson(b):n.clone(b)){var b=b.layerDefinition?b:{layerDefinition:b},a=b.layerDefinition,c=this._collection;if(c&&this._typesDirty){a.types=h.map(this.types||[],function(b){return b.toJson()});var g=this.renderer,e=a.drawingInfo;g&&!e&&(e=a.drawingInfo={});e&&(g&&-1===g.declaredClass.indexOf("TemporalRenderer"))&&(e.renderer=g.toJson())}g=null;if(!c||this._fcAdded)g={geometryType:a.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};b.featureSet=n.mixin({},
b.featureSet||{},g);c&&(b.nextObjectId=this._nextId,a.capabilities=this.capabilities);return b}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},
onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(b){var a=this,c=this._url&&this._url.path;(this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&c&&u.id&&u.id._hasPortalSession()&&u.id._doPortalSignIn(c)?u.id.getCredential(c).then(function(){a._findCredential();b.call(a)},function(){b.call(a)}):b.call(this)},_updateCaps:function(){var b=this._editable,a=n.trim(this.capabilities||""),c=h.map(a?
a.split(","):[],n.trim),g=h.map(a?a.toLowerCase().split(","):[],n.trim),a=h.indexOf(g,"editing"),e,g={Create:h.indexOf(g,"create"),Update:h.indexOf(g,"update"),Delete:h.indexOf(g,"delete")};if(b&&-1===a)c.push("Editing");else if(!b&&-1<a){b=[a];for(e in g)-1<g[e]&&b.push(g[e]);b.sort();for(e=b.length-1;0<=e;e--)c.splice(b[e],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);
var b=this._mode;b&&b.suspend()},onResume:function(b){this.inherited(arguments);this._toggleTime(!0);this._updateMaxOffset();var a=this._mode,c=this._map,g=this._getRenderer();if(b.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&(this._trackIdField||g&&(g.latestObservationRenderer||g.trackRenderer)))this._trackManager=new H(this),this._trackManager.initialize(c);this._zoomConnect=d.connect(c,"onZoomEnd",this,this._updateMaxOffset)}a&&(b.firstOccurrence?
a.startup():a.resume())},_updateMaxOffset:function(){var b=this._map;b&&b.loaded&&this._autoGeneralize&&(this._maxOffset=Math.floor(b.extent.getWidth()/b.width))},_toggleTime:function(b){var a=this._map;b&&this.timeInfo&&this.useMapTime&&a?(this._mapTimeExtent=a.timeExtent,this._timeConnect||(this._timeConnect=d.connect(a,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,d.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(b){this._mapTimeExtent=
b;(b=this._mode)&&b.propertyChangeHandler(0)},_getOffsettedTE:function(b){var a=this._timeOffset,c=this._timeOffsetUnits;return b&&a&&c?b.offset(-1*a,c):b},_getTimeOverlap:function(b,a){return b&&a?b.intersection(a):b||a},_getTimeFilter:function(b){var a=this.getTimeDefinition(),c;if(a&&(c=this._getTimeOverlap(a,null),!c))return[!1];if(b){if(b=c?this._getTimeOverlap(b,c):b,!b)return[!1]}else b=c;return[!0,b]},_getAttributeFilter:function(b){var a=this.getDefinitionExpression();return b?a?"("+a+") AND ("+
b+")":b:a},_applyQueryFilters:function(b,a){b.where=this._getAttributeFilter(b.where);b.maxAllowableOffset=this._maxOffset;a&&this.supportsAdvancedQueries&&(b.orderByFields=b.orderByFields||this.orderByFields);if(this.timeInfo){var c=this._getTimeFilter(b.timeExtent);if(c[0])b.timeExtent=c[1];else return!1}return!0},_add:function(b){var a=this._selectionSymbol,c=b.attributes,g=this.visibilityField;a&&this._isSelOnly&&b.setSymbol(a);if(g&&c&&c.hasOwnProperty(g))b[c[g]?"show":"hide"]();return this.add.apply(this,
arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(b){var a=[],c=this._map;if(!this._isTable&&c&&!b.text&&!(b.where&&b.where!==this.getDefinitionExpression()||b.orderByFields&&b.orderByFields.length)){var g=this._isSnapshot,e=this._isSelOnly,d=b.geometry;if(d)if(!e&&b.spatialRelationship===y.SPATIAL_REL_INTERSECTS&&"extent"===d.type&&(g||c.extent.contains(d)))a.push(1);else return;if(c=b.objectIds)if(g)a.push(2);else{var d=c.length,r=this._mode,
k=0,f;for(f=0;f<d;f++)r._getFeature(c[f])&&k++;if(k===d)a.push(2);else return}if(this.timeInfo)if(b=b.timeExtent,c=this._mapTimeExtent,g)b&&a.push(3);else if(e){if(b)return}else if(c)if(-1!==h.indexOf(a,2))b&&a.push(3);else return;else if(0<a.length)b&&a.push(3);else if(b)return;return 0<a.length?a:null}},_doQuery:function(b,a,c){var g=[],e=this._mode,d=this.objectIdField,r,k;if(-1!==h.indexOf(a,2)){var g=[],f=b.objectIds;k=f.length;for(r=0;r<k;r++){var q=e._getFeature(f[r]);q&&g.push(q)}if(0===g.length)return[]}if(-1!==
h.indexOf(a,1)){e=0<g.length?g:this.graphics;k=e.length;f=b.geometry._normalize(null,!0);g=[];for(r=0;r<k;r++){var q=e[r],t=q.geometry;t&&(this.normalization&&f.length?(f[0].intersects(t)||f[1].intersects(t))&&g.push(q):f.intersects(t)&&g.push(q))}if(0===g.length)return[]}-1!==h.indexOf(a,3)&&this.timeInfo&&(e=0<g.length?g:this.graphics,b=b.timeExtent,g=this._filterByTime(e,b.startTime,b.endTime).match);return c?h.map(g,function(b){return b.attributes[d]},this):g},_filterByTime:function(b,a,c){var g=
this._startTimeField,e=this._endTimeField,d;this._twoTimeFields||(d=g||e);var r=p.isDefined,k=[],f=[],q,t=b.length,w,y;a=a?a.getTime():-Infinity;c=c?c.getTime():Infinity;if(d)for(q=0;q<t;q++)w=b[q],y=w.attributes,g=y[d],g>=a&&g<=c?k.push(w):f.push(w);else for(q=0;q<t;q++)w=b[q],y=w.attributes,d=y[g],y=y[e],d=r(d)?d:-Infinity,y=r(y)?y:Infinity,d>=a&&d<=c||y>=a&&y<=c||a>=d&&c<=y?k.push(w):f.push(w);return{match:k,noMatch:f}},_resolve:function(b,a,c,e,d){a&&this[a].apply(this,b);c&&c.apply(null,b);e&&
g._resDfd(e,b,d)},_getShallowClone:function(b){var a=new y,c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},_query:function(a,c,e,d,r){var k=this,f=this._map,q=new m(g._dfdCanceller),t=e,p=function(b,g){if(!g&&"execute"===a&&!k._isTable){var e=b.features,r=k._mode,f=k.objectIdField,t;for(t=e.length-1;0<=t;t--){var y=r._getFeature(e[t].attributes[f]);y&&e.splice(t,1,y)}}k._resolve([b],c,d,q)};if("executeRelationshipQuery"!==a){t=this._getShallowClone(e);t.outFields=this.getOutFields();t.returnGeometry=
e.hasOwnProperty("returnGeometry")?e.returnGeometry:!0;var y;f&&(t.outSpatialReference=new b(f.spatialReference.toJson()));if(!this._applyQueryFilters(t,"execute"===a)){switch(a){case "execute":y=new C({features:[]});break;case "executeForIds":y=[];break;case "executeForCount":y=0}p(y,!0);return q}if(e=this._canDoClientSideQuery(t)){t=this._doQuery(t,e,"executeForIds"===a||"executeForCount"===a);switch(a){case "execute":y=new C;y.features=t;break;case "executeForIds":y=t;break;case "executeForCount":y=
t.length}p(y,!0);return q}}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,r,q,!0),q;this._ts&&(t._ts=(new Date).getTime());(q._pendingDfd=this._task[a](t)).addCallbacks(p,function(b){k._resolve([b],null,r,q,!0)});return q},_convertFeaturesToJson:function(b,a,c,g){var e=[],d=this._selectionSymbol,r=this.visibilityField,k,f=this.objectIdField;if(this.loaded&&(c||g))k=h.filter(this.fields,function(b){return!1===b.editable&&(!g||b.name!==f)});for(c=
0;c<b.length;c++){var q=b[c],t={},y=q.geometry,p=q.attributes,w=q.symbol;if(y&&(!g||!this.loaded||this.allowGeometryUpdates))t.geometry=y.toJson();r?(t.attributes=p=n.mixin({},p),p[r]=q.visible?1:0):p&&(t.attributes=n.mixin({},p));t.attributes&&(k&&k.length)&&h.forEach(k,function(b){delete t.attributes[b.name]});w&&w!==d&&(t.symbol=w.toJson());e.push(t)}return a?e:s.toJson(e)},_selectHandler:function(b,a,c,g,e){var d;g=this.constructor;switch(a){case g.SELECTION_NEW:this.clearSelection(!0);d=!0;break;
case g.SELECTION_ADD:d=!0;break;case g.SELECTION_SUBTRACT:d=!1}g=b.features;var r=this._mode,k=[],f=this.objectIdField,q,t;if(d)for(d=0;d<g.length;d++)q=g[d],t=q.attributes[f],q=r._addFeatureIIf(t,q),k.push(q),this._selectFeatureIIf(t,q,r);else for(d=0;d<g.length;d++)q=g[d],t=q.attributes[f],this._unSelectFeatureIIf(t,r),t=r._removeFeatureIIf(t),k.push(t||q);this._isSelOnly&&r._applyTimeFilter(!0);this._resolve([k,a,b.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,e);
if(b.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(b,a,c){var g=this._selectedFeatures,e=g[b];e||(c._incRefCount(b),g[b]=a,this._isTable||(this._setSelectSymbol(a),a.attr("data-selected","")));return e||a},_unSelectFeatureIIf:function(b,a){var c=this._selectedFeatures[b];c&&(a._decRefCount(b),delete this._selectedFeatures[b],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(b){},_setSelectSymbol:function(b){var a=this._selectionSymbol;
a&&!this._isSelOnly&&b.setSymbol(a)},_setUnSelectSymbol:function(b){var a=this._selectionSymbol;a&&!this._isSelOnly&&a===b.symbol&&b.setSymbol(null,!0)},_getOutFields:function(){var b=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),b=h.filter(b,function(b,a,c){return!!b&&h.indexOf(c,b)===a}),a=n.clone(this._outFields);if(a){if(-1!==h.indexOf(a,"*"))return a;h.forEach(b,function(b){-1===
h.indexOf(a,b)&&a.push(b)});return a}return b},_checkFields:function(b){var a=b||this._getOutFields();h.forEach(a,function(b){"*"!==b&&(this._getField(b)||console.debug("esri.layers.FeatureLayer: "+p.substitute({url:this.url,field:b},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!b&&(!this._isTable&&!this._fserver&&!this._collection)&&(h.some(this.fields,function(b){return b&&"esriFieldTypeGeometry"===b.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+
p.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},_fixRendererFields:function(){var b=this.renderer;if(b&&0<this.fields.length){var a=[],c,g,b=h.filter([b,b.observationRenderer,b.latestObservationRenderer,b.trackRenderer],p.isDefined),e=[].concat(b);h.forEach(b,function(b){h.forEach(b.rendererInfos,function(b){b.renderer&&e.push(b.renderer)})});
h.forEach(e,function(b){if((g=b.attributeField)&&!n.isFunction(g))if(c=!this._getField(g)&&this._getField(g,!0))b.attributeField=c.name;if(g=b.attributeField2)if(c=!this._getField(g)&&this._getField(g,!0))b.attributeField2=c.name;if(g=b.attributeField3)if(c=!this._getField(g)&&this._getField(g,!0))b.attributeField3=c.name;n.isFunction(b.attributeField)||a.push(b.attributeField);a.push(b.attributeField2);a.push(b.attributeField3);if((g=b.rotationInfo&&b.rotationInfo.field)&&!n.isFunction(g)){if(c=
!this._getField(g)&&this._getField(g,!0))g=b.rotationInfo.field=c.name;a.push(g)}if(b.proportionalSymbolInfo){if((g=b.proportionalSymbolInfo.field)&&!n.isFunction(g)){if(c=!this._getField(g)&&this._getField(g,!0))g=b.proportionalSymbolInfo.field=c.name;a.push(g)}if((g=b.proportionalSymbolInfo.normalizationField)&&!n.isFunction(g)){if(c=!this._getField(g)&&this._getField(g,!0))g=b.proportionalSymbolInfo.normalizationField=c.name;a.push(g)}}},this);this._rendererFields=h.filter(a,p.isDefined)}},_getField:function(b,
a){var c=this.fields;if(!c||0===c.length)return null;var g;a&&(b=b.toLowerCase());h.some(c,function(c){var e=!1;(e=a?c&&c.name.toLowerCase()===b?!0:!1:c&&c.name===b?!0:!1)&&(g=c);return e});return g},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:h.map(h.filter(this.fields,function(b){return!!(b&&"esriFieldTypeDate"===b.type)}),function(b){return b.name})});return this._dtOpts},_applyNormalized:function(b,a){b&&a&&h.forEach(b,function(b,c){b&&a[c]&&b.setGeometry(a[c])})},_editHandler:function(b,
a,c,g,e,d){e=b.addResults;var r=b.updateResults;b=b.deleteResults;var k,f,q,t,y=this.objectIdField,p=this._mode,w=this._isTable;k=this.editFieldsInfo;var u=this.getOutFields()||[],m=k&&k.creatorField,z=k&&k.creationDateField,A=k&&k.editorField,x=k&&k.editDateField;k=k&&k.realm;-1===h.indexOf(u,"*")&&(m&&-1===h.indexOf(u,m)&&(m=null),z&&-1===h.indexOf(u,z)&&(z=null),A&&-1===h.indexOf(u,A)&&(A=null),x&&-1===h.indexOf(u,x)&&(x=null));var u=z||x?(new Date).getTime():null,v=m||A?this.getUserId():void 0;
v&&k&&(v=v+"@"+k);if(e)for(k=0;k<e.length;k++)e[k]=new D(e[k]),w||(f=e[k],f.success&&(f=f.objectId,q=a[k],(t=q._graphicsLayer)&&t!==this&&t.remove(q),t=q.attributes||{},t[y]=f,m&&(t[m]=v),A&&(t[A]=v),z&&(t[z]=u),x&&(t[x]=u),q.setAttributes(t),p._init&&p.drawFeature(q)));if(r)for(k=0;k<r.length;k++)if(r[k]=new D(r[k]),!w&&(f=r[k],f.success)){f=f.objectId;q=c[f];if(a=p._getFeature(f))a.geometry!==q.geometry&&a.setGeometry(I.fromJson(q.geometry.toJson())),this._repaint(a,f);q=a||q;t=q.attributes||{};
A&&(t[A]=v);x&&(t[x]=u);q.setAttributes(t)}if(b){c=[];for(k=0;k<b.length;k++)if(b[k]=new D(b[k]),!w&&(f=b[k],f.success&&(f=f.objectId,q=p._getFeature(f))))this._unSelectFeatureIIf(f,p)&&c.push(q),q._count=0,p._removeFeatureIIf(f);if(0<c.length)this.onSelectionComplete(c,this.constructor.SELECTION_SUBTRACT)}this._resolve([e,r,b],"onEditsComplete",g,d)},_sendAttachment:function(b,a,c,g,e){var d=this;return k({url:this._url.path+"/"+a+"/"+("add"===b?"addAttachment":"updateAttachment"),form:c,content:n.mixin(this._url.query,
{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var e="add"===b?"onAddAttachmentComplete":"onUpdateAttachmentComplete";c=new D(c["add"===b?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=a;d._resolve([c],e,g);return c}).addErrback(function(b){d._resolve([b],null,e,null,!0)})},_repaint:function(b,a,c){a=p.isDefined(a)?a:b.attributes[this.objectIdField];(!(a in this._selectedFeatures)||!this._selectionSymbol)&&
b.setSymbol(b.symbol,c)},_getKind:function(b){var a=this._trackManager;return a?a.isLatestObservation(b)?1:0:0}});n.mixin(l,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});J._createWrappers(l);c("extend-esri")&&n.setObject("layers.FeatureLayer",l,u);return l})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/geometry/jsonUtils esri/tasks/FeatureSet".split(" "),
function(l,d,n,h,s,m){l=l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=new m(d.catalogItems));d.location&&(this.location=s.fromJson(d.location));this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.properties=d.properties}});n("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyResult",l,h);return l})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred esri/kernel esri/urlUtils esri/SpatialReference esri/layers/TileInfo esri/layers/TiledMapServiceLayer esri/geometry/Extent esri/request".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g){l=l(p,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(b){try{b=d.mixin({bingMapsKey:null,culture:"en-US"},b||{});var a=window.location.protocol;"file:"===a&&(a="http:");this.url=a+"//dev.virtualearth.net/REST/v1";this._url=e.urlToObject(this.url);this.spatialReference=new v({wkid:102100});this.tileInfo=new u({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=new k(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new v({wkid:102100}));d.mixin(this,b);this.hasAttributionData=this.showAttribution;this._initLayer=d.hitch(this,this._initLayer);this._errorHandler=d.hitch(this,this._errorHandler);this._getTileInfo=d.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(c){throw this.onError(c),c;}},_unsetMap:function(b,a){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var b=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var a=this.resourceInfo;!this.loaded&&a?this._initLayer(a):g({url:b,content:d.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(b,
a){try{this.resourceInfo=n.toJson(b);var c=b.resourceSets[0].resources[0],g=c.imageUrl.replace("{","${");this.tileServers=h.map(c.imageUrlSubdomains,function(b){var a=window.location.protocol;"file:"===a&&(a="http:");return f.substitute(g,{subdomain:b}).replace("http:",a)});this._tsLength=this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var e=
this.loadCallback;e&&(delete this.loadCallback,e(this))}}catch(d){this.onError(d)}},getAttributionData:function(){var b=new c,a=n.fromJson(this.resourceInfo),g;this.hasAttributionData&&a&&(g=d.getObject("resourceSets.0.resources.0.imageryProviders",!1,a));g?b.callback({contributors:g}):(a=Error("Layer does not have attribution data"),a.log=s.isDebug,b.errback(a));return b},getTileUrl:function(b,a,c){return f.substitute(this.tileServers[a%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(b,
a,c),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(b,a,c){var g="",e,d;for(d=b;0<d;d--)b="0",e=1<<d-1,0!=(c&e)&&b++,0!=(a&e)&&(b++,b++),g+=b;return g},setMapStyle:function(b){this.mapStyle=b;this._getTileInfo()},setCulture:function(b){this.culture=b;this._getTileInfo()},setBingMapsKey:function(b){this.bingMapsKey=b},onMapStyleChange:function(){}});d.mixin(l,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});m("extend-esri")&&d.setObject("virtualearth.VETiledLayer",
l,a);return l})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(l,d,n,h,s,m,f,c,a,e){function v(a,c,g){return b&&g?function(b,a){return m(b,g,a)}:k?function(b,g){var e=m(b,c,g),d=m(b,a,function(b){(!y||(new Date).getTime()>y+1E3)&&g.call(this,b)});return{remove:function(){e.remove();d.remove()}}}:function(b,c){return m(b,a,c)}}function u(b){do if(b.dojoClick)return b.dojoClick;while(b=b.parentNode)}
function p(b,a,c){if(t=!b.target.disabled&&u(b.target))q=b.target,x=b.touches?b.touches[0].pageX:b.clientX,z=b.touches?b.touches[0].pageY:b.clientY,B=("object"==typeof t?t.x:"number"==typeof t?t:0)||4,w=("object"==typeof t?t.y:"number"==typeof t?t:0)||4,r||(r=!0,e.doc.addEventListener(a,function(b){t=t&&b.target==q&&Math.abs((b.touches?b.touches[0].pageX:b.clientX)-x)<=B&&Math.abs((b.touches?b.touches[0].pageY:b.clientY)-z)<=w},!0),e.doc.addEventListener(c,function(b){if(t){A=(new Date).getTime();
var a=b.target;"LABEL"===a.tagName&&(a=n.byId(a.getAttribute("for"))||a);setTimeout(function(){m.emit(a,"click",{bubbles:!0,cancelable:!0,_dojo_click:!0})})}},!0),b=function(b){e.doc.addEventListener(b,function(a){!a._dojo_click&&((new Date).getTime()<=A+1E3&&!("INPUT"==a.target.tagName&&h.contains(a.target,"dijitOffScreen")))&&(a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),"click"==b&&(("INPUT"!=a.target.tagName||"radio"==a.target.type||"checkbox"==a.target.type)&&
"TEXTAREA"!=a.target.tagName&&"AUDIO"!=a.target.tagName&&"VIDEO"!=a.target.tagName)&&a.preventDefault())},!0)},b("click"),b("mousedown"),b("mouseup"))}var k=f("touch"),g=5>f("ios"),b=navigator.msPointerEnabled,r,t,q,x,z,B,w,A,y,C;k&&(b?a(function(){e.doc.addEventListener("MSPointerDown",function(b){p(b,"MSPointerMove","MSPointerUp")},!0)}):a(function(){function b(a){var c=s.delegate(a,{bubbles:!0});6<=f("ios")&&(c.touches=a.touches,c.altKey=a.altKey,c.changedTouches=a.changedTouches,c.ctrlKey=a.ctrlKey,
c.metaKey=a.metaKey,c.shiftKey=a.shiftKey,c.targetTouches=a.targetTouches);return c}C=e.body();e.doc.addEventListener("touchstart",function(b){y=(new Date).getTime();var a=C;C=b.target;m.emit(a,"dojotouchout",{relatedTarget:C,bubbles:!0});m.emit(C,"dojotouchover",{relatedTarget:a,bubbles:!0});p(b,"touchmove","touchend")},!0);m(e.doc,"touchmove",function(a){y=(new Date).getTime();var c=e.doc.elementFromPoint(a.pageX-(g?0:e.global.pageXOffset),a.pageY-(g?0:e.global.pageYOffset));c&&(C!==c&&(m.emit(C,
"dojotouchout",{relatedTarget:c,bubbles:!0}),m.emit(c,"dojotouchover",{relatedTarget:C,bubbles:!0}),C=c),m.emit(c,"dojotouchmove",b(a)))});m(e.doc,"touchend",function(a){y=(new Date).getTime();var c=e.doc.elementFromPoint(a.pageX-(g?0:e.global.pageXOffset),a.pageY-(g?0:e.global.pageYOffset))||e.body();m.emit(c,"dojotouchend",b(a))})}));d={press:v("mousedown","touchstart","MSPointerDown"),move:v("mousemove","dojotouchmove","MSPointerMove"),release:v("mouseup","dojotouchend","MSPointerUp"),cancel:v(c.leave,
"touchcancel",k?"MSPointerCancel":null),over:v("mouseover","dojotouchover","MSPointerOver"),out:v("mouseout","dojotouchout","MSPointerOut"),enter:c._eventHandler(v("mouseover","dojotouchover","MSPointerOver")),leave:c._eventHandler(v("mouseout","dojotouchout","MSPointerOut"))};return l.touch=d})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(l,d,n,h,s){l=l(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,
title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(d){d&&(this.name=d.name,this.title=d.title,this.description=d.description,this.extent=d.extent,this.legendURL=d.legendURL,this.subLayers=d.subLayers?d.subLayers:[],this.allExtents=d.allExtents?d.allExtents:[],this.spatialReferences=d.spatialReferences?d.spatialReferences:[])},clone:function(){var d={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},
f;this.extent&&(d.extent=this.extent.getExtent());d.subLayers=[];n.forEach(this.subLayers,function(c){d.subLayers.push(c.clone())});d.allExtents=[];for(f in this.allExtents)f=parseInt(f,10),isNaN(f)||(d.allExtents[f]=this.allExtents[f].getExtent());d.spatialReferences=[];n.forEach(this.spatialReferences,function(c){d.spatialReferences.push(c)});return d}});h("extend-esri")&&d.setObject("layers.WMSLayerInfo",l,s);return l})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect",
"dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(l,d,n,h,s){return n("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var d=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);s.parse(d,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,
scope:"dojo"}).then(h.hitch(this,function(d){this._startupWidgets=d;for(var c=0;c<d.length;c++)this._processTemplateNode(d[c],function(a,c){return a[c]},function(a,c,d){return c in a?a.connect(a,c,d):a.on(c,d,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(d,f,c){return f(d,"dojoType")||f(d,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){l.forEach(this._startupWidgets,function(d){d&&(!d._started&&d.startup)&&d.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(l,d,n,h,s){l=l(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(h){d.mixin(this,
h);s.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});n("extend-esri")&&d.setObject("layers.KMLFolder",l,h);return l})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script esri/kernel".split(" "),function(l,d,n,h,s,m,f){d=d(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(l._scopeName||"dojo")+"IoScript"},initialize:function(c){this.map=c;this._init=!0},startup:function(){},
propertyChangeHandler:function(c){},destroy:function(){this._init=!1},drawFeature:function(c){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(c){(c=this._featureMap[c])&&c._count++},_decRefCount:function(c){(c=this._featureMap[c])&&c._count--},_getFeature:function(c){return this._featureMap[c]},_addFeatureIIf:function(c,a){var e=this._featureMap,d=e[c],f=this.featureLayer;d||(e[c]=a,f._add(a),a._count=0);return d||a},_removeFeatureIIf:function(c){var a=this._featureMap[c],
e=this.featureLayer;if(a){if(a._count)return;delete this._featureMap[c];e._remove(a)}return a},_clearIIf:function(){var c;c=this.featureLayer;var a=c.graphics,e=c._selectedFeatures,d=c.objectIdField;for(c=a.length-1;0<=c;c--){var f=a[c],p=f.attributes[d];p in e?f._count=1:(f._count=0,this._removeFeatureIIf(p))}},_isPending:function(c){return m[this._prefix+c]?!0:!1},_cancelPendingRequest:function(c,a){if(c=c||m[this._prefix+a])try{c.cancel(),m._validCheck(c)}catch(e){}},_purgeRequests:function(){m._validCheck(null)},
_toggleVisibility:function(c){var a=this.featureLayer,e=a.graphics,d=c?"show":"hide",f,p=e.length;c=c&&a._ager;for(f=0;f<p;f++){var k=e[f];k[d]();c&&a._repaint(k)}},_applyTimeFilter:function(c){var a=this.featureLayer;if(a.timeInfo&&!a.suspended){c||a._fireUpdateStart();var e=a._trackManager;e&&e.clearTracks();var d=a.getTimeDefinition(),f=a._getOffsettedTE(a._mapTimeExtent);f?(f=a._getTimeOverlap(d,f))?(d=a._filterByTime(a.graphics,f.startTime,f.endTime),e&&e.addFeatures(d.match),h.forEach(d.match,
function(c){var e=c._shape;c.visible||(c.show(),(e=c._shape)&&e._moveToFront());a._ager&&e&&a._repaint(c)}),h.forEach(d.noMatch,function(a){a.visible&&a.hide()})):this._toggleVisibility(!1):(e&&e.addFeatures(a.graphics),this._toggleVisibility(!0));e&&(e.moveLatestToFront(),e.drawTracks());c||a._fireUpdateEnd()}}});s("extend-esri")&&n.setObject("layers._RenderMode",d,f);return d})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/lang esri/symbols/jsonUtils esri/layers/RangeDomain esri/layers/CodedValueDomain esri/layers/InheritedDomain esri/layers/FeatureTemplate".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v){l=l(null,{declaredClass:"esri.layers.FeatureType",constructor:function(u){if(u&&d.isObject(u)){this.id=u.id;this.name=u.name;var p=u.symbol;p&&(this.symbol=f.fromJson(p));var p=u.domains,k,g=this.domains={};for(k in p)if(p.hasOwnProperty(k)){var b=p[k];switch(b.type){case "range":g[k]=new c(b);break;case "codedValue":g[k]=new a(b);break;case "inherited":g[k]=new e(b)}}if(k=u.templates){p=this.templates=[];for(u=0;u<k.length;u++)p.push(new v(k[u]))}}},toJson:function(){var a=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,e=this.domains,g=this.templates,b=m.fixJson;if(e){var d=a.domains={};for(c in e)e.hasOwnProperty(c)&&(d[c]=e[c]&&e[c].toJson());b(d)}g&&(a.templates=n.map(g,function(b){return b.toJson()}));return b(a)}});h("extend-esri")&&d.setObject("layers.FeatureType",l,s);return l})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/graphic esri/geometry/Polyline esri/layers/GraphicsLayer".split(" "),
function(l,d,n,h,s,m,f,c){l=l(null,{declaredClass:"esri.layers._TrackManager",constructor:function(a){this.layer=a;this.trackMap={}},initialize:function(a){this.map=a;var e=this.layer,d=e._getRenderer(),d=d&&d.trackRenderer;if("esriGeometryPoint"===e.geometryType){var f=this.container=new c._GraphicsLayer({id:e.id+"_tracks",_child:!0});f.loaded=!0;f.onLoad(f);f._setMap(a,e._div);f.setRenderer(d)}},addFeatures:function(a){var c,d=this.trackMap,f=this.layer,p=f._trackIdField,k,g;n.forEach(a,function(b){k=
b.attributes;c=k[p];g=d[c]=d[c]||[];g.push(b)});var b=f._startTimeField,r=f.objectIdField;a=function(a,c){var g=a.attributes[b],e=c.attributes[b];return g===e?a.attributes[r]<c.attributes[r]?-1:1:g<e?-1:1};for(c in d)d[c].sort(a)},drawTracks:function(){var a=this.container;if(a){var c=this.trackMap,d=this.map.spatialReference,h,p,k,g,b,r=this.layer._trackIdField;for(h in c){p=c[h];k=[];for(g=p.length-1;0<=g;g--)(b=p[g].geometry)&&k.push([b.x,b.y]);p={};p[r]=h;0<k.length&&a.add(new m(new f({paths:[k],
spatialReference:d}),null,p))}}},moveLatestToFront:function(){n.forEach(this.getLatestObservations(),function(a){var c=a._shape;c&&c._moveToFront();this._repaint(a,null,!0)},this.layer)},getLatestObservations:function(){var a=[],c=this.layer._getRenderer(),d=this.trackMap,f;if(!c.latestObservationRenderer)return a;for(f in d)c=d[f],a.push(c[c.length-1]);return a},clearTracks:function(){var a=this.getLatestObservations();this.trackMap={};var c=this.container;c&&c.clear();n.forEach(a,function(a){this._repaint(a,
null,!0)},this.layer)},isLatestObservation:function(a){var c=this.trackMap[a.attributes[this.layer._trackIdField]];return c?c[c.length-1]===a:!1},destroy:function(){var a=this.container;a&&(a.clear(),a._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});h("extend-esri")&&d.setObject("layers._TrackManager",l,s);return l})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/SpatialReference esri/geometry/Extent esri/geometry/Polyline".split(" "),
function(l,d,n,h,s,m,f,c){l=l(null,{declaredClass:"esri.layers._GridLayout",constructor:function(a,c,d,f){this.origin=a;this.cellWidth=c.width;this.cellHeight=c.height;this.mapWidth=d.width;this.mapHeight=d.height;this.srInfo=f},setResolution:function(a){this._resolution=(a.xmax-a.xmin)/this.mapWidth;this.srInfo&&(a=Math.round(2*this.srInfo.valid[1]/this._resolution),a=Math.round(a/this.cellWidth),this._frameStats=[a,0,a-1])},getCellCoordinates:function(a){var c=this._resolution,d=this.origin;return{row:Math.floor((d.y-
a.y)/(this.cellHeight*c)),col:Math.floor((a.x-d.x)/(this.cellWidth*c))}},normalize:function(a){var c=this._frameStats;if(c){var d=c[0],f=c[1],c=c[2];a<f?(a%=d,a=a<f?a+d:a):a>c&&(a%=d)}return a},intersects:function(a,c){var d=this.srInfo;return d?n.some(c._getParts(d),function(c){return a.intersects(c.extent)}):a.intersects(c)},getCellExtent:function(a,c){var d=this._resolution,h=this.origin,p=this.cellWidth,k=this.cellHeight;return new f(c*p*d+h.x,h.y-(a+1)*k*d,(c+1)*p*d+h.x,h.y-a*k*d,new m(h.spatialReference.toJson()))},
getLatticeID:function(a){var c=this.getCellCoordinates({x:a.xmin,y:a.ymax}),d=this.getCellCoordinates({x:a.xmax,y:a.ymin});a=c.row;var f=d.row,c=this.normalize(c.col),d=this.normalize(d.col);return a+"_"+f+"_"+c+"_"+d},sorter:function(a,c){return a<c?-1:1},getCellsInExtent:function(a,d){var f=this.getCellCoordinates({x:a.xmin,y:a.ymax}),h=this.getCellCoordinates({x:a.xmax,y:a.ymin}),p=f.row,k=h.row,f=f.col,h=h.col,g=[],b,r,t,q=[],x=[],z,m,w,A=[];for(b=p;b<=k;b++)for(r=f;r<=h;r++)t=this.normalize(r),
a=this.getCellExtent(b,t),g.push({row:b,col:t,extent:a,resolution:this._resolution}),d&&(q.push(a.xmin,a.xmax),x.push(a.ymin,a.ymax));f=this.normalize(f);h=this.normalize(h);q.sort(this.sorter);x.sort(this.sorter);r=q.length;for(b=r-1;0<=b;b--)b<r-1&&q[b]===q[b+1]&&q.splice(b,1);r=x.length;for(b=r-1;0<=b;b--)b<r-1&&x[b]===x[b+1]&&x.splice(b,1);if(q.length&&x.length){t=q[0];z=q[q.length-1];m=x[0];w=x[x.length-1];r=q.length;for(b=0;b<r;b++)A.push([[q[b],w],[q[b],m]]);r=x.length;for(b=0;b<r;b++)A.push([[t,
x[b]],[z,x[b]]]);b=new c({paths:A,spatialReference:this.origin.spatialReference.toJson()});g.push({latticeID:p+"_"+k+"_"+f+"_"+h,lattice:b,resolution:this._resolution})}return{minRow:p,maxRow:k,minCol:f,maxCol:h,cells:g}}});h("extend-esri")&&d.setObject("layers._GridLayout",l,s);return l})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(l,d,n){var h={};l.setObject("dojo.data.util.simpleFetch",h);h.errorHandler=function(h,m){m.onError&&
m.onError.call(m.scope||d.global,h,m)};h.fetchHandler=function(h,m){var f=m.abort||null,c=!1,a=m.start?m.start:0,e=m.count&&Infinity!==m.count?a+m.count:h.length;m.abort=function(){c=!0;f&&f.call(m)};var l=m.scope||d.global;m.store||(m.store=this);m.onBegin&&m.onBegin.call(l,h.length,m);m.sort&&h.sort(n.createSortFunction(m.sort,this));if(m.onItem)for(var u=a;u<h.length&&u<e;++u){var p=h[u];c||m.onItem.call(l,p,m)}m.onComplete&&!c&&(u=null,m.onItem||(u=h.slice(a,e)),m.onComplete.call(l,u,m))};h.fetch=
function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,l.hitch(this,"fetchHandler"),l.hitch(this,"errorHandler"));return d};return h})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(l,d,n,h,s,m){d=d("dojox.data.CsvStore",null,{constructor:function(d){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=
!1;d.url&&(this.url=d.url);this._csvData=d.data;d.label?this.label=d.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=d.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in d&&(this.separator=d.separator);"urlPreventCache"in d&&(this.urlPreventCache=d.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",
separator:",",urlPreventCache:!1,_assertIsItem:function(d){if(!this.isItem(d))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(d){d=this.getIdentity(d);this.identifier&&(d=this._idMap[d]);return d},getValue:function(d,c,a){this._assertIsItem(d);var e=a;if("string"===typeof c)c=this._attributeIndexes[c],null!=c&&(e=this._dataArray[this._getIndex(d)][c]||a);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
return e},getValues:function(d,c){var a=this.getValue(d,c);return a?[a]:[]},getAttributes:function(d){this._assertIsItem(d);var c=[];d=this._dataArray[this._getIndex(d)];for(var a=0;a<d.length;a++)""!==d[a]&&c.push(this._attributes[a]);return c},hasAttribute:function(d,c){this._assertIsItem(d);if("string"===typeof c){var a=this._attributeIndexes[c],e=this._dataArray[this._getIndex(d)];return"undefined"!==typeof a&&a<e.length&&""!==e[a]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
},containsValue:function(d,c,a){var e=void 0;"string"===typeof a&&(e=s.patternToRegExp(a,!1));return this._containsValue(d,c,a,e)},_containsValue:function(d,c,a,e){d=this.getValues(d,c);for(c=0;c<d.length;++c){var h=d[c];if("string"===typeof h&&e)return null!==h.match(e);if(a===h)return!0}return!1},isItem:function(d){if(d&&d[this._storeProp]===this)if(d=d[this._idProp],this.identifier){if(this._dataArray[this._idMap[d]])return!0}else if(0<=d&&d<this._dataArray.length)return!0;return!1},isItemLoaded:function(d){return this.isItem(d)},
loadItem:function(d){},getFeatures:function(){return this._features},getLabel:function(d){if(this.label&&this.isItem(d))return this.getValue(d,this.label)},getLabelAttributes:function(d){return this.label?[this.label]:null},_fetchItems:function(d,c,a){var e=this,h=function(b,a){var d=null;if(b.query){var g,k,d=[],f=b.queryOptions?b.queryOptions.ignoreCase:!1,p={};for(g in b.query)k=b.query[g],"string"===typeof k&&(p[g]=s.patternToRegExp(k,f));for(f=0;f<a.length;++f){var w=!0,h=a[f];for(g in b.query)k=
b.query[g],e._containsValue(h,g,k,p[g])||(w=!1);w&&d.push(h)}}else d=a.slice(0,a.length);c(d,b)};if(this._loadFinished)h(d,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:d,filter:h});else{this._loadInProgress=!0;var m=n.get({url:e.url,handleAs:"text",preventCache:e.urlPreventCache});m.addCallback(function(b){try{e._processData(b),h(d,e._arrayOfAllItems),e._handleQueuedFetches()}catch(c){a(c,d)}});m.addErrback(function(b){e._loadInProgress=!1;if(a)a(b,
d);else throw b;});var p=null;d.abort&&(p=d.abort);d.abort=function(){m&&-1===m.fired&&m.cancel();p&&p.call(d)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,h(d,this._arrayOfAllItems)}catch(k){a(k,d)}else{var g=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(a)a(g,d);else throw g;}},close:function(d){},_getArrayOfArraysFromCsvFileContents:function(d){if(l.isString(d)){var c=RegExp("^\\s+","g"),a=RegExp("\\s+$","g"),
e=RegExp('""',"g"),h=[],m=this._splitLines(d);for(d=0;d<m.length;++d){var p=m[d];if(0<p.length){for(var p=p.split(this.separator),k=0;k<p.length;){var g=p[k].replace(c,""),b=g.replace(a,""),r=b.charAt(0),t=b.charAt(b.length-1),q=b.charAt(b.length-2),x=b.charAt(b.length-3);if(2===b.length&&'""'==b)p[k]="";else if('"'==r&&('"'!=t||'"'==t&&'"'==q&&'"'!=x)){if(k+1===p.length)return;p[k]=g+this.separator+p[k+1];p.splice(k+1,1)}else'"'==r&&'"'==t&&(b=b.slice(1,b.length-1),b=b.replace(e,'"')),p[k]=b,k+=
1}h.push(p)}}this._attributes=h.shift();for(d=0;d<this._attributes.length;d++)this._attributeIndexes[this._attributes[d]]=d;this._dataArray=h}},_splitLines:function(d){var c=[],a,e="",h=!1;for(a=0;a<d.length;a++){var m=d.charAt(a);switch(m){case '"':h=!h;e+=m;break;case "\r":h?e+=m:(c.push(e),e="",a<d.length-1&&"\n"==d.charAt(a+1)&&a++);break;case "\n":h?e+=m:(c.push(e),e="");break;default:e+=m}}""!==e&&c.push(e);return c},_processData:function(d){this._getArrayOfArraysFromCsvFileContents(d);this._arrayOfAllItems=
[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(d=0;d<this._dataArray.length;d++){var c=d;this.identifier&&(c=this._dataArray[d][this._attributeIndexes[this.identifier]],this._idMap[c]=d);this._arrayOfAllItems.push(this._createItemFromIdentity(c))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(d){var c={};c[this._storeProp]=this;c[this._idProp]=
d;return c},getIdentity:function(d){return this.isItem(d)?d[this._idProp]:null},fetchItemByIdentity:function(d){var c,a=d.scope?d.scope:h.global;if(this._loadFinished)c=this._createItemFromIdentity(d.identity),this.isItem(c)||(c=null),d.onItem&&d.onItem.call(a,c);else{var e=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:d}):(this._loadInProgress=!0,c=n.get({url:e.url,handleAs:"text"}),c.addCallback(function(c){try{e._processData(c);var h=e._createItemFromIdentity(d.identity);
e.isItem(h)||(h=null);d.onItem&&d.onItem.call(a,h);e._handleQueuedFetches()}catch(k){d.onError&&d.onError.call(a,k)}}),c.addErrback(function(c){this._loadInProgress=!1;d.onError&&d.onError.call(a,c)}));else if(this._csvData)try{e._processData(e._csvData),e._csvData=null,c=e._createItemFromIdentity(d.identity),e.isItem(c)||(c=null),d.onItem&&d.onItem.call(a,c)}catch(m){d.onError&&d.onError.call(a,m)}}},getIdentityAttributes:function(d){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<
this._queuedFetches.length){for(var d=0;d<this._queuedFetches.length;d++){var c=this._queuedFetches[d],a=c.filter,e=c.args;a?a(e,this._arrayOfAllItems):this.fetchItemByIdentity(c.args)}this._queuedFetches=[]}}});l.extend(d,m);return d})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(l,d,n,h,s){l=l(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,
outputPixelType:null,constructor:function(h){d.isObject(h)&&(d.mixin(this,h),h.rasterFunction&&(this.functionName=h.rasterFunction),h.rasterFunctionArguments?this.functionArguments=h.rasterFunctionArguments:h.arguments&&(this.functionArguments=h.arguments))},toJson:function(){return s.filter({rasterFunction:this.functionName,rasterFunctionArguments:this.functionArguments||this.arguments,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(d){if(null!==
d&&void 0!==d)return!0})}});n("extend-esri")&&d.setObject("layers.RasterFunction",l,h);return l})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(l,d){var n={};l.setObject("dojo.date.stamp",n);n.fromISOString=function(h,l){n._isoRegExp||(n._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var m=n._isoRegExp.exec(h),f=null;if(m){m.shift();m[1]&&m[1]--;m[6]&&(m[6]*=1E3);l&&(l=new Date(l),d.forEach(d.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(a){return l["get"+a]()}),function(a,c){m[c]=m[c]||a}));f=new Date(m[0]||1970,m[1]||0,m[2]||1,m[3]||0,m[4]||0,m[5]||0,m[6]||0);100>m[0]&&f.setFullYear(m[0]||1970);var c=0,a=m[7]&&m[7].charAt(0);"Z"!=a&&(c=60*(m[8]||0)+(Number(m[9])||0),"-"!=a&&(c*=-1));a&&(c-=f.getTimezoneOffset());c&&f.setTime(f.getTime()+6E4*c)}return f};n.toISOString=function(d,l){var m=function(a){return 10>a?"0"+a:a};l=l||{};var f=[],c=l.zulu?"getUTC":"get",a="";"time"!=l.selector&&(a=d[c+"FullYear"](),a=["0000".substr((a+
"").length)+a,m(d[c+"Month"]()+1),m(d[c+"Date"]())].join("-"));f.push(a);if("date"!=l.selector){a=[m(d[c+"Hours"]()),m(d[c+"Minutes"]()),m(d[c+"Seconds"]())].join(":");c=d[c+"Milliseconds"]();l.milliseconds&&(a+="."+(100>c?"0":"")+m(c));if(l.zulu)a+="Z";else if("time"!=l.selector)var c=d.getTimezoneOffset(),e=Math.abs(c),a=a+((0<c?"-":"+")+m(Math.floor(e/60))+":"+m(e%60));f.push(a)}return f.join("T")};return n})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),
function(l,d,n,h,s,m,f){m.extend(l,{waiRole:"",waiState:""});return s("dijit._Templated",[d,n],{widgetsInTemplate:!1,constructor:function(){f.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(c,a){var d=this.inherited(arguments),f=a(c,"waiRole");f&&c.setAttribute("role",f);(f=a(c,"waiState"))&&h.forEach(f.split(/\s*,\s*/),function(a){-1!=a.indexOf("-")&&(a=a.split("-"),c.setAttribute("aria-"+
a[0],a[1]))});return d}})})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated esri/kernel esri/dijit/_EventedWidget dojo/i18n!esri/nls/jsapi dojo/NodeList-dom".split(" "),function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r,t){var q=0;d=d([r,k,g],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=
h.mixin({},t.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);var b=this.template,c=this.graphic,d=b.getComponents(c),g=this.showTitle?d.title:"",k=d.description,r=d.fields,q=d.mediaInfos,f=this.domNode,t=this._nls;this._prevMedia.title=t.NLS_prevMedia;this._nextMedia.title=t.NLS_nextMedia;e.set(this._title,"innerHTML",g);g||v.add(this._title,"hidden");!k&&r&&(k="",s.forEach(r,function(b){k+="\x3ctr valign\x3d'top'\x3e";k+="\x3ctd class\x3d'attrName'\x3e"+b[0]+"\x3c/td\x3e";k+="\x3ctd class\x3d'attrValue'\x3e"+
b[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+t.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";k+="\x3c/tr\x3e"}),k&&(k="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+k+"\x3c/table\x3e"));e.set(this._description,"innerHTML",k);k||v.add(this._description,"hidden");m.query("a",this._description).forEach(function(b){e.set(b,"target","_blank")});g&&k?m.query(".mainSection .hzLine",f).removeClass("hidden"):g||k?m.query(".mainSection .hzLine",
f).addClass("hidden"):m.query(".mainSection",f).addClass("hidden");if(b=this._dfd=b.getAttachments(c))b.addBoth(h.hitch(this,this._attListHandler,b)),e.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+t.NLS_searching+"...\x3c/li\x3e"),m.query(".attachmentsSection",f).removeClass("hidden");q&&q.length&&(m.query(".mediaSection",f).removeClass("hidden"),a.setSelectable(this._mediaFrame,!1),this._mediaInfos=q,this._mediaPtr=0,this._updateUI(),this._displayMedia());d.editSummary&&(e.set(this._editSummary,
"innerHTML",d.editSummary),q&&q.length&&v.remove(this._mediaBreak,"hidden"),v.remove(this._editSummarySection,"hidden"))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),
this._displayMedia())},_updateUI:function(){var b=this._mediaInfos,a=b.length,c=this.domNode,d=this._prevMedia,g=this._nextMedia;if(1<a){var k=0,r=0;s.forEach(b,function(b){"image"===b.type?k++:-1!==b.type.indexOf("chart")&&r++});k&&(e.set(this._imageCount,"innerHTML",k),m.query(".summary .image",c).removeClass("hidden"));r&&(e.set(this._chartCount,"innerHTML",r),m.query(".summary .chart",c).removeClass("hidden"))}else m.query(".summary",c).addClass("hidden"),v.add(d,"hidden"),v.add(g,"hidden");b=
this._mediaPtr;0===b?v.add(d,"hidden"):v.remove(d,"hidden");b===a-1?v.add(g,"hidden"):v.remove(g,"hidden");this._destroyFrame()},_displayMedia:function(){var b=this._mediaInfos[this._mediaPtr],a=b.title,c=b.caption,d=m.query(".mediaSection .hzLine",this.domNode)[0];e.set(this._mediaTitle,"innerHTML",a);v[a?"remove":"add"](this._mediaTitle,"hidden");e.set(this._mediaCaption,"innerHTML",c);v[c?"remove":"add"](this._mediaCaption,"hidden");v[a&&c?"remove":"add"](d,"hidden");this._rid=null;if("image"===
b.type)this._showImage(b.value);else{var g=this,a=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],c=b.value.theme||this.chartTheme||"esri/dijit/Rainbow";h.isString(c)&&(c=c.replace(/\./gi,"/"),-1===c.indexOf("/")&&(c="dojox/charting/themes/"+c),a.push(c));try{var k=this._rid=q++;l(a,function(a,c,d){k===g._rid&&(g._rid=null,g._showChart(b.type,b.value,a,c,d))})}catch(r){console.log("PopupRenderer: error loading modules")}}},_showImage:function(b){v.add(this._mediaFrame,"image");var a=
p.get(this._gallery,"height"),c="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+b.sourceURL+"' /\x3e";b.linkURL&&(c="\x3ca target\x3d'_blank' href\x3d'"+b.linkURL+"'\x3e"+c+"\x3c/a\x3e");e.set(this._mediaFrame,"innerHTML",c);var d=m.query(".esriPopupMediaImage",this._mediaFrame)[0],g=this,k;k=n.connect(d,"onload",function(){n.disconnect(k);k=null;g._imageLoaded(d,a)})},_showChart:function(b,a,c,d,g){v.remove(this._mediaFrame,"image");c=this._chart=new c(u.create("div",{"class":"chart"},this._mediaFrame),
{margins:{l:4,t:4,r:4,b:4}});g&&c.setTheme(g);switch(b){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",a.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});s.forEach(a.fields,function(b,a){b.x=a+1});c.addSeries("Series A",a.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",gap:3});c.addAxis("y",
{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",a.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",a.fields)}this._action=new d(c);c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=
null);e.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(b,a){var c=b.height;c<a&&(c=Math.round((a-c)/2),p.set(b,"marginTop",c+"px"))},_attListHandler:function(b,a){if(b===this._dfd){this._dfd=null;var c="";!(a instanceof Error)&&(a&&a.length)&&s.forEach(a,function(b){c+="\x3cli\x3e";c+="\x3ca href\x3d'"+b.url+"' target\x3d'_blank'\x3e"+(b.name||"[No name]")+"\x3c/a\x3e";c+="\x3c/li\x3e"});e.set(this._attachmentsList,"innerHTML",c||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}}});
f("extend-esri")&&h.setObject("dijit._PopupRenderer",d,b);return d})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(l){var d={};l.setObject("dojo.data.util.sorter",d);d.basicComparator=function(d,h){var l=-1;null===d&&(d=void 0);null===h&&(h=void 0);if(d==h)l=0;else if(d>h||null==d)l=1;return l};d.createSortFunction=function(l,h){function s(a,c,d,b){return function(e,f){var q=b.getValue(e,a),h=b.getValue(f,a);return c*d(q,h)}}for(var m=[],f,c=h.comparatorMap,a=d.basicComparator,
e=0;e<l.length;e++){f=l[e];var v=f.attribute;if(v){f=f.descending?-1:1;var u=a;c&&("string"!==typeof v&&"toString"in v&&(v=v.toString()),u=c[v]||a);m.push(s(v,f,u,h))}}return function(a,c){for(var d=0;d<m.length;){var b=m[d++](a,c);if(0!==b)return b}return 0}};return d})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style esri/kernel esri/config esri/sniff esri/domUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/layers/layer".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p){var k=l([p],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(a){this.inherited(arguments,[null,a]);this._mapImages=[];var b=n.hitch;this._panStart=b(this,this._panStart);this._pan=b(this,this._pan);this._extentChange=b(this,this._extentChange);this._zoom=b(this,this._zoom);this._zoomStart=b(this,this._zoomStart);this._scale=b(this,this._scale);this._resize=b(this,this._resize);d.connect(this,"onSuspend",this,this._onSuspend);
d.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},opacity:1,_transform:f._getDOMAccessor("transform"),addImage:function(a){var b=this._mapImages.push(a),b=b-1;a._idx=b;a._layer=this;this._div&&this._createImage(a,b)},removeImage:function(a){if(a){var b=a._idx,c=this._mapImages;if(c[b]===a){delete c[b];if(b=a._node)this._clearEvents(b),b.e_idx=b.e_bl=b.e_tr=b.e_l=b.e_t=b.e_w=b.e_h=null,b.parentNode&&(b.parentNode.removeChild(b),s.destroy(b));a._node=a._idx=a._layer=null}}},
removeAllImages:function(){var a=this._mapImages,b,c=a.length;for(b=0;b<c;b++){var d=a[b];d&&this.removeImage(d)}this._mapImages=[]},getImages:function(){var a=this._mapImages,b=[],c,d=a.length;for(c=0;c<d;c++)a[c]&&b.push(a[c]);return b},setOpacity:function(a){this.opacity!=a&&(this._opacityChanged(this.opacity=a),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(c){var b=this._div,d,e;if(b)if(!a("ie")||8<a("ie"))m.set(b,"opacity",c);else{e=b.childNodes;d=e.length;for(b=
0;b<d;b++)m.set(e[b],"opacity",c)}},_createImage:function(c,b){var e=s.create("img");m.set(e,{position:"absolute"});8>=a("ie")&&m.set(e,"opacity",this.opacity);if(c.rotation){var f="rotate("+(360-c.rotation)+"deg)";9>a("ie")||(m.set(e,this._transform,f),m.set(e,"transform",f))}c._node=e;e.e_idx=b;e.e_layer=this;e.e_load=d.connect(e,"onload",k.prototype._imageLoaded);e.e_error=d.connect(e,"onerror",k.prototype._imageError);e.e_abort=d.connect(e,"onabort",k.prototype._imageError);e.src=c.href},_imageLoaded:function(a,
b){var c=b||a.target||a.currentTarget,d=c.e_layer,e=d._mapImages[c.e_idx],k=d._map;k&&(k.__zooming||k.__panning||!d._sr)?d._standby.push(c):(d._clearEvents(c),e&&e._node===c&&k&&d._attach(e))},_imageError:function(a){a=a.target||a.currentTarget;var b=a.e_layer,c=b._mapImages[a.e_idx];b._clearEvents(a);c&&(c._node=null)},_clearEvents:function(a){var b=d.disconnect;b(a.e_load);b(a.e_error);b(a.e_abort);a.e_load=a.e_error=a.e_abort=a.e_layer=null},_attach:function(a){var b=a.extent,c=b.spatialReference,
d=this._sr,e=this._div,k=a._node,f=new v({x:b.xmin,y:b.ymin,spatialReference:c}),b=new v({x:b.xmax,y:b.ymax,spatialReference:c});d.equals(c)||(d.isWebMercator()&&4326===c.wkid?(f=u.geographicToWebMercator(f),b=u.geographicToWebMercator(b)):c.isWebMercator()&&4326===d.wkid&&(f=u.webMercatorToGeographic(f),b=u.webMercatorToGeographic(b)));k.e_bl=f;k.e_tr=b;a.visible&&(this._setPos(k,e._left,e._top),(this._active||e).appendChild(k))},_setPos:function(a,b,c){var d=a.e_bl,e=a.e_tr,k=this._map,d=k.toScreen(d),
e=k.toScreen(e);b=d.x-b;c=e.y-c;var h=Math.abs(e.x-d.x),d=Math.abs(d.y-e.y),e={width:h+"px",height:d+"px"},p=this._mapImages[a.e_idx];"css-transforms"===k.navigationMode?e[f._css.names.transform]=f._css.translate(b,c)+(p.rotation?" "+f._css.rotate(360-p.rotation):""):(e.left=b+"px",e.top=c+"px");m.set(a,e);a.e_l=b;a.e_t=c;a.e_w=h;a.e_h=d},managedSuspension:!0,_setMap:function(c,b){this.inherited(arguments);var d=this._div=s.create("div",null,b),k=f._css.names,q={position:"absolute"},h=c.__visibleDelta;
if(!a("ie")||8<a("ie"))q.opacity=this.opacity;"css-transforms"===c.navigationMode?(q[k.transform]=f._css.translate(h.x,h.y),m.set(d,q),d._left=h.x,d._top=h.y,q={position:"absolute",width:c.width+"px",height:c.height+"px",overflow:"visible"},this._active=s.create("div",null,d),m.set(this._active,q),this._passive=s.create("div",null,d),m.set(this._passive,q)):(d._left=0,d._top=0,m.set(d,q));this._standby=[];k=this._mapImages;h=k.length;for(q=0;q<h;q++){var p=k[q];p._node||this._createImage(p,p._idx)}e.hide(d);
return d},_unsetMap:function(a,b){this._disconnect();var c=this._div;if(c){var d=this._mapImages,e,k=d.length;for(e=0;e<k;e++){var f=d[e];if(f){var h=f._node;h&&(this._clearEvents(h),h.e_idx=h.e_bl=h.e_tr=h.e_l=h.e_t=h.e_w=h.e_h=null);f._node=null}}b.removeChild(c);s.destroy(c)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();e.hide(this._div)},_onResume:function(a){a.firstOccurrence&&(this._sr=this._map.spatialReference,
this._processStandbyList());a=this._map;var b=this._div,c=a.__visibleDelta;"css-transforms"===a.navigationMode&&(b._left=c.x,b._top=c.y,m.set(b,f._css.names.transform,f._css.translate(b._left,b._top)));this._redraw("css-transforms"===a.navigationMode);this._connect(a);e.show(b)},_connect:function(a){if(!this._connections){var b=d.connect,c="css-transforms"===a.navigationMode;this._connections=[b(a,"onPanStart",this._panStart),b(a,"onPan",this._pan),b(a,"onExtentChange",this._extentChange),c&&b(a,
"onZoomStart",this._zoomStart),c?b(a,"onScale",this._scale):b(a,"onZoom",this._zoom),c&&b(a,"onResize",this._resize)]}},_disconnect:function(){this._connections&&(h.forEach(this._connections,d.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(a,b){var c=this._div;c._left=this._panL+b.x;c._top=this._panT+b.y;"css-transforms"===this._map.navigationMode?m.set(c,f._css.names.transform,f._css.translate(c._left,c._top)):m.set(c,
{left:c._left+"px",top:c._top+"px"})},_extentChange:function(a,b,c){c?this._redraw("css-transforms"===this._map.navigationMode):b&&this._pan(a,b);this._processStandbyList()},_processStandbyList:function(){var a,b=this._standby;if(b&&b.length)for(a=b.length-1;0<=a;a--)this._imageLoaded(null,b[a]),b.splice(a,1)},_redraw:function(a){if(a){a=this._passive;var b=f._css.names;m.set(a,b.transition,"none");this._moveImages(a,this._active);m.set(a,b.transform,"none")}a=this._active||this._div;var b=this._div._left,
c=this._div._top,d,e=a.childNodes.length,k;for(d=0;d<e;d++)k=a.childNodes[d],this._setPos(k,b,c)},_zoom:function(a,b,c){a=this._div;var d=a._left,e=a._top,k,f=a.childNodes.length,h;for(k=0;k<f;k++){h=a.childNodes[k];var p=h.e_w*b,l=h.e_h*b,y=(c.x-d-h.e_l)*(p-h.e_w)/h.e_w,n=(c.y-e-h.e_t)*(l-h.e_h)/h.e_h,y=isNaN(y)?0:y,n=isNaN(n)?0:n;m.set(h,{left:h.e_l-y+"px",top:h.e_t-n+"px",width:p+"px",height:l+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(a,b){var c=
a.childNodes,d;d=c.length;if(0<d)for(d-=1;0<=d;d--)b.appendChild(c[d])},_scale:function(a,b){var d=f._css.names,e=this._passive;m.set(e,d.transition,b?"none":d.transformName+" "+c.defaults.map.zoomDuration+"ms ease");f._css.matrix(a);m.set(e,d.transform,f._css.matrix(a))},_resize:function(a,b,c){m.set(this._active,{width:b+"px",height:c+"px"});m.set(this._passive,{width:b+"px",height:c+"px"})}});a("extend-esri")&&n.setObject("layers.MapImageLayer",k,f);return k})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/layers/MapImage".split(" "),
function(l,d,n,h,s,m){l=l([m],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(d){s.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});n("extend-esri")&&d.setObject("layers.KMLGroundOverlay",l,h);return l})},"esri/tasks/SpatialRelationship":function(){define(["dojo/_base/lang","dojo/has","esri/kernel"],function(l,d,n){var h={SPATIAL_REL_INTERSECTS:"esriSpatialRelIntersects",SPATIAL_REL_CONTAINS:"esriSpatialRelContains",SPATIAL_REL_CROSSES:"esriSpatialRelCrosses",SPATIAL_REL_ENVELOPEINTERSECTS:"esriSpatialRelEnvelopeIntersects",
SPATIAL_REL_INDEXINTERSECTS:"esriSpatialRelIndexIntersects",SPATIAL_REL_OVERLAPS:"esriSpatialRelOverlaps",SPATIAL_REL_TOUCHES:"esriSpatialRelTouches",SPATIAL_REL_WITHIN:"esriSpatialRelWithin",SPATIAL_REL_RELATION:"esriSpatialRelRelation"};d("extend-esri")&&l.setObject("tasks._SpatialRelationship",h,n);return h})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(l,
d,n,h,s,m,f,c,a){var e=s.delegate(c,{mouseenter:m.enter,mouseleave:m.leave,keypress:n._keypress}),v;n=h("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var c=a;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(a,c){return a.getAttribute(c)},this._attach)||this.searchContainerNode)&&
c.firstChild)c=c.firstChild;else{if(c==a)break;for(;!c.nextSibling;)if(c=c.parentNode,c==a)return;c=c.nextSibling}},_processTemplateNode:function(a,c,d){var e=!0,b=this.attachScope||this,f=c(a,"dojoAttachPoint")||c(a,"data-dojo-attach-point");if(f)for(var h=f.split(/\s*,\s*/);f=h.shift();)s.isArray(b[f])?b[f].push(a):b[f]=a,e="containerNode"!=f,this._attachPoints.push(f);if(c=c(a,"dojoAttachEvent")||c(a,"data-dojo-attach-event")){f=c.split(/\s*,\s*/);for(h=s.trim;c=f.shift();)if(c){var q=null;-1!=
c.indexOf(":")?(q=c.split(":"),c=h(q[0]),q=h(q[1])):c=h(c);q||(q=c);this._attachEvents.push(d(a,c,s.hitch(b,q)))}}return e},_attach:function(a,c,d){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?v||(v=l("./a11yclick")):e[c]||c;return f(a,c,d)},_detachTemplateNodes:function(){var a=this.attachScope||this;d.forEach(this._attachPoints,function(c){delete a[c]});this._attachPoints=[];d.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});s.extend(a,{dojoAttachEvent:"",dojoAttachPoint:""});return n})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/has dojo/string esri/kernel esri/urlUtils esri/SpatialReference esri/geometry/Extent esri/layers/TiledMapServiceLayer esri/layers/TileInfo".split(" "),function(l,d,n,h,s,m,f,c,a,e,v,u){l=l(v,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(c,d){d||(d={});this.urlTemplate=c;
var g=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new a({wkid:102100})),b=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new a({wkid:102100}));this.initialExtent=d.initialExtent||g;this.fullExtent=d.fullExtent||b;this.tileInfo=d.tileInfo?d.tileInfo:new u({rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new a(this.tileInfo.spatialReference.toJson());this.copyright=d.copyright||"";var f=new h(c),g=f.scheme+"://"+f.authority+"/";this.urlPath=c.substring(g.length);this.tileServers=d.tileServers||[];-1===f.authority.indexOf("{subDomain}")&&this.tileServers.push(g);if(d.subDomains&&0<d.subDomains.length&&1<f.authority.split(".").length){this.subDomains=d.subDomains;var t;n.forEach(d.subDomains,function(b,
a){-1<f.authority.indexOf("${subDomain}")?t=f.scheme+"://"+m.substitute(f.authority,{subDomain:b})+"/":-1<f.authority.indexOf("{subDomain}")&&(t=f.scheme+"://"+f.authority.replace(/\{subDomain\}/gi,b)+"/");this.tileServers.push(t)},this)}this.tileServers=n.map(this.tileServers,function(b){"/"!==b.charAt(b.length-1)&&(b+="/");return b});this._levelToLevelValue=[];n.forEach(this.tileInfo.lods,function(b){this._levelToLevelValue[b.level]=b.levelValue||b.level},this);this.loaded=!0;this.onLoad(this)},
getTileUrl:function(a,d,e){a=this._levelToLevelValue[a];var b=this.tileServers[d%this.tileServers.length]+m.substitute(this.urlPath,{level:a,col:e,row:d}),b=b.replace(/\{level\}/gi,a).replace(/\{row\}/gi,d).replace(/\{col\}/gi,e),b=this.addTimestampToURL(b);return c.addProxy(b)}});s("extend-esri")&&d.setObject("layers.WebTiledLayer",l,f);return l})},"dojo/promise/all":function(){define(["../_base/array","../Deferred","../when"],function(l,d,n){var h=l.some;return function(l){var m,f;l instanceof Array?
f=l:l&&"object"===typeof l&&(m=l);var c,a=[];if(m){f=[];for(var e in m)Object.hasOwnProperty.call(m,e)&&(a.push(e),f.push(m[e]));c={}}else f&&(c=[]);if(!f||!f.length)return(new d).resolve(c);var v=new d;v.promise.always(function(){c=a=null});var u=f.length;h(f,function(d,e){m||a.push(e);n(d,function(d){v.isFulfilled()||(c[a[e]]=d,0===--u&&v.resolve(c))},v.reject);return v.isFulfilled()});return v.promise}})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/SpatialReference esri/tasks/query esri/layers/RenderMode".split(" "),
function(l,d,n,h,s,m,f){l=l([f],{declaredClass:"esri.layers._SnapshotMode",constructor:function(c){this.featureLayer=c;this._featureMap={};this._drawFeatures=d.hitch(this,this._drawFeatures);this._queryErrorHandler=d.hitch(this,this._queryErrorHandler)},startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(c){this._init&&(c?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(c){var a=c.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(a,c);this._incRefCount(a)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var c=this.featureLayer;c._collection?(c._fireUpdateStart(),c._refresh(!0),c._fireUpdateEnd()):this._fetchAll()},_getRequestId:function(c){return("_"+c.name+c.layerId+c._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var c=this.featureLayer;
!c._collection&&!c.suspended&&(c._fireUpdateStart(),this._clearIIf(),this._sendRequest())},_sendRequest:function(){var c=this.map,a=this.featureLayer,d=a.getDefinitionExpression(),f=new m;f.outFields=a.getOutFields();f.where=d||"1\x3d1";f.returnGeometry=!0;f.outSpatialReference=new s(c.spatialReference.toJson());f.timeExtent=a.getTimeDefinition();f.maxAllowableOffset=a._maxOffset;a._ts&&(f._ts=(new Date).getTime());f.orderByFields=a.supportsAdvancedQueries?a.orderByFields:null;var h;a._usePatch&&
(h=this._getRequestId(a),this._cancelPendingRequest(null,h));a._task.execute(f,this._drawFeatures,this._queryErrorHandler,h)},_drawFeatures:function(c){this._purgeRequests();var a=c.features,d=this.featureLayer,f=d.objectIdField,h,l=a.length,k,g;for(h=0;h<l;h++)k=a[h],g=k.attributes[f],this._addFeatureIIf(g,k),this._incRefCount(g);this._applyTimeFilter(!0);d._fireUpdateEnd(null,c.exceededTransferLimit?{queryLimitExceeded:!0}:null);if(c.exceededTransferLimit)d.onQueryLimitExceeded()},_queryErrorHandler:function(c){this._purgeRequests();
var a=this.featureLayer;a._errorHandler(c);a._fireUpdateEnd(c)}});n("extend-esri")&&d.setObject("layers._SnapshotMode",l,h);return l})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(l,d,n,h,s){l=l([s],{declaredClass:"esri.layers._SelectionMode",constructor:function(d){this.featureLayer=d;this._featureMap={}},propertyChangeHandler:function(d){this._init&&0===d&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});
n("extend-esri")&&d.setObject("layers._SelectionMode",l,h);return l})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/deferredUtils esri/urlUtils esri/Evented".split(" "),function(l,d,n,h,s,m,f,c){l=l(c,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a){a&&d.isString(a)&&(this._url=f.urlToObject(this.url=a));this.normalization=!0;this._errorHandler=d.hitch(this,this._errorHandler);
this.registerConnectEvents()},_useSSL:function(){var a=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));a&&a.path&&(a.path=a.path.replace(c,"https:"))},_encode:function(a,c,f){var h,l,k={},g,b;for(g in a)if("declaredClass"!==g&&(h=a[g],l=typeof h,null!==h&&void 0!==h&&"function"!==l))if(d.isArray(h)){k[g]=[];b=h.length;for(l=0;l<b;l++)k[g][l]=this._encode(h[l])}else"object"===l?h.toJson&&(l=h.toJson(f&&f[g]),"esri.tasks.FeatureSet"===h.declaredClass&&l.spatialReference&&(l.sr=
l.spatialReference,delete l.spatialReference),k[g]=c?l:n.toJson(l)):k[g]=h;return k},_successHandler:function(a,c,d,f){c&&this[c].apply(this,a);d&&d.apply(null,a);f&&m._resDfd(f,a)},_errorHandler:function(a,c,d){this.onError(a);c&&c(a);d&&d.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});h("extend-esri")&&(s.Task=l);return l})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(l,d,n){l.DeferredList=function(h,
l,m,f,c){var a=[];d.call(this);var e=this;0===h.length&&!l&&this.resolve([0,[]]);var v=0;n.forEach(h,function(c,d){function k(c,b){a[d]=[c,b];v++;v===h.length&&e.resolve(a)}c.then(function(a){l?e.resolve([d,a]):k(!0,a)},function(a){m?e.reject(a):k(!1,a);if(f)return null;throw a;})})};l.DeferredList.prototype=new d;l.DeferredList.prototype.gatherResults=function(d){d=new l.DeferredList(d,!1,!0,!1);d.addCallback(function(d){var h=[];n.forEach(d,function(d){h.push(d[1])});return h});return d};return l.DeferredList})},
"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(l,d,n,h,s,m){l=h("dijit._OnDijitClickMixin",null,{connect:function(d,c,a){return this.inherited(arguments,[d,"ondijitclick"==c?m:c,a])}});l.a11yclick=m;return l})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(l,d,n,h){function s(c){if((c.keyCode===l.ENTER||c.keyCode===l.SPACE)&&!/input|button|textarea/i.test(c.target.nodeName))for(c=
c.target;c;c=c.parentNode)if(c.dojoClick)return!0}var m;n(document,"keydown",function(c){s(c)?(m=c.target,c.preventDefault()):m=null});n(document,"keyup",function(c){s(c)&&c.target==m&&(m=null,n.emit(c.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,metaKey:c.metaKey,altKey:c.altKey,_origType:c.type}))});var f=function(c,a){c.dojoClick=!0;return n(c,"click",a)};f.click=f;f.press=function(c,a){var e=n(c,h.press,function(c){("mousedown"!=c.type||d.isLeft(c))&&a(c)}),f=
n(c,"keydown",function(c){(c.keyCode===l.ENTER||c.keyCode===l.SPACE)&&a(c)});return{remove:function(){e.remove();f.remove()}}};f.release=function(c,a){var e=n(c,h.release,function(c){("mouseup"!=c.type||d.isLeft(c))&&a(c)}),f=n(c,"keyup",function(c){(c.keyCode===l.ENTER||c.keyCode===l.SPACE)&&a(c)});return{remove:function(){e.remove();f.remove()}}};f.move=h.move;return f})},"esri/layers/WMSLayer":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/request esri/urlUtils esri/SpatialReference esri/geometry/Extent esri/layers/DynamicMapServiceLayer esri/layers/WMSLayerInfo dojo/query".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p){n=n([u],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,
3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(c,d){this.url=c=this._stripParameters(c,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=a.urlToObject(c);this._getCapabilitiesURL=c;this._initLayer=h.hitch(this,this._initLayer);this._parseCapabilities=h.hitch(this,this._parseCapabilities);this._getCapabilitiesError=h.hitch(this,this._getCapabilitiesError);d?(this.imageFormat=this._getImageFormat(d.format),this.imageTransparency=!1===d.transparent?!1:!0,this.visibleLayers=d.visibleLayers?d.visibleLayers:[],d.resourceInfo?this._readResourceInfo(d.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=
!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=l.toUrl("esri/layers")+"/../images/pixel.png"},setVisibleLayers:function(a){this.visibleLayers=(a=this._checkVisibleLayersList(a))?a:[];this.refresh(!0)},setImageFormat:function(a){this.imageFormat=this._getImageFormat(a);this.refresh(!0)},setImageTransparency:function(a){this.imageTransparency=a;this.refresh(!0)},getImageUrl:function(c,d,b,e){if(!this.visibleLayers||0===this.visibleLayers.length)e(this._blankImageURL);else{var f=
c.spatialReference.wkid;if(s.some(this._WEB_MERCATOR,function(b){return b==f})){var h=s.filter(this.spatialReferences,function(b){return s.some(this._WEB_MERCATOR,function(a){return a==b})},this);0==h.length&&(h=s.filter(this.spatialReferences,function(b){return s.some(this._WORLD_MERCATOR,function(a){return a==b})},this));f=0<h.length?h[0]:this._WEB_MERCATOR[0]}this.spatialReferences=s.filter(this.spatialReferences,function(b){return b!==f});this.spatialReferences.unshift(f);var h=c.xmin,l=c.xmax,
p=c.ymin,m=c.ymax;c={SERVICE:"WMS",REQUEST:"GetMap"};c.FORMAT=this.imageFormat;c.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";c.STYLES="";c.VERSION=this.version;c.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;c.WIDTH=d;c.HEIGHT=b;this.maxWidth<d&&(c.WIDTH=this.maxWidth);this.maxHeight<b&&(c.HEIGHT=this.maxHeight);d=f?f:NaN;isNaN(d)||("1.3.0"==this.version?c.CRS="EPSG:"+d:c.SRS="EPSG:"+d);"1.3.0"==this.version&&this._useLatLong(d)?c.BBOX=p+","+h+","+m+","+l:c.BBOX=h+","+p+","+l+
","+m;d=this.getMapURL;var w;d+=-1==d.indexOf("?")?"?":"";for(w in c)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=w+"\x3d"+c[w];e(a.addProxy(d))}},_initLayer:function(a,c){this.spatialReference=new e(this.extent.spatialReference);this.initialExtent=new v(this.extent);this.fullExtent=new v(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=!0;this.onLoad(this);var b=this._loadCallback;b&&(delete this._loadCallback,b(this))},_readResourceInfo:function(a){a.extent?
a.layerInfos?(this.extent=a.extent,this.allExtents[0]=a.extent,this.layerInfos=a.layerInfos,this.description=a.description?a.description:"",this.copyright=a.copyright?a.copyright:"",this.title=a.title?a.title:"",this.getMapURL=a.getMapURL?a.getMapURL:this._getCapabilitiesURL,this.version=a.version?a.version:"1.3.0",this.maxWidth=a.maxWidth?a.maxWidth:5E3,this.maxHeight=a.maxHeight?a.maxHeight:5E3,this.spatialReferences=a.spatialReferences?a.spatialReferences:[],this.imageFormat=this._getImageFormat(a.format),
this.setScaleRange(a.minScale,a.maxScale),this._initLayer()):console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo"):console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo")},_getCapabilities:function(){var a=this._url.query?this._url.query:{};a.SERVICE="WMS";a.REQUEST="GetCapabilities";var d=this._url.path+"?",b;for(b in a)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=b+"\x3d"+a[b];c({url:d,handleAs:"xml",headers:{"Content-Type":null},
load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(a){if(a){this.version=this._getAttributeValue("WMS_Capabilities","version",a,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",a,"1.3.0"));var c=this._getTag("Service",a);this.title=this._getTagValue("Title",c,"");if(!this.title||0==this.title.length)this.title=this._getTagValue("Name",c,"");this.copyright=this._getTagValue("AccessConstraints",c,"");this.description=
this._getTagValue("Abstract",c,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",c,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",c,5E3),10);if(c=this._getTag("Layer",a)){var b=this._getLayerInfo(c),e=0,f=null,c=this._getTag("Capability",a);s.forEach(c.childNodes,function(a){"Layer"==a.nodeName&&(0===e?f=a:(1===e&&b.name&&(b.name="",b.subLayers=[],b.subLayers.push(this._getLayerInfo(f))),b.subLayers.push(this._getLayerInfo(a))),e++)},this);if(b){this.layerInfos=b.subLayers;if(!this.layerInfos||
0==this.layerInfos.length)this.layerInfos=[b];this.extent=b.extent;this.allExtents=b.allExtents;this.spatialReferences=b.spatialReferences;0==this.spatialReferences.length&&0<this.layerInfos.length&&(this.spatialReferences=this.layerInfos[0].spatialReferences)}this.getMapURL=this._getCapabilitiesURL;if((c=d.query("DCPType",this._getTag("GetMap",a)))&&0<c.length)if((c=d.query("HTTP",c[0]))&&0<c.length)if((c=d.query("Get",c[0]))&&0<c.length)if(c=this._getAttributeValue("OnlineResource","xlink:href",
c[0],null))c.indexOf("\x26")==c.length-1&&(c=c.substring(0,c.length-1)),this.getMapURL=c;this.getMapFormats=[];0==d.query("Operation",a).length?s.forEach(d.query("Format",this._getTag("GetMap",a)),function(a){this.getMapFormats.push(a.text?a.text:a.textContent)},this):s.forEach(d.query("Operation",a),function(a){"GetMap"==a.getAttribute("name")&&s.forEach(d.query("Format",a),function(a){this.getMapFormats.push(a.text?a.text:a.textContent)},this)},this);s.some(this.getMapFormats,function(a){return-1<
a.indexOf(this.imageFormat)},this)||(this.imageFormat=this.getMapFormats[0]);this._initLayer()}else this._getCapabilitiesError({error:{message:"Response does not contain any layers."}})}else this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)")},_getCapabilitiesError:function(a,c){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",a)},_getLayerInfo:function(a){if(!a)return null;var c=new p;c.name="";c.title="";c.description=
"";c.allExtents=[];c.spatialReferences=[];c.subLayers=[];var b=this._getTag("LatLonBoundingBox",a);b&&(c.allExtents[0]=this._getExtent(b,4326));if(b=this._getTag("EX_GeographicBoundingBox",a)){var d=new v(0,0,0,0,new e({wkid:4326}));d.xmin=parseFloat(this._getTagValue("westBoundLongitude",b,0));d.ymin=parseFloat(this._getTagValue("southBoundLatitude",b,0));d.xmax=parseFloat(this._getTagValue("eastBoundLongitude",b,0));d.ymax=parseFloat(this._getTagValue("northBoundLatitude",b,0));c.allExtents[0]=
d}c.extent=c.allExtents[0];var f=-1<s.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";s.forEach(a.childNodes,function(a){if("Name"==a.nodeName)c.name=(a.text?a.text:a.textContent)||"";else if("Title"==a.nodeName)c.title=(a.text?a.text:a.textContent)||"";else if("Abstract"==a.nodeName)c.description=(a.text?a.text:a.textContent)||"";else if("BoundingBox"==a.nodeName){var b=a.getAttribute(f);b&&0===b.indexOf("EPSG:")?(b=parseInt(b.substring(5),10),0!==b&&!isNaN(b)&&(a="1.3.0"==this.version?
this._getExtent(a,b,this._useLatLong(b)):this._getExtent(a,b),c.allExtents[b]=a,c.extent||(c.extent=a))):b&&0===b.indexOf("CRS:")?(b=parseInt(b.substring(4),10),0!==b&&!isNaN(b)&&(this._CRS_TO_EPSG[b]&&(b=this._CRS_TO_EPSG[b]),c.allExtents[b]=this._getExtent(a,b))):(b=parseInt(b,10),0!==b&&!isNaN(b)&&(c.allExtents[b]=this._getExtent(a,b)))}else if(a.nodeName==f)a=(a.text?a.text:a.textContent).split(" "),s.forEach(a,function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0!==a&&
!isNaN(a)&&(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),-1==s.indexOf(c.spatialReferences,a)&&c.spatialReferences.push(a))},this);else if("Style"==a.nodeName){if(a=this._getTag("LegendURL",a))if(a=this._getTag("OnlineResource",a))c.legendURL=a.getAttribute("xlink:href")}else"Layer"===a.nodeName&&c.subLayers.push(this._getLayerInfo(a))},this);c.title=c.title||c.name;return c},_getImageFormat:function(a){switch(a?a.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";
case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(a,c,b){var d;if(a){d=new v;var f=parseFloat(a.getAttribute("minx")),h=parseFloat(a.getAttribute("miny")),l=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));b?(d.xmin=isNaN(h)?
-1*Number.MAX_VALUE:h,d.ymin=isNaN(f)?-1*Number.MAX_VALUE:f,d.xmax=isNaN(a)?Number.MAX_VALUE:a,d.ymax=isNaN(l)?Number.MAX_VALUE:l):(d.xmin=isNaN(f)?-1*Number.MAX_VALUE:f,d.ymin=isNaN(h)?-1*Number.MAX_VALUE:h,d.xmax=isNaN(l)?Number.MAX_VALUE:l,d.ymax=isNaN(a)?Number.MAX_VALUE:a);d.spatialReference=new e({wkid:c})}return d},_useLatLong:function(a){var c,b;for(b=0;b<this._REVERSED_LAT_LONG_RANGES.length;b++){var d=this._REVERSED_LAT_LONG_RANGES[b];if(a>=d[0]&&a<=d[1]){c=!0;break}}return c},_getTag:function(a,
c){var b=d.query(a,c);return b&&0<b.length?b[0]:null},_getTagValue:function(a,c,b){return(a=d.query(a,c))&&0<a.length?a[0].text?a[0].text:a[0].textContent:b},_getAttributeValue:function(a,c,b,e){return(a=d.query(a,b))&&0<a.length?a[0].getAttribute(c):e},_checkVisibleLayersList:function(a){if(a&&(0<a.length&&this.layerInfos&&0<this.layerInfos.length)&&"number"==typeof a[0]){var c=[];s.forEach(a,function(a){a<this.layerInfos.length&&c.push(this.layerInfos[a].name)},this);a=c}return a},_stripParameters:function(c,
d){var b=a.urlToObject(c),e,f=[];for(e in b.query)-1===s.indexOf(d,e.toLowerCase())&&f.push(e+"\x3d"+b.query[e]);return b.path+(f.length?"?"+f.join("\x26"):"")}});m("extend-esri")&&h.setObject("layers.WMSLayer",n,f);return n})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(l,d,n,h){n(function(){d("highcontrast")&&l.add(h.body(),"dijit_a11y")});return d})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),
function(l,d,n,h,s,m,f,c){var a=d("dijit._TemplatedMixin",c,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var c=this.declaredClass,d=this;return f.substitute(a,this,function(a,e){"!"==e.charAt(0)&&(a=h.getObject(e.substr(1),!1,d));if("undefined"==typeof a)throw Error(c+" template:"+e);return null==a?"":"!"==e.charAt(0)?a:a.toString().replace(/"/g,"\x26quot;")},this)},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=
l(this.templatePath,{sanitize:!0}));var c=a.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),d;if(h.isString(c)){if(d=n.toDom(this._stringRepl(c),this.ownerDocument),1!=d.nodeType)throw Error("Invalid template: "+c);}else d=c.cloneNode(!0);this.domNode=d}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var c=this.containerNode;if(a&&c)for(;a.hasChildNodes();)c.appendChild(a.firstChild)}});a._templateCache=
{};a.getCachedTemplate=function(c,d,h){var l=a._templateCache,k=c,g=l[k];if(g){try{if(!g.ownerDocument||g.ownerDocument==(h||document))return g}catch(b){}n.destroy(g)}c=f.trim(c);if(d||c.match(/\$\{([^\}]+)\}/g))return l[k]=c;d=n.toDom(c,h);if(1!=d.nodeType)throw Error("Invalid template: "+c);return l[k]=d};m("ie")&&s(window,"unload",function(){var c=a._templateCache,d;for(d in c){var f=c[d];"object"==typeof f&&n.destroy(f);delete c[d]}});return a})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has esri/kernel esri/request esri/deferredUtils esri/tasks/Task esri/geometry/Extent esri/geometry/Polyline esri/geometry/Polygon esri/geometry/Multipoint esri/geometry/jsonUtils".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g){l=l(e,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],
"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=d.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=a(this,this._lengthsHandler);
this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);this._trimExtendHandler=a(this,
this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var c=[],d,e=a.length;for(d=0;d<e;d++)c.push(a[d].toJson());return{geometryType:g.getJsonType(a[0]),geometries:c}},_decodeGeometries:function(a,c,e){var f=g.getGeometryType(c);a=a.geometries;var h=[],k={spatialReference:e.toJson()},
l=d.mixin;n.forEach(a,function(a,b){h[b]=new f(l(a,k))});return h},_toProjectGeometry:function(a){var c=a.spatialReference.toJson();return a instanceof v?new p({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new u({paths:[[].concat(a.points)],spatialReference:c})},_fromProjectedGeometry:function(a,c,d){return"esriGeometryEnvelope"===c?(a=a.rings[0],new v(a[0][0],a[0][1],a[2][0],a[2][1],d)):new k({points:a.paths[0],spatialReference:d.toJson()})},
project:function(b,e,f,k){var l=d.mixin({},this._url.query,{f:"json"}),m;b.geometries?(k=f,f=e,e=b.outSR,m=b.geometries[0],l=d.mixin(l,b.toJson())):(m=b[0],l=d.mixin(l,{outSR:e.wkid||h.toJson(e.toJson()),inSR:m.spatialReference.wkid||h.toJson(m.spatialReference.toJson()),geometries:h.toJson(this._encodeGeometries(b))}));var p=g.getJsonType(m),w=this._projectHandler,n=this._errorHandler,y=new s(a._dfdCanceller);y._pendingDfd=c({url:this._url.path+"/project",content:l,callbackParamName:"callback",load:function(a,
b){w(a,b,p,e,f,k,y)},error:function(a){n(a,k,y)}});return y},_projectHandler:function(a,c,d,e,g,f,h){try{var k=this._decodeGeometries(a,d,e);this._successHandler([k],"onProjectComplete",g,h)}catch(l){this._errorHandler(l,f,h)}},onProjectComplete:function(){},simplify:function(b,e,f){var k=b[0].spatialReference,l=d.mixin({},this._url.query,{f:"json",sr:k.wkid?k.wkid:h.toJson(k.toJson()),geometries:h.toJson(this._encodeGeometries(b))}),m=g.getJsonType(b[0]),p=this._simplifyHandler,w=this._errorHandler,
n=new s(a._dfdCanceller);n._pendingDfd=c({url:this._url.path+"/simplify",content:l,callbackParamName:"callback",load:function(a,b){p(a,b,m,k,e,f,n)},error:function(a){w(a,f,n)}});return n},_simplifyHandler:function(a,c,d,e,g,f,h){try{var k=this._decodeGeometries(a,d,e);this._successHandler([k],"onSimplifyComplete",g,h)}catch(l){this._errorHandler(l,f,h)}},onSimplifyComplete:function(){},convexHull:function(b,e,g){var f=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(f.toJson()),
geometries:h.toJson(this._encodeGeometries(b))});var k=this._convexHullHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/convexHull",content:b,callbackParamName:"callback",load:function(a,b){k(a,b,f,e,g,m)},error:function(a){l(a,g,m)}});return m},_convexHullHandler:function(a,c,d,e,f,h){try{var k=g.fromJson(a.geometry).setSpatialReference(d);this._successHandler([k],"onConvexHullComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onConvexHullComplete:function(){},
union:function(b,e,g){var f=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(f.toJson()),geometries:h.toJson(this._encodeGeometries(b))});var k=this._unionHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/union",content:b,callbackParamName:"callback",load:function(a,b){k(a,b,f,e,g,m)},error:function(a){l(a,g,m)}});return m},_unionHandler:function(a,c,d,e,f,h){try{var k=g.fromJson(a.geometry).setSpatialReference(d);this._successHandler([k],
"onUnionComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onUnionComplete:function(){},autoComplete:function(b,e,g,f){var k=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(k.toJson()),polygons:h.toJson(this._encodeGeometries(b).geometries),polylines:h.toJson(this._encodeGeometries(e).geometries)});var l=this._autoCompleteHandler,m=this._errorHandler,w=new s(a._dfdCanceller);w._pendingDfd=c({url:this._url.path+"/autoComplete",content:b,callbackParamName:"callback",load:function(a,
b){l(a,b,k,g,f,w)},error:function(a){m(a,f,w)}});return w},_autoCompleteHandler:function(a,c,d,e,g,f){try{var h=a.geometries;a=[];var k,l=h.length;for(k=0;k<l;k++)a[k]=new p({spatialReference:d,rings:h[k].rings});this._successHandler([a],"onAutoCompleteComplete",e,f)}catch(y){this._errorHandler(y,g,f)}},onAutoCompleteComplete:function(){},reshape:function(b,e,f,k){var l=b.spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(l.toJson()),target:h.toJson({geometryType:g.getJsonType(b),
geometry:b.toJson()}),reshaper:h.toJson(e.toJson())});var m=this._reshapeHandler,p=this._errorHandler,w=new s(a._dfdCanceller);w._pendingDfd=c({url:this._url.path+"/reshape",content:b,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,k,w)},error:function(a){p(a,k,w)}});return w},_reshapeHandler:function(a,c,d,e,f,h){try{var k=g.fromJson(a.geometry).setSpatialReference(d);this._successHandler([k],"onReshapeComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onReshapeComplete:function(){},cut:function(b,
e,f,k){var l=b[0].spatialReference,m=n.map(b,function(a){return a.toJson()});b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(l.toJson()),target:h.toJson({geometryType:g.getJsonType(b[0]),geometries:m}),cutter:h.toJson(e.toJson())});var p=this._cutHandler,w=this._errorHandler,A=new s(a._dfdCanceller);A._pendingDfd=c({url:this._url.path+"/cut",content:b,callbackParamName:"callback",load:function(a,b){p(a,b,l,f,k,A)},error:function(a){w(a,k,A)}});return A},_cutHandler:function(a,c,d,e,f,h){try{var k=
a.geometries,l={};l.cutIndexes=a.cutIndexes;l.geometries=[];n.forEach(k,function(a){l.geometries.push(g.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onCutComplete",e,h)}catch(m){this._errorHandler(m,f,h)}},onCutComplete:function(){},intersect:function(b,e,f,k){var l=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(l.toJson()),geometries:h.toJson(this._encodeGeometries(b)),geometry:h.toJson({geometryType:g.getJsonType(e),geometry:e.toJson()})});var m=this._intersectHandler,
p=this._errorHandler,w=new s(a._dfdCanceller);w._pendingDfd=c({url:this._url.path+"/intersect",content:b,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,k,w)},error:function(a){p(a,k,w)}});return w},_intersectHandler:function(a,c,d,e,f,h){try{var k=[];n.forEach(a.geometries,function(a){k.push(g.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onIntersectComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onIntersectComplete:function(){},difference:function(b,e,f,k){var l=
b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:h.toJson(l.toJson()),geometries:h.toJson(this._encodeGeometries(b)),geometry:h.toJson({geometryType:g.getJsonType(e),geometry:e.toJson()})});var m=this._differenceHandler,p=this._errorHandler,w=new s(a._dfdCanceller);w._pendingDfd=c({url:this._url.path+"/difference",content:b,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,k,w)},error:function(a){p(a,k,w)}});return w},_differenceHandler:function(a,c,d,e,f,h){try{var k=[];n.forEach(a.geometries,
function(a){k.push(g.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onDifferenceComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onDifferenceComplete:function(){},buffer:function(b,e,g){var f=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.outSpatialReference||b.geometries[0].spatialReference,k=this._bufferHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/buffer",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,
g,m)},error:function(a){l(a,g,m)}});return m},_bufferHandler:function(a,c,d,e,g,f){try{var h=a.geometries;a=[];var k,l=h.length;for(k=0;k<l;k++)a[k]=new p({spatialReference:d,rings:h[k].rings});this._successHandler([a],"onBufferComplete",e,f)}catch(y){this._errorHandler(y,g,f)}},onBufferComplete:function(){},areasAndLengths:function(b,e,g){b=d.mixin({},this._url.query,{f:"json"},b.toJson());var f=this._areasAndLengthsHandler,k=this._errorHandler,h=new s(a._dfdCanceller);h._pendingDfd=c({url:this._url.path+
"/areasAndLengths",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,e,g,h)},error:function(a){k(a,g,h)}});return h},_areasAndLengthsHandler:function(a,c,d,e,g){try{this._successHandler([a],"onAreasAndLengthsComplete",d,g)}catch(f){this._errorHandler(f,e,g)}},onAreasAndLengthsComplete:function(){},lengths:function(b,e,g){b=d.mixin({},this._url.query,{f:"json"},b.toJson());var f=this._lengthsHandler,h=this._errorHandler,k=new s(a._dfdCanceller);k._pendingDfd=c({url:this._url.path+"/lengths",
content:b,callbackParamName:"callback",load:function(a,b){f(a,b,e,g,k)},error:function(a){h(a,g,k)}});return k},_lengthsHandler:function(a,c,d,e,g){try{this._successHandler([a],"onLengthsComplete",d,g)}catch(f){this._errorHandler(f,e,g)}},onLengthsComplete:function(){},labelPoints:function(b,e,g){var f=n.map(b,function(a){return a.toJson()}),k=b[0].spatialReference,f=d.mixin({},this._url.query,{f:"json",sr:k.wkid?k.wkid:h.toJson(k.toJson()),polygons:h.toJson(f)}),l=this._labelPointsHandler,m=this._errorHandler,
p=new s(a._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/labelPoints",content:f,callbackParamName:"callback",load:function(a,c){l(a,c,b,k,e,g,p)},error:function(a){m(a,g,p)}});return p},_labelPointsHandler:function(a,c,d,e,f,k,h){try{var l=[];n.forEach(a.labelPoints,function(a){l.push(g.fromJson(a).setSpatialReference(e))});this._successHandler([l],"onLabelPointsComplete",f,h)}catch(m){this._errorHandler(m,k,h)}},onLabelPointsComplete:function(){},relation:function(b,e,g){b=d.mixin({},this._url.query,
{f:"json"},b.toJson());var f=this._relationHandler,k=this._errorHandler,h=new s(a._dfdCanceller);h._pendingDfd=c({url:this._url.path+"/relation",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,e,g,h)},error:function(a){k(a,g,h)}});return h},_relationHandler:function(a,c,d,e,g){try{this._successHandler([a.relations],"onRelationComplete",d,g)}catch(f){this._errorHandler(f,e,g)}},onRelationComplete:function(){},trimExtend:function(b,e,g){var f=d.mixin({},this._url.query,{f:"json"},b.toJson()),
k=b.sr,h=this._trimExtendHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/trimExtend",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,k,e,g,m)},error:function(a){l(a,g,m)}});return m},_trimExtendHandler:function(a,c,d,e,g,f){try{var k=a.geometries;a=[];var h,l=k.length;for(h=0;h<l;h++)a[h]=new u({spatialReference:d,paths:k[h].paths});this._successHandler([a],"onTrimExtendComplete",e,f)}catch(m){this._errorHandler(m,g,f)}},onTrimExtendComplete:function(){},
densify:function(b,e,g){var f=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometries[0].spatialReference,k=this._densifyHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/densify",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,g,m)},error:function(a){l(a,g,m)}});return m},_densifyHandler:function(a,c,d,e,f,h){try{var k=[];n.forEach(a.geometries,function(a){k.push(g.fromJson(a).setSpatialReference(d))});this._successHandler([k],
"onDensifyComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onDensifyComplete:function(){},generalize:function(b,e,g){var f=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometries[0].spatialReference,k=this._generalizeHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/generalize",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,g,m)},error:function(a){l(a,g,m)}});return m},_generalizeHandler:function(a,c,d,e,f,h){try{var k=[];
n.forEach(a.geometries,function(a){k.push(g.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onGeneralizeComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onGeneralizeComplete:function(){},offset:function(b,e,g){var f=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometries[0].spatialReference,k=this._offsetHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/offset",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,
g,m)},error:function(a){l(a,g,m)}});return m},_offsetHandler:function(a,c,d,e,f,h){try{var k=[];n.forEach(a.geometries,function(a){k.push(g.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onOffsetComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onOffsetComplete:function(){},distance:function(b,e,g){var f=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometry1.spatialReference,k=this._distanceHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+
"/distance",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,g,m)},error:function(a){l(a,g,m)}});return m},_distanceHandler:function(a,c,d,e,g,f){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",e,f)}catch(h){this._errorHandler(h,g,f)}},onDistanceComplete:function(){}});d.mixin(l,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});m("extend-esri")&&d.setObject("tasks.GeometryService",l,f);return l})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b){function r(a){return eval("("+a+")")}function t(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<x){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=x}return b}function q(a,b){var c=a.join();if(!z[c]){for(var d=[],e=0,g=a.length;e<g;e++){var f=a[e];d[d.length]=z[f]=z[f]||n.getObject(f)||~f.indexOf("/")&&(b?b(f):l(f))}e=d.shift();z[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return z[c]}
new Date("X");var x=0;a.after(n,"extend",function(){x++},!0);var z={},B={_clearCache:function(){x++;z={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),g=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);g&&g.length&&h.forEach(g.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var e=(c.scope||d._scopeName)+"Type",g="data-"+(c.scope||d._scopeName)+"-",f=g+
"type",k=g+"mixins",l=[];h.forEach(a,function(a){var c=e in b?b[e]:a.getAttribute(f)||a.getAttribute(e);if(c){var d=a.getAttribute(k),c=d?[c].concat(d.split(/\s*,\s*/)):[c];l.push({node:a,types:c})}});return this._instantiate(l,b,c)},_instantiate:function(a,b,c,d){function g(a){!b._started&&!c.noStart&&h.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=h.map(a,function(a){var d=a.ctor||q(a.types,c.contextRequire);if(!d)throw Error("Unable to resolve constructor for: '"+
a.types.join()+"'");return this.construct(d,a.node,b,c,a.scripts,a.inherited)},this);return d?e(a).then(g):g(a)},construct:function(b,e,f,l,m,q){function s(b){B&&n.setObject(B,b);for(D=0;D<O.length;D++)a[O[D].advice||"after"](b,O[D].method,n.hitch(b,O[D].func),!0);for(D=0;D<V.length;D++)V[D].call(b);for(D=0;D<R.length;D++)b.watch(R[D].prop,R[D].func);for(D=0;D<P.length;D++)g(b,P[D].event,P[D].func);return b}var u=b&&b.prototype;l=l||{};var z={};l.defaults&&n.mixin(z,l.defaults);q&&n.mixin(z,q);var x;
p("dom-attributes-explicit")?x=e.attributes:p("dom-attributes-specified-flag")?x=h.filter(e.attributes,function(a){return a.specified}):(q=(/^input$|^img$/i.test(e.nodeName)?e:e.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),x=h.map(q.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==e.nodeName&&"value"==a||"enctype"==b?e.getAttribute(b):e.getAttributeNode(b).value}}));var M=l.scope||d._scopeName;
q="data-"+M+"-";var F={};"dojo"!==M&&(F[q+"props"]="data-dojo-props",F[q+"type"]="data-dojo-type",F[q+"mixins"]="data-dojo-mixins",F[M+"type"]="dojoType",F[q+"id"]="data-dojo-id");for(var D=0,E,M=[],B,N;E=x[D++];){var G=E.name,H=G.toLowerCase();E=E.value;switch(F[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":N=E;break;case "data-dojo-id":case "jsid":B=E;break;case "data-dojo-attach-point":case "dojoattachpoint":z.dojoAttachPoint=E;break;case "data-dojo-attach-event":case "dojoattachevent":z.dojoAttachEvent=
E;break;case "class":z["class"]=e.className;break;case "style":z.style=e.style&&e.style.cssText;break;default:if(G in u||(G=t(b)[H]||G),G in u)switch(typeof u[G]){case "string":z[G]=E;break;case "number":z[G]=E.length?Number(E):NaN;break;case "boolean":z[G]="false"!=E.toLowerCase();break;case "function":""===E||-1!=E.search(/[^\w\.]+/i)?z[G]=new Function(E):z[G]=n.getObject(E,!1)||new Function(E);M.push(G);break;default:H=u[G],z[G]=H&&"length"in H?E?E.split(/\s*,\s*/):[]:H instanceof Date?""==E?new Date(""):
"now"==E?new Date:v.fromISOString(E):H instanceof c?d.baseUrl+E:r(E)}else z[G]=E}}for(x=0;x<M.length;x++)F=M[x].toLowerCase(),e.removeAttribute(F),e[F]=null;if(N)try{N=r.call(l.propsThis,"{"+N+"}"),n.mixin(z,N)}catch(Y){throw Error(Y.toString()+" in data-dojo-props\x3d'"+N+"'");}n.mixin(z,f);m||(m=b&&(b._noScript||u._noScript)?[]:k("\x3e script[type^\x3d'dojo/']",e));var O=[],V=[],R=[],P=[];if(m)for(D=0;D<m.length;D++)F=m[D],e.removeChild(F),f=F.getAttribute(q+"event")||F.getAttribute("event"),l=
F.getAttribute(q+"prop"),N=F.getAttribute(q+"method"),M=F.getAttribute(q+"advice"),x=F.getAttribute("type"),F=this._functionFromScript(F,q),f?"dojo/connect"==x?O.push({method:f,func:F}):"dojo/on"==x?P.push({event:f,func:F}):z[f]=F:"dojo/aspect"==x?O.push({method:N,advice:M,func:F}):"dojo/watch"==x?R.push({prop:l,func:F}):V.push(F);b=(m=b.markupFactory||u.markupFactory)?m(z,e,b):new b(z,e);return b.then?b.then(s):s(b)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=
c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(r)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var e=[],g=[],f={},k=(b.scope||d._scopeName)+"Type",m="data-"+(b.scope||d._scopeName)+"-",n=m+"type",r=m+"textdir",m=m+"mixins",s=a.firstChild,t=b.inherited;if(!t){var z=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&z(a.parentNode,b)},t={dir:z(a,"dir"),lang:z(a,"lang"),textDir:z(a,r)},v;for(v in t)t[v]||
delete t[v]}for(var t={inherited:t},x,B;;)if(s)if(1!=s.nodeType)s=s.nextSibling;else if(x&&"script"==s.nodeName.toLowerCase())(G=s.getAttribute("type"))&&/^dojo\/\w/i.test(G)&&x.push(s),s=s.nextSibling;else if(B)s=s.nextSibling;else{var G=s.getAttribute(n)||s.getAttribute(k);v=s.firstChild;if(!G&&(!v||3==v.nodeType&&!v.nextSibling))s=s.nextSibling;else{B=null;if(G){var H=s.getAttribute(m);x=H?[G].concat(H.split(/\s*,\s*/)):[G];try{B=q(x,b.contextRequire)}catch(Y){}B||h.forEach(x,function(a){~a.indexOf("/")&&
!f[a]&&(f[a]=!0,g[g.length]=a)});H=B&&!B.prototype._noScript?[]:null;t={types:x,ctor:B,parent:t,node:s,scripts:H};t.inherited=c(t);e.push(t)}else t={node:s,scripts:x,parent:t};x=H;B=s.stopParser||B&&B.prototype.stopParser&&!b.template;s=v}}else{if(!t||!t.node)break;s=t.node.nextSibling;B=!1;t=t.parent;x=t.scripts}var O=new u;g.length?(p("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+g.join(", ")),(b.contextRequire||l)(g,function(){O.resolve(h.filter(e,function(a){if(!a.ctor)try{a.ctor=
q(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):O.resolve(e);return O.promise},_require:function(a,b){var c=r("{"+a.innerHTML+"}"),d=[],e=[],g=new u,f=b&&b.contextRequire||l,k;for(k in c)d.push(k),e.push(c[k]);f(e,function(){for(var a=0;a<d.length;a++)n.setObject(d[a],arguments[a]);g.resolve(arguments)});
return g.promise},_scanAmd:function(a,b){var c=new u,d=c.promise;c.resolve(!0);var e=this;k("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&n.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?m.byId(c):f.body();b=b||{};var d=b.template?{template:!0}:{},e=[],g=this,k=this._scanAmd(c,b).then(function(){return g.scan(c,b)}).then(function(a){return g._instantiate(a,
d,b,!0)}).then(function(a){return e=e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});n.mixin(e,k);return e}};d.parser=B;s.parseOnLoad&&b(100,B,"parse");return B})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(l,d,n,h,s,m,f,c,a,e,v,u,p){function k(){}
function g(a){return function(c,d,e,g){return c&&"string"==typeof d&&c[d]==k?c.on(d.substring(2).toLowerCase(),f.hitch(e,g)):a.apply(n,arguments)}}l.around(n,"connect",g);m.connect&&l.around(m,"connect",g);l=h("dijit._Widget",[v,u,p],{onClick:k,onDblClick:k,onKeyDown:k,onKeyPress:k,onKeyUp:k,onMouseDown:k,onMouseMove:k,onMouseOut:k,onMouseOver:k,onMouseLeave:k,onMouseEnter:k,onMouseUp:k,constructor:function(a){this._toConnect={};for(var c in a)this[c]===k&&(this._toConnect[c.replace(/^on/,"").toLowerCase()]=
a[c],delete a[c])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,c){return this[this._onMap(a)]===k?n.connect(this.domNode,a.toLowerCase(),this,c):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,c){m.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,c)},attr:function(a,
c){if(d.isDebug){var e=arguments.callee._ach||(arguments.callee._ach={}),g=(arguments.callee.caller||"unknown caller").toString();e[g]||(m.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+g,"","2.0"),e[g]=!0)}return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){m.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?
c("[widgetId]",this.containerNode).map(e.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});s("dijit-legacy-requires")&&a(0,function(){require(["dijit/_base"])});return l})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r){var t,q=new (d([u,f],{curNode:null,activeStack:[],constructor:function(){var a=c.hitch(this,function(a){n.isDescendant(this.curNode,a)&&this.set("curNode",null);n.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});l.before(s,"empty",a);l.before(s,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(b,c){var d=this,e=b.document&&b.document.body;if(e){var f=a(b.document,"mousedown, touchstart",function(a){d._justMouseDowned=
!0;setTimeout(function(){d._justMouseDowned=!1},0);if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),k=a(e,"focusin",function(a){t=(new Date).getTime();if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(g.isTabNavigable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),h=a(e,"focusout",function(a){(new Date).getTime()<t+100||d._onBlurNode(c||a.target)});return{remove:function(){f.remove();k.remove();h.remove();
e=f=k=h=null}}}},_onBlurNode:function(a){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(c.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0);this._justMouseDowned||(this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(c.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0))},_onTouchNode:function(a,c){this._clearActiveWidgetsTimer&&
(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var d=[];try{a&&(m.contains(a,"dijitMenuPopup")&&!a.getAttribute("dijitPopupParent"))&&(a=a.firstChild);for(;a;){var e=h.get(a,"dijitPopupParent");if(e)a=b.byId(e).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===p.body())break;a=k.get(a.ownerDocument).frameElement}else{var g=a.getAttribute&&a.getAttribute("widgetId"),f=g&&b.byId(g);f&&!("mouse"==c&&f.get("disabled"))&&d.unshift(g);a=a.parentNode}}}catch(l){}this._setStack(d,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,c){var d=this.activeStack,e=d.length-1,g=a.length-1;if(a[g]!=d[e]){this.set("activeStack",a);var f;for(f=e;0<=f&&d[f]!=a[f];f--)if(e=b.byId(d[f]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),this.emit("widget-blur",
e,c);for(f++;f<=g;f++)if(e=b.byId(a[f]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));e(function(){var b=q.registerWin(k.get(document));v("ie")&&a(window,"unload",function(){b&&(b.remove(),b=null)})});r.focus=function(a){q.focus(a)};for(var x in q)/^_/.test(x)||(r.focus[x]="function"==typeof q[x]?c.hitch(q,x):q[x]);q.watch(function(a,b,c){r.focus[a]=c});return q})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(l,d,n,h){h.extend(d,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return n("dijit._FocusMixin",null,{_focusManager:l})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang esri/geometry/Point".split(" "),function(l,d,n,h,s,m,f){var c=l(null,{declaredClass:"esri.layers.MosaicRule",
method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,constructor:function(a){d.isObject(a)&&(d.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),
a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new f(a.viewpoint)))},toJson:function(){var a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation};return m.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var d=c.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":d=
c.METHOD_ATTRIBUTE;break;case "center":d=c.METHOD_CENTER;break;case "lockraster":d=c.METHOD_LOCKRASTER;break;case "nadir":d=c.METHOD_NADIR;break;case "northwest":d=c.METHOD_NORTHWEST;break;case "seamline":d=c.METHOD_SEAMLINE;break;case "viewpoint":d=c.METHOD_VIEWPOINT}return d}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return c.OPERATION_FIRST;case "last":return c.OPERATION_LAST;case "max":return c.OPERATION_MAX;case "min":return c.OPERATION_MIN;case "blend":return c.OPERATION_BLEND;
case "mean":return c.OPERATION_MEAN}}});d.mixin(c,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});h("extend-esri")&&
d.setObject("layers.MosaicRule",c,s);return c})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has esri/kernel esri/request esri/deferredUtils esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/FeatureSet".split(" "),function(l,d,n,h,s,m,f,c,a,e,v,u){l=l(v,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],
"execute-relationship-query-complete":["featureSets"]},constructor:function(a,c){this._handler=d.hitch(this,this._handler);this._relationshipQueryHandler=d.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=d.hitch(this,this._executeForIdsHandler);this._countHandler=d.hitch(this,this._countHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},execute:function(a,e,g,b,f){var h=f.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json"},a.toJson(h&&h[0])));var l=this._handler,m=this._errorHandler;this.source&&(h={source:this.source.toJson()},a.layer=s.toJson(h));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return c({url:this._url.path+
"/query",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,e,g,f.dfd)},error:function(a){m(a,g,f.dfd)},callbackSuffix:b})},executeRelationshipQuery:function(e,f,g){e=this._encode(d.mixin({},this._url.query,{f:"json"},e.toJson()));var b=this._relationshipQueryHandler,l=this._errorHandler;this.gdbVersion&&(e.gdbVersion=this.gdbVersion);var m=new h(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/queryRelatedRecords",content:e,callbackParamName:"callback",load:function(a,c){b(a,c,
f,g,m)},error:function(a){l(a,g,m)}});return m},executeForIds:function(a,e,g,b){var f=b.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(f&&f[0])));var h=this._executeForIdsHandler,l=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=s.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){h(a,c,e,g,b.dfd)},error:function(a){l(a,g,b.dfd)}})},
executeForCount:function(a,e,g,b){var f=b.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(f&&f[0])));var h=this._countHandler,l=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=s.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){h(a,c,e,g,b.dfd)},error:function(a){l(a,g,b.dfd)}})},_handler:function(a,c,d,b,e){try{var f=
new u(a);this._successHandler([f],"onComplete",d,e)}catch(h){this._errorHandler(h,b,e)}},_relationshipQueryHandler:function(a,c,d,b,e){try{var f=a.geometryType,h=a.spatialReference,l={};n.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=f;b.spatialReference=h;b.features=a.relatedRecords;b=new u(b);l[a.objectId]=b});this._successHandler([l],"onExecuteRelationshipQueryComplete",d,e)}catch(m){this._errorHandler(m,b,e)}},_executeForIdsHandler:function(a,c,d,b,e){try{this._successHandler([a.objectIds],
"onExecuteForIdsComplete",d,e)}catch(f){this._errorHandler(f,b,e)}},_countHandler:function(a,c,d,b,e){try{var f,h=a.features,l=a.objectIds;if(l)f=l.length;else{if(h)throw Error("Unable to perform query. Please check your parameters.");f=a.count}this._successHandler([f],"onExecuteForCountComplete",d,e)}catch(m){this._errorHandler(m,b,e)}}});e._createWrappers(l);m("extend-esri")&&d.setObject("tasks.QueryTask",l,f);return l})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/has dojo/io-query esri/kernel esri/config esri/lang esri/request esri/deferredUtils esri/urlUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/layers/MosaicRule esri/layers/DynamicMapServiceLayer esri/layers/TimeInfo esri/layers/Field esri/graphic esri/tasks/ImageServiceIdentifyTask esri/tasks/ImageServiceIdentifyParameters".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r,t,q,x,z,B,w,A){l=l(q,{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this._url=k.urlToObject(a);var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this._params=
d.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this._initLayer=d.hitch(this,this._initLayer);this._queryVisibleRastersHandler=d.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=b&&b.useMapImage||!1;this.infoTemplate=b&&b.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=
b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):u({url:this._url.path,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,e=this.maxScale;d.mixin(this,a);this.minScale=c;this.maxScale=e;this.initialExtent=this.fullExtent=this.extent=
new g(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var f=this.minValues,h=this.maxValues,k=this.meanValues,l=this.stdvValues,m=this.bands=[],c=0,e=this.bandCount;c<e;c++)m[c]={min:f[c],max:h[c],mean:k[c],stddev:l[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new x(c):null;e=this.fields=[];if(f=a.fields)for(c=0;c<f.length;c++)e.push(new z(f[c]));this.version=a.currentVersion;this.version||
(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);v.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);v.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=t.METHOD_NONE;this.defaultMosaicRule=new t(c);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(d.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=d.clone(a.fields))}));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new n(p._dfdCanceller);10<this.version?(b._pendingDfd=u({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=m.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new n(p._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=u({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=m.isDebug,
b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new n;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(d.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=
a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?d.clone(this.fields):[];var e=a.length;a[e]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")&&(a[e+1]=c);this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&
(c=h.filter(this._rasterAttributeTableFields,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=h.map(c,function(a){var c=d.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},getImageUrl:function(a,b,f,g){var h=a.spatialReference.wkid||s.toJson(a.spatialReference.toJson());delete this._params._ts;var l=this._url.path+"/exportImage?";d.mixin(this._params,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:b+","+f},this.disableClientCaching?
{_ts:(new Date).getTime()}:{});var m=this._params.token=this._getToken();a=k.addProxy(l+c.objectToQuery(d.mixin(this._params,{f:"image"})));a.length>e.defaults.io.postLength||this.useMapImage?this._jsonRequest=u({url:l,content:d.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;m&&(c+=-1===c.indexOf("?")?"?token\x3d"+m:"\x26token\x3d"+m);g(k.addProxy(c))},error:this._errorHandler}):g(a)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=
a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=s.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?s.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=t.METHOD_NONE);c.where=a;c=new t(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
b}},exportMapImage:function(a,b){var c=e.defaults.map,c=d.mixin({size:c.width+","+c.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete c._ts;this._exportMapImage(this._url.path+"/exportImage",c,b)},queryVisibleRasters:function(a,c,d,e){var f=this._map,g=p._fixDfd(new n(p._dfdCanceller));this._visibleRasters=[];var h,k,l=!0;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){l=!1;for(h=0;h<this.infoTemplate.info.fieldInfos.length;h++)(k=
this.infoTemplate.info.fieldInfos[h])&&(k.visible&&"raster.servicepixelvalue"!==k.fieldName.toLowerCase())&&(l=!0)}h=new A;h.geometry=a.geometry.getCenter();h.returnGeometry=!0;h.returnCatalogItems=l;h.timeExtent=a.timeExtent;h.mosaicRule=this.mosaicRule?this.mosaicRule:null;h.renderingRule=this.renderingRule?this.renderingRule:null;f&&(a=new b((f.extent.xmax-f.extent.xmin)/(2*f.width),(f.extent.ymax-f.extent.ymin)/(2*f.height),f.extent.spatialReference),h.pixelSize=a);var m=this;a=new w(this.url);
(g._pendingDfd=a.execute(h)).addCallbacks(function(a){m._queryVisibleRastersHandler(a,c,d,e,g)},function(a){m._resolve([a],null,e,g,!0)});return g},_queryVisibleRastersHandler:function(a,b,c,e,f){var k=a.features,l=a.value,m;a.catalogItems&&(k=a.catalogItems.features,m=a.properties.Values);this._visibleRasters=[];var n;a=-1<l.toLowerCase().indexOf("nodata");l&&(!k&&!a)&&(k=[],n=new B(new g(this.fullExtent),null,{ObjectId:0}),k.push(n));var p=[];if(k){a=this.getCustomRasterFields(b);var s=this._getDomainFields(a),
r=b?b.returnDomainValues:!1,q=b&&b.rasterAttributeTableFieldPrefix,t,u,w,A,x,z,R,P;this._getRasterAttributeTableFeatures().then(d.hitch(this,function(a){for(t=0;t<k.length;t++){n=k[t];n.setInfoTemplate(this.infoTemplate);if(l&&(u=l,m&&m.length>=t&&(w=m[t],u=w.replace(/ /gi,", ")),n.attributes["Raster.ItemPixelValue"]=u,n.attributes["Raster.ServicePixelValue"]=l,a&&0<a.length&&(A=h.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==u:a.attributes.VALUE==
u}),0<A.length&&(x=d.clone(A[0]),q&&x)))){P={};for(z in x.attributes)x.attributes.hasOwnProperty(z)&&(R=q+z,P[R]=x.attributes[z]);x.attributes=P;n.attributes=d.mixin(n.attributes,x.attributes)}r&&(s&&0<s.length)&&h.forEach(s,function(a){if(a){var b=n.attributes[a.name];v.isDefined(b)&&(b=this._getDomainValue(a.domain,b),v.isDefined(b)&&(n.attributes[a.name]=b))}},this);p.push(n);this._visibleRasters.push(n)}this._resolve([p,null,!0],null,c,f)}))}else this._resolve([p,null,null],null,c,f)},getVisibleRasters:function(){var a=
this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];h.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;h.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&p._resDfd(d,a,e)}});f("extend-esri")&&d.setObject("layers.ArcGISImageServiceLayer",
l,a);return l})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore esri/kernel esri/config esri/request esri/SpatialReference esri/geometry/Point esri/geometry/jsonUtils esri/geometry/webMercatorUtils".split(" "),function(l,d,n,h,s,m,f,c,a,e,v,u,p){function k(a){var b=0,c="";d.forEach([","," ",";","|","\t"],function(d){var e=a.split(d).length;e>b&&(b=e,c=d)});return c}function g(a,b){if(!a||"[object Date]"!==Object.prototype.toString.call(a)||
isNaN(a.getTime()))return!1;var c=!0;if(h("chrome")&&/\d+\W*$/.test(b)){var d=b.match(/[a-zA-Z]{2,}/);if(d){for(var c=!1,e=0,f=d.length,g=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!c&&e<=f&&!(c=!g.test(d[e]));)e++;c=!c}}return c}function b(a,b,c){var f=a.indexOf("\n"),f=l.trim(a.substr(0,f)),n=b.columnDelimiter;n||(n=k(f));var p=new m({data:a,separator:n});a=9>h("ie")?
750:1001;p.fetch({start:0,count:a,onComplete:function(a,f){var h=0,k={layerDefinition:b.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},l=k.layerDefinition.objectIdField;!l&&!d.some(k.layerDefinition.fields,function(a){return"esriFieldTypeOID"==a.type?(l=a.name,!0):!1})&&(k.layerDefinition.fields.push({name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}),l="__OBJECTID");var m,n,r=p._attributes,q=[],t=[];d.forEach(k.layerDefinition.fields,
function(a,b){"esriFieldTypeDate"===a.type?q.push(a.name):("esriFieldTypeDouble"===a.type||"esriFieldTypeInteger"===a.type)&&t.push(a.name)});b.locationInfo&&"coordinates"===b.locationInfo.locationType?(m=b.locationInfo.latitudeFieldName,n=b.locationInfo.longitudeFieldName):d.forEach(r,function(a){var b;b=d.indexOf(x,a.toLowerCase());-1!==b&&(m=a);b=d.indexOf(z,a.toLowerCase());-1!==b&&(n=a)},this);if(!m||!n)setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},
1);else{var r=0,u=a.length;for(r;r<u;r++){if(1E3<=k.featureSet.features.length){setTimeout(function(){console.error("1000 feature limit reached. Unable to load any more data.")},1);break}var w=a[r],C=p.getAttributes(w),B={};d.forEach(C,function(a,b){if(a){var c=a;0===a.length&&d.forEach(k.layerDefinition.fields,function(b,c){b.name==="attribute_"+(c-1)&&(a="attribute_"+(c-1))});if(d.some(q,function(b){return b===a})){var c=p.getValue(w,c),e=new Date(c);B[a]=g(e,c)?e.getTime():null}else if(d.some(t,
function(b){return b===a})){e=s.parse(p.getValue(w,c));if((a==m||a==n)&&(isNaN(e)||181<Math.abs(e)))e=parseFloat(p.getValue(w,c));isNaN(e)?B[a]=null:B[a]=e}else B[a]=p.getValue(w,c)}});B[l]=h;h++;var C=B[m],L=B[n];null==L||(null==C||isNaN(C)||isNaN(L))||(C={geometry:(new v(L,C,new e({wkid:4326}))).toJson(),attributes:B},k.featureSet.features.push(C))}k.layerDefinition.name="csv";c&&c(k)}},onError:function(a){console.error("Error fetching items from CSV store: ",a)}});return!0}function r(a,b,e,f,g,
h){0===a.length&&g(null);var k=u.getGeometryType(b),m=[];d.forEach(a,function(a){a=new k(a);a.spatialReference=e;m.push(a)},this);b=[102113,102100,3857];e.wkid&&4326===e.wkid&&f.wkid&&-1<d.indexOf(b,f.wkid)?(d.forEach(m,function(a){a.xmin?(a.xmin=Math.max(a.xmin,-180),a.xmax=Math.min(a.xmax,180),a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99)):a.rings?d.forEach(a.rings,function(a){d.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},
this)},this):a.paths?d.forEach(a.paths,function(a){d.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.x&&(a.x=Math.min(Math.max(a.x,-180),180),a.y=Math.min(Math.max(a.y,-89.99),89.99))},this),a=[],d.forEach(m,function(b){b=p.geographicToWebMercator(b);102100!==f.wkid&&(b.spatialReference=f);a.push(b.toJson())},this),g(a)):null!==e.wkid&&-1<d.indexOf(b,e.wkid)&&null!==f.wkid&&4326===f.wkid?(a=[],d.forEach(m,function(b){a.push(p.webMercatorToGeographic(b).toJson())},
this),g(a)):(b=function(b,c){b&&b.length===a.length?(a=[],d.forEach(b,function(b){b&&(b.rings&&0<b.rings.length&&0<b.rings[0].length&&0<b.rings[0][0].length&&!isNaN(b.rings[0][0][0])&&!isNaN(b.rings[0][0][1])||b.paths&&0<b.paths.length&&0<b.paths[0].length&&0<b.paths[0][0].length&&!isNaN(b.paths[0][0][0])&&!isNaN(b.paths[0][0][1])||b.xmin&&!isNaN(b.xmin)&&b.ymin&&!isNaN(b.ymin)||b.x&&!isNaN(b.x)&&b.y&&!isNaN(b.y))?a.push(b.toJson()):a.push(null)},this),g(a)):h(b,c)},c.defaults.geometryService?c.defaults.geometryService.project(m,
f,l.hitch(this,b),h):g(null))}function t(a,b){var c=[102113,102100,3857];return a&&b&&a.wkid===b.wkid&&a.wkt===b.wkt||a&&b&&a.wkid&&b.wkid&&-1<d.indexOf(c,a.wkid)&&-1<d.indexOf(c,b.wkid)?!0:!1}function q(a,b,c,e){if(a.featureSet&&0!==a.featureSet.length)if(t(c,b))e(a);else{var f=function(b){var c=[];d.forEach(a.featureSet.features,function(a,d){b[d]&&(a.geometry=b[d],c.push(a))},this);e(a)},g=function(b,c){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Final try.");e(a)},
h=function(d,e){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Try one more time.");r(k,a.featureSet.geometryType,b,c,l.hitch(this,f),l.hitch(this,g))};if(a.featureSet.features&&0<a.featureSet.features.length){var k=[];d.forEach(a.featureSet.features,function(a){k.push(a.geometry)});r(k,a.featureSet.geometryType,b,c,l.hitch(this,f),l.hitch(this,h))}else e(a)}}var x="lat latitude y ycenter latitude83 latdecdeg POINT-Y".split(" "),z="lon lng long longitude x xcenter longitude83 longdecdeg POINT-X".split(" "),
B={latFieldStrings:x,longFieldStrings:z,buildCSVFeatureCollection:function(c){var d=new n,e=function(a){d.callback(a)};a({url:c.url,handleAs:"text",load:function(a){b(a,c,l.hitch(this,e))},error:function(a){console.error("error: "+a)}},{usePost:!1});return d},projectFeatureCollection:function(a,b){var c=new n;q(a,new e({wkid:4326}),b,l.hitch(this,function(a){c.callback(a)}));return c},generateDefaultPopupInfo:function(a){var b={esriFieldTypeDouble:1,esriFieldTypeSingle:1},c={esriFieldTypeInteger:1,
esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},f=null;a=d.map(a.layerDefinition.fields,l.hitch(this,function(a){"NAME"===a.name.toUpperCase()&&(f=a.name);var d="esriFieldTypeOID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeGeometry"!==a.type,g=null;if(d){var h=a.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+h+",")||-1<h.indexOf("area")||-1<h.indexOf("length")||-1<h.indexOf("shape")||-1<h.indexOf("perimeter")||
-1<h.indexOf("objectid")||h.indexOf("_")===h.length-1||h.indexOf("_i")===h.length-2&&1<h.length)d=!1;a.type in c?g={places:0,digitSeparator:!0}:a.type in b?g={places:2,digitSeparator:!0}:a.type in e&&(g={dateFormat:"shortDateShortTime"})}return l.mixin({},{fieldName:a.name,label:a.alias,isEditable:!0,tooltip:"",visible:d,format:g,stringFieldOption:"textbox"})}));return{title:f?"{"+f+"}":"",fieldInfos:a,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:k,_isValidDate:g,_processCsvData:b,
_projectGeometries:r,_sameSpatialReference:t,_projectFeatureSet:q};h("extend-esri")&&l.setObject("arcgis.csv",B,f);return B})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(l,d,n){return n("dijit.Destroyable",null,{destroy:function(d){this._destroyed=!0},own:function(){l.forEach(arguments,function(h){var l="destroyRecursive"in h?"destroyRecursive":"destroy"in h?"destroy":"remove",m=d.before(this,"destroy",function(c){h[l](c)}),f=d.after(h,l,
function(){m.remove();f.remove()},!0)},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(l,d,n,h){l=l(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(h){h&&d.isObject(h)&&(this.objectId=h.objectId,this.success=h.success,h.success||(h=h.error,this.error=Error(),this.error.code=h.code,this.error.message=h.description))}});n("extend-esri")&&d.setObject("layers.FeatureEditResult",
l,h);return l})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(l){return l.cache})},"esri/tasks/query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has esri/kernel esri/geometry/jsonUtils esri/tasks/SpatialRelationship dojo/has!extend-esri?esri/tasks/QueryTask dojo/has!extend-esri?esri/tasks/RelationshipQuery dojo/has!extend-esri?esri/tasks/StatisticDefinition".split(" "),function(l,d,n,h,s,m,f,c){var a=l(null,{declaredClass:"esri.tasks.Query",
constructor:function(){this.spatialRelationship=a.SPATIAL_REL_INTERSECTS},text:null,where:"",geometry:null,groupByFieldsForStatistics:null,objectIds:null,returnGeometry:!1,orderByFields:null,outSpatialReference:null,outFields:null,outStatistics:null,timeExtent:null,relationParam:null,pixelSize:null,toJson:function(c){var d={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};
c=c&&c.geometry||this.geometry;var l=this.objectIds,m=this.outFields,k=this.outSpatialReference,g=this.groupByFieldsForStatistics,b=this.orderByFields,s=this.outStatistics;c&&(d.geometry=c,d.geometryType=f.getJsonType(c),d.inSR=c.spatialReference.wkid||h.toJson(c.spatialReference.toJson()));l&&(d.objectIds=l.join(","));m&&(d.outFields=m.join(","));g&&(d.groupByFieldsForStatistics=g.join(","));b&&(d.orderByFields=b.join(","));if(s){var t=[];n.forEach(s,function(a,b){t.push(a.toJson())});d.outStatistics=
h.toJson(t)}null!==k?d.outSR=k.wkid||h.toJson(k.toJson()):c&&(d.outSR=c.spatialReference.wkid||h.toJson(c.spatialReference.toJson()));c=this.timeExtent;d.time=c?c.toJson().join(","):null;if((c=this.relationParam)&&this.spatialRelationship===a.SPATIAL_REL_RELATION)d.relationParam=c;d.pixelSize=this.pixelSize?h.toJson(this.pixelSize.toJson()):null;d._ts=this._ts;return d}});d.mixin(a,c);s("extend-esri")&&d.setObject("tasks.Query",a,m);return a})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/lang esri/graphic esri/SpatialReference esri/graphicsUtils esri/geometry/jsonUtils esri/symbols/jsonUtils".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v){l=l(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){d.mixin(this,a);var h=this.features,k=a.spatialReference,g=e.getGeometryType(a.geometryType),k=this.spatialReference=new c(k);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);n.forEach(h,function(a,c){var d=a.geometry&&a.geometry.spatialReference;h[c]=new f(g&&a.geometry?new g(a.geometry):null,a.symbol&&v.fromJson(a.symbol),a.attributes);h[c].geometry&&!d&&h[c].geometry.setSpatialReference(k)})}else this.features=
[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(c){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=e.getJsonType(this.features[0].geometry)),
d.features=a._encodeGraphics(this.features,c));d.exceededTransferLimit=this.exceededTransferLimit;return m.fixJson(d)}});h("extend-esri")&&d.setObject("tasks.FeatureSet",l,s);return l})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/graphic".split(" "),function(l,d,n,h,s,m){l=l(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(f){f&&d.isObject(f)&&(this.name=f.name,this.description=f.description,this.drawingTool=
f.drawingTool,f=f.prototype,this.prototype=new m(f.geometry,null,f.attributes))},toJson:function(){return s.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()})}});d.mixin(l,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",
TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});n("extend-esri")&&d.setObject("layers.FeatureTemplate",l,h);return l})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang".split(" "),
function(l,d,n,h,s,m){l=l(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(d){var c=this.bbox||this.extent;d=(c=c&&d&&c._normalize(!0))?c.spatialReference.wkid||n.toJson(c.spatialReference.toJson()):null;var a=this.imageSpatialReference,c={bbox:c?c.xmin+","+c.ymin+","+c.xmax+","+c.ymax:
null,bboxSR:d,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:a?a.wkid||n.toJson(a.toJson()):d,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?n.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation};d=this.timeExtent;
c.time=d?d.toJson().join(","):null;return m.filter(c,function(a){if(null!==a&&void 0!==a)return!0})}});d.mixin(l,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});h("extend-esri")&&d.setObject("layers.ImageServiceParameters",l,s);return l})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(l){var d={};l.setObject("dojo.data.util.filter",d);d.patternToRegExp=function(d,h){for(var l="^",m=null,f=0;f<d.length;f++)switch(m=d.charAt(f),m){case "\\":l+=m;f++;l+=d.charAt(f);break;case "*":l+=".*";break;case "?":l+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":l+="\\";default:l+=m}l+="$";return h?RegExp(l,"mi"):RegExp(l,"m")};return d})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct esri/kernel esri/InfoTemplate esri/PopupInfo esri/dijit/PopupRenderer".split(" "),
function(l,d,n,h,s,m,f,c){l=l([m,f],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(a,c){d.mixin(this,c);this.initialize(a,c)},getTitle:function(a){return this.info?this.getComponents(a).title:""},getContent:function(a){return this.info?(new c({template:this,graphic:a,chartTheme:this.chartTheme},h.create("div"))).domNode:""}});n("extend-esri")&&d.setObject("dijit.PopupTemplate",l,s);return l})},"*noref":1}});
define("esri/arcgis/utils","dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/has dojo/DeferredList dojo/dom-construct esri/kernel esri/config esri/lang esri/request esri/SpatialReference esri/map esri/urlUtils esri/geometry/ScreenPoint esri/geometry/Extent esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/renderers/jsonUtils esri/dijit/PopupTemplate esri/dijit/Popup esri/tasks/query esri/tasks/GeometryService esri/arcgis/csv esri/layers/ArcGISTiledMapServiceLayer esri/layers/ArcGISDynamicMapServiceLayer esri/layers/ArcGISImageServiceLayer esri/layers/OpenStreetMapLayer esri/layers/WebTiledLayer esri/layers/FeatureLayer esri/layers/WMSLayer esri/layers/KMLLayer esri/layers/GeoRSSLayer esri/virtualearth/VETiledLayer esri/layers/TileInfo esri/layers/DynamicLayerInfo esri/layers/LayerDrawingOptions esri/layers/ImageParameters esri/layers/ImageServiceParameters esri/layers/RasterFunction esri/layers/MosaicRule esri/layers/WMSLayerInfo dojo/i18n!esri/nls/jsapi".split(" "),
function(l,d,n,h,s,m,f,c,a,e,v,u,p,k,g,b,r,t,q,x,z,B,w,A,y,C,L,I,J,U,ea,Q,M,F,D,E,X,N,G,H,Y,O,V,R,P){function W(a){return p({url:K.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function na(a){var c={f:"json"};if(e.id){var d=e.id.findCredential(b.urlToObject(K.arcgisUrl).path);d&&(c.token=d.token)}return p({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function oa(a){a.itemProperties.layerDefinition&&
(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),u.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),u.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),u.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):
a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo)}function Z(a,b){var e=new h,f=a.itemData,g=[],k=[];d.forEach(f.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")?(k.push(a),g.push(W(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!u.isDefined(a.minScale)&&!u.isDefined(a.maxScale))?(k.push(a),g.push(W(a))):-1<
b.indexOf("/imageserver")&&(!u.isDefined(a.minScale)&&!u.isDefined(a.maxScale))&&(k.push(a),g.push(W(a)))}});f.baseMap&&f.baseMap.baseMapLayers&&d.forEach(f.baseMap.baseMapLayers,function(a){("BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type)&&a.portalUrl?(k.push(a),g.push(na(a.portalUrl))):a.itemId&&(k.push(a),g.push(W(a)))});0<g.length?(new c(g)).addCallback(function(c){d.forEach(k,function(a,e){if(("BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===
a.type)&&a.portalUrl)c[e][1].bingKey?b.bingMapsKey=c[e][1].bingKey:(a.errors=a.errors||[],a.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+a.type+"]"}));else{var f=c[e][1];if(f){var g=a.url.toLowerCase();-1<g.indexOf("/featureserver")&&f.layers?d.forEach(f.layers,function(b){g.endsWith("/featureserver/"+b.id)&&(a.itemProperties=b,oa(a))}):-1<g.indexOf("/mapserver")?(f.layers&&!a.layers&&(a.layers=f.layers),u.isDefined(f.minScale)&&!u.isDefined(a.minScale)&&
(a.minScale=f.minScale),u.isDefined(f.maxScale)&&!u.isDefined(a.maxScale)&&(a.maxScale=f.maxScale),u.isDefined(f.refreshInterval)&&!u.isDefined(a.refreshInterval)&&(a.refreshInterval=f.refreshInterval)):-1<g.indexOf("/imageserver")&&(u.isDefined(f.minScale)&&!u.isDefined(a.minScale)&&(a.minScale=f.minScale),u.isDefined(f.maxScale)&&!u.isDefined(a.maxScale)&&(a.maxScale=f.maxScale),u.isDefined(f.refreshInterval)&&!u.isDefined(a.refreshInterval)&&(a.refreshInterval=f.refreshInterval),f.popupInfo&&(!a.popupInfo&&
!a.disablePopup)&&(a.popupInfo=f.popupInfo),f.renderingRule&&!a.renderingRule&&(a.renderingRule=f.renderingRule,f.renderingRule.functionName&&(a.renderingRule.rasterFunction=f.renderingRule.functionName)),f.bandIds&&!a.bandIds&&(a.bandIds=f.bandIds),f.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=f.mosaicRule),f.format&&!a.format&&(a.format=f.format),u.isDefined(f.compressionQuality)&&!u.isDefined(a.compressionQuality)&&(a.compressionQuality=f.compressionQuality))}}});e.callback(a)}):e.callback(a);return e}
function fa(a,b){var c=a.dynamicLayerInfos||a.layerInfos,e=b.layers;if(e&&c){var f=[],g=[],h=[],k=[],l=[],m=[];d.forEach(c,function(b){var c=b.id;if(!b.subLayerIds&&-1!==d.indexOf(a.visibleLayers,c))for(b=0;b<e.length;b++){var n=e[b];if(n.id===c){g.push(c);f.push(n.popupInfo);h.push(n.layerUrl||"");n.layerDefinition&&n.layerDefinition.definitionExpression?k.push(n.layerDefinition.definitionExpression):k.push("");l.push(esri.isDefined(n.minScale)?n.minScale:0);m.push(esri.isDefined(n.maxScale)?n.maxScale:
0);break}}});f.length&&(a.__popups=f,a.__popupIds=g,a.__popupUrls=h,a.__popupWhereClauses=k,a.__popupMinScales=l,a.__popupMaxScales=m,a.__resourceInfo=b.resourceInfo)}}function pa(a){if(!a)return!1;var b=(new m(K.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function qa(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function S(a){if("https:"===location.protocol&&(pa(a)||qa(a)))a=a.replace("http:","https:");
return a}function ga(a){var b=[];a.displayLevels||(b=d.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));b=new L(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||b,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});fa(b,a);return b}function ha(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||
-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function ra(a){var b=new H;b.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&(b.format="png32");var b=new I(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:b,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),
c=a.visibleLayers;if(!a.visibleLayers){var e="";d.forEach(b.layerInfos,function(a){a.defaultVisibility&&(e+=(0<e.length?",":"")+a.id)});c=e}if(a.layers&&0<a.layers.length){var f=[],g=[],h,k=[],m;d.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(f[b.id]=b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){h=new N(l.mixin(b,b.layerDefinition));delete h.layerDefinition;h.id=b.id;if(a.visibleLayers){var c="string"==typeof a.visibleLayers?
a.visibleLayers.split(","):a.visibleLayers;-1<d.indexOf(c,b.id)?h.defaultVisibility=!0:h.defaultVisibility=!1}g.push(h)}b.layerDefinition&&(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(m=new G(b.layerDefinition.drawingInfo),k[b.id]=m)},this);0<f.length&&b.setLayerDefinitions(f);0<g.length?(b.setDynamicLayerInfos(g,!0),0<k.length&&b.setLayerDrawingOptions(k,!0)):(c=ha(b.layerInfos,c),b.setVisibleLayers(c))}else c=ha(b.layerInfos,c),b.setVisibleLayers(c);fa(b,a);return b}function Ba(a,
b){var c=new Y;c.bandIds=a.bandIds;null!=a.format&&(c.format=a.format,null!=a.compressionQuality&&(c.compressionQuality=a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var d=new O(a.renderingRule);c.renderingRule=d}a.mosaicRule&&(d=new V(a.mosaicRule),c.mosaicRule=d);u.isDefined(a.noData)&&(c.noData=a.noData);u.isDefined(a.noDataInterpretation)&&(c.noDataInterpretation=a.noDataInterpretation);u.isDefined(a.interpolation)&&(c.interpolation=a.interpolation);c=new J(S(a.url),
{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:c,infoTemplate:a.popupInfo&&new b(a.popupInfo),minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});a.layerDefinition&&a.layerDefinition.definitionExpression&&c.setDefinitionExpression(a.layerDefinition.definitionExpression,!0);return c}function ia(a,b,c){var e=[102113,102100,3857],f=c||new k(b[0].layerObject.fullExtent.spatialReference),g=new k(a.resourceInfo.fullExtent.spatialReference);
return f.wkt==g.wkt&&(f.wkid==g.wkid||esri.isDefined(f.latestWkid)&&f.latestWkid==g.wkid||esri.isDefined(g.latestWkid)&&f.wkid==g.latestWkid||esri.isDefined(f.latestWkid)&&f.latestWkid==g.latestWkid)||f.wkid&&g.wkid&&d.some(e,function(a){return a===g.wkid})&&d.some(e,function(a){return a===f.wkid})?!0:!1}function ja(a,b){if(!b[0].layerObject.tileInfo)return!1;var c=[];d.forEach(b,function(a){a.baseMapLayer&&a.layerObject.tileInfo&&(c=c.concat(d.map(a.layerObject.tileInfo.lods,function(a){return a.scale})))});
return d.some(a.resourceInfo.tileInfo.lods,function(a){return d.some(c,function(b){return b===a.scale})})}function ka(a,c,f,g,h){var m,p=f._clazz;if("OpenStreetMap"===a.type)m=new U({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var r=[],q=[];d.forEach(a.layers,function(a){q.push(new R({name:a.name,title:a.title,legendURL:a.legendURL}));r.push(a.name)},this);a.visibleLayers&&(r=a.visibleLayers);g={extent:new t(a.extent[0][0],
a.extent[0][1],a.extent[1][0],a.extent[1][1],new k({wkid:4326})),layerInfos:q,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright};m=new M(a.url,{id:a.id,visibleLayers:r,format:"png",transparent:a.baseMapLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:!0,resourceInfo:g,refreshInterval:a.refreshInterval});m.spatialReference.wkid=g.spatialReferences[0]}else if("KML"===a.type){f=
a.url;if(e.id&&(p=e.id.findCredential(b.urlToObject(K.arcgisUrl).path))){c=K.arcgisUrl.substring(K.arcgisUrl.indexOf("//")+2,K.arcgisUrl.indexOf("/",K.arcgisUrl.indexOf("//")+3));h=c.split(".");h=h[h.length-2]+"."+h[h.length-1];var v=f.indexOf(h);-1<v&&(f="https://"+c+f.substring(v+h.length));f+="?token\x3d"+p.token}m=new F(f,{id:a.id,visible:null!==a.visibility?a.visibility:!0,outSR:g,refreshInterval:a.refreshInterval});n.connect(m,"onLoad",function(){var b=function(c){d.forEach(c,function(c){"esri.layers.FeatureLayer"===
c.declaredClass||"esri.layers.MapImageLayer"===c.declaredClass?c.setOpacity(a.opacity):"esri.layers.KMLLayer"===c.declaredClass&&(c.loaded?b(c.getLayers()):n.connect(c,"onLoad",l.hitch(this,function(a){b(a.getLayers())})))})};(a.opacity||0===a.opacity)&&b(m.getLayers());a.visibleFolders&&d.forEach(m.folders,function(b){-1<d.indexOf(a.visibleFolders,b.id)?m.setFolderVisibility(b,!0):m.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(m=new ea(a.templateUrl,{id:a.id,visible:null!==a.visibility?
a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new t(a.fullExtent),initialExtent:a.fullExtent&&new t(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new X(a.tileInfo):null,refreshInterval:a.refreshInterval}),n.connect(m,"onLoad",function(){(u.isDefined(a.minScale)||u.isDefined(a.maxScale))&&m.setScaleRange(a.minScale,a.maxScale)})):"GeoRSS"===a.type?(m=new D(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:g,refreshInterval:a.refreshInterval}),n.connect(m,
"onLoad",function(){!1===a.visibility&&m.hide();var b=m.getFeatureLayers();d.forEach(b,function(b){a.pointSymbol&&"esriGeometryPoint"===b.geometryType?b.renderer.symbol=x.fromJson(a.pointSymbol):a.lineSymbol&&"esriGeometryPolyline"===b.geometryType?b.renderer.symbol=x.fromJson(a.lineSymbol):a.polygonSymbol&&"esriGeometryPolygon"===b.geometryType&&(b.renderer.symbol=x.fromJson(a.polygonSymbol));(u.isDefined(a.minScale)||u.isDefined(a.maxScale))&&b.setScaleRange(a.minScale,a.maxScale)})})):"CSV"==a.type&&
a.url?m=new Q(a.featureCollection,{infoTemplate:new B(a.popupInfo?a.popupInfo:C.generateDefaultPopupInfo(a.featureCollection)),id:a.id?a.id:null,outFields:["*"],visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,autoGeneralize:!0}):a.layerDefinition&&!a.url?(g=s.fromJson(s.toJson(a)),delete g.id,delete g.opacity,delete g.visibility,m=new Q(g,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],infoTemplate:g.popupInfo&&new p(g.popupInfo),autoGeneralize:!0})):"BingMapsAerial"===
a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?f.bingMapsKey?(g=E.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?g=E.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(g=E.MAP_STYLE_ROAD),m=new E({bingMapsKey:f.bingMapsKey,mapStyle:g,opacity:a.opacity,id:a.id})):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?m=!0===a.resourceInfo.singleFusedMapCache&&
(a.baseMapLayer||ia(a,c,g)&&ja(a,h))?ga(a):ra(a):a.resourceInfo&&a.resourceInfo.pixelSizeX?m=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ia(a,c,g)&&ja(a,h))?ga(a):Ba(a,p):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type&&(m=new Q(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:u.isDefined(a.mode)?a.mode:Q.MODE_ONDEMAND,outFields:["*"],infoTemplate:a.popupInfo&&new p(a.popupInfo),autoGeneralize:!0,refreshInterval:a.refreshInterval}),a.layerDefinition&&
(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(g=z.fromJson(a.layerDefinition.drawingInfo.renderer),g.isMaxInclusive=!0,m.setRenderer(g)),a.layerDefinition.definitionExpression&&m.setDefinitionExpression(a.layerDefinition.definitionExpression),u.isDefined(a.layerDefinition.minScale)&&m.setMinScale(a.layerDefinition.minScale),u.isDefined(a.layerDefinition.maxScale)&&m.setMaxScale(a.layerDefinition.maxScale)));m&&(m.arcgisProps={title:a.title},a.baseMapLayer&&(m._basemapGalleryLayerType=
a.isReference?"reference":"basemap"));return m}function $(a,b,c,e){d.forEach(a,function(d,f){if(d.url&&!d.type){if(0===f||a[0].layerObject)d.layerObject=ka(d,a,b,c,e)}else d.layerObject=ka(d,a,b,c,e)});var f=d.filter(a,function(a){return!a.isReference}),g=d.filter(a,function(a){return!!a.isReference});return a=f.concat(g)}function la(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new k,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&
(b.wkt=a.resourceInfo.spatialReference.wkt)):-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new k({wkid:102100}):"WMS"==a.type&&(b=new k({wkid:a.spatialReferences[0]}));return b}function sa(a,b,e,f,g,h,k){d.forEach(b,function(b,c){b.url&&!b.type?(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos):b.url&&"CSV"==b.type&&(b.featureCollection=f[b.deferredsPos].results[0],delete b.deferredsPos)});h=h||la(b);var l=[];d.forEach(b,function(a){a.url&&"CSV"==a.type&&(a.deferredsPos=l.length,
l.push(C.projectFeatureCollection(a.featureCollection,h)))});0==l.length?(b=$(b,e,h,k),g.callback(b)):(new c(l)).addCallback(function(){d.forEach(b,function(a){a.url&&"CSV"==a.type&&(a.featureCollection=l[a.deferredsPos].results[0],delete a.deferredsPos)});b=$(b,e,h,k);g.callback(b)})}function ta(a,b){var c=S(a);return p({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);v.defaults.io.errorHandler(a,d)}})}
function aa(a,b,e,f){var g=[],k=[],l=[],m=new h;d.forEach(a.operationalLayers,function(a,b){a.featureCollection?d.forEach(a.featureCollection.layers,function(c,e){var f=!0;a.visibleLayers&&-1==d.indexOf(a.visibleLayers,e)&&(f=!1);c.visibility=a.visibility&&f;c.opacity=a.opacity;c.id=(a.id||"operational"+b)+"_"+e;l.push(c)},this):l.push(a)});d.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;g.push(a)});d.forEach(l,function(a,b){a.id=a.id||"operational"+b;g.push(a)});
d.forEach(g,function(a){a.url&&!a.type?(a.deferredsPos=k.length,a.errors=[],k.push(ta(a.url,a.errors))):a.url&&"CSV"==a.type&&(a.deferredsPos=k.length,k.push(C.buildCSVFeatureCollection(a)))});0==k.length?(e=e||la(g),g=$(g,b,e,f),m.callback(g)):(new c(k)).addCallback(function(a){sa(a,g,b,k,m,e,f)});return m}function ma(a,b){if(10.1>=b.version&&a){var c,d=parseInt(b.url.substring(b.url.lastIndexOf("/")+1,b.url.length));for(c=a.length-1;0<=c;c--)if(a[c].id==d)if(0==b.minScale&&0<a[c].minScale?b.minScale=
a[c].minScale:0<b.minScale&&0==a[c].minScale?b.minScale=b.minScale:0<b.minScale&&0<a[c].minScale&&(b.minScale=Math.min(b.minScale,a[c].minScale)),b.maxScale=Math.max(b.maxScale||0,a[c].maxScale||0),-1<a[c].parentLayerId)d=a[c].parentLayerId;else break}}function ba(a,b,c,e){var f=a.url,g=a.__popupIds,h=a.__popupUrls,k=a.__popupWhereClauses,m=a.__popupMinScales,p=a.__popupMaxScales,r=a.__resourceInfo,s=[];d.forEach(a.__popups,function(e,l){if(e){var q,t=[];d.forEach(e.fieldInfos,function(a){"shape"!==
a.fieldName.toLowerCase()&&t.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var u=d.filter(a.dynamicLayerInfos,function(a){return g[l]==a.id})[0].source;q=new Q(f+"/dynamicLayer",{id:a.id+"_"+g[l],source:u,outFields:t,mode:Q.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,autoGeneralize:!0});q.loaded?(0<k[l].length&&q.setDefinitionExpression(k[l]),esri.isDefined(m[l])&&esri.isDefined(p[l])&&q.setScaleRange(m[l],p[l])):n.connect(q,"onLoad",function(a){0<
k[l].length&&q.setDefinitionExpression(k[l]);esri.isDefined(m[l])&&esri.isDefined(p[l])&&q.setScaleRange(m[l],p[l])})}else{var v,u=null;if(b)for(v=0;v<b.length;v++)if(b[v].id===g[l]){u=b[v];break}v=f+"/"+g[l];h[l].length&&(v=h[l]);q=new Q(S(v),{id:a.id+"_"+g[l],outFields:t,mode:Q.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,resourceInfo:u,autoGeneralize:!0});q.loaded?(q.setScaleRange(a.minScale,a.maxScale),0<k[l].length&&q.setDefinitionExpression(k[l])):n.connect(q,"onLoad",
function(b){b.setScaleRange(a.minScale,a.maxScale);0<k[l].length&&q.setDefinitionExpression(k[l])});q.loaded?ma(r.layers,q):n.connect(q,"onLoad",function(a){ma(r.layers,a)})}s.push(q)}});0<s.length&&(n.connect(a,"onVisibilityChange",l.hitch(this,function(a,b){d.forEach(a,function(a){b?a.show():a.hide()})},s)),n.connect(e,"onLayerRemove",l.hitch(this,function(a,b,c){a.id===c.id&&d.forEach(b,function(a){e.removeLayer(a)})},a,s)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;
delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return s}function ua(a){return p({url:S(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function va(a,b,e){var f=[];d.forEach(a,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=f.length,f.push(ua(a)))});var g=[];0<f.length?(new c(f)).addCallback(function(c){d.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(g=
g.concat(ba(a,c[a.__deferredsPos][1].layers,e,b)),delete a.__deferredsPos):g=g.concat(ba(a,null,e,b)))});b.addLayers(g)}):(d.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(g=g.concat(ba(a,null,e,b)))}),b.addLayers(g))}function wa(a){d.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&-1<b.name.indexOf("Text")&&d.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=
a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function xa(a){var b=6;d.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&d.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));
a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function ca(a){var b=this,c=b.infoWindow,e=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var f=[];d.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("FeatureLayer")&&a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&f.push(a)});d.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&
f.push(a)});e=e&&e.getInfoTemplate()?e:null;if(f.length||e){var g=xa(f),k=a.screenPoint,l=b.toMap(new r(k.x-g,k.y+g)),g=b.toMap(new r(k.x+g,k.y-g)),l=new t(l.x,l.y,g.x,g.y,b.spatialReference),m=new A;m.geometry=l;m.timeExtent=b.timeExtent;var n=!0,l=d.map(f,function(a){var b;-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?(n=!1,b=a.queryVisibleRasters(m,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),b.addCallback(function(){return a.getVisibleRasters()})):(b=a.selectFeatures(m),
b.addCallback(function(){return a.getSelectedFeatures()}));return b});e&&(g=new h,g.callback([e]),l.splice(0,0,g));if(!d.some(l,function(a){return-1===a.fired})){var p=e?1:0;d.forEach(f,function(a){p=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?p+a.getVisibleRasters().length:p+a.getSelectedFeatures().length});if(!p)return}c.setFeatures(l);c.show(a.mapPoint,{closestFirst:n})}}}function Ca(b,c){var d=c.mapOptions||{},e;d.infoWindow||(e=new w(null,a.create("div")),d.infoWindow=e);u.isDefined(d.showInfoWindowOnClick)||
(d.showInfoWindowOnClick=!1);d=new g(b,d);n.connect(d,"onLayersAddResult",wa);return d}function T(a,b,c,e,f,g){var h,k,l;e.map?(h=e.map,k=e.clickEventHandle,l=e.errors):(h=Ca(e,f),!f.ignorePopups&&!f.disableClickBehavior&&(k=n.connect(h,"onClick",ca)));f.ignorePopups&&d.forEach(a,function(a){delete a.infoTemplate});h.addLayers(a);f.ignorePopups||va(a,h,f._clazz);var m=l||[];d.forEach(b,function(a){m=m.concat(a.errors)},this);h.loaded?g.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:ca}):
n.connect(h,"onLoad",function(){g.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:ca})})}function da(a,b,c,e,f){try{var g=c.mapOptions||{};c.mapOptions=g;var h=a.item,m=[];d.forEach(f,function(a){l.isArray(a.layerObject)?d.forEach(a.layerObject,function(a){m.push(a)}):m.push(a.layerObject)});if(m[0])if(m=d.filter(m,u.isDefined),h)if(h.extent&&h.extent.length)if(g.extent)T(m,f,a,b,c,e);else{var n=new t(h.extent[0][0],h.extent[0][1],h.extent[1][0],h.extent[1][1],new k({wkid:4326})),
p=m[0].spatialReference;4326===p.wkid?(g.extent=n,T(m,f,a,b,c,e)):102100===p.wkid||102113===p.wkid||3857===p.wkid?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,89.99),g.extent=q.geographicToWebMercator(n),T(m,f,a,b,c,e)):c.geometryServiceURL||v.defaults.geometryService?(c.geometryServiceURL?new y(c.geometryServiceURL):v.defaults.geometryService).project([n],p,function(d){d=d[0];g.extent=g.extent||d;T(m,f,a,b,c,e)}):e.errback(Error(P.arcgis.utils.geometryServiceError))}else T(m,
f,a,b,c,e);else T(m,f,a,b,c,e);else h="",f[0].errors&&f[0].errors.length&&(h=" ("+f[0].errors[0].message+")"),e.errback(Error(P.arcgis.utils.baseLayerError+h))}catch(r){e.errback(r)}}function ya(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);d.forEach(a,function(a,c){var e={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&d.forEach(a.featureCollection.layers,function(c){!1!==c.showLegend&&(e={layer:c.layerObject,title:a.title,defaultSymbol:c.renderer&&
c.renderer.defaultSymbol&&c.renderer.defaultLabel?!0:!1},1<a.featureCollection.layers.length&&(e.title+=" - "+c.layerDefinition.name),b.push(e))});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject){var f=a.layerObject.renderer,f=!f||f&&f.defaultSymbol&&f.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&(a.layerObject instanceof I||a.layerObject instanceof L)||a.layerObject instanceof esri.layers.ArcGISImageServiceLayer)f=!0;e={layer:a.layerObject,
title:a.title,defaultSymbol:f};a.layers&&(f=d.map(d.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),f.length&&(e.hideLayers=f));b.push(e)}});return b}function za(a,b,c,e){if(!e.itemData.operationalLayers||0===e.itemData.operationalLayers.length)Z(e,b).addCallback(function(d){aa(d.itemData,b).addCallback(l.hitch(null,da,d,a,b,c))});else{var f=new h,g=e.itemData.baseMap.baseMapLayers.slice(0),k=d.filter(e.itemData.baseMap.baseMapLayers,function(a){return!a.isReference}),
m={item:e.item,itemData:{baseMap:{baseMapLayers:k}}};e.itemData.baseMap.baseMapLayers=d.filter(e.itemData.baseMap.baseMapLayers,function(a){return a.isReference});Z(m,b).addCallback(function(c){aa(c.itemData,b).addCallback(l.hitch(null,da,c,a,b,f))});f.then(function(a){Z(e,b).addCallback(function(d){aa(d.itemData,b,a.map.spatialReference,k).addCallback(function(e){d.itemData.baseMap.baseMapLayers=g;da(d,a,b,c,e)})})},l.hitch(c,c.errback))}}function Aa(a){K._arcgisUrl&&0<K._arcgisUrl.length&&(K.arcgisUrl=
K._arcgisUrl);var b=K.arcgisUrl+"/"+a,c={},d=new h;p({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a){c.item=a;p({url:b+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){c.itemData=a;d.callback(c)},error:function(a){d.errback(a)}})},error:function(a){d.errback(a)}});return d}String.prototype.endsWith=function(a){return this.match(a+"$")==a};var K;K={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:Aa,createMap:function(a,
b,c){var d=new h;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(l.isObject(e)?e:l.getObject(e))||B;l.isString(a)?Aa(a).addCallback(l.hitch(null,za,b,c,d)).addErrback(l.hitch(d,d.errback)):za(b,c,d,a);return d},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?ya(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:Z,_getItemData:W,_getBingKey:na,_processFSItemProperties:oa,_getLayers:aa,_preBuildLayerObjects:sa,_buildLayerObjects:$,_preCreateMap:da,_getMapSR:la,_createMap:T,
_addSelectionLayers:va,_createSelectionFeatureLayers:ba,_getServiceInfo:ta,_getLayersInfo:ua,_initLayer:ka,_loadAsCached:ga,_loadAsDynamic:ra,_processPopups:fa,_onLayersAddResult:wa,_sameSpatialReferenceAsBasemap:ia,_sameTilingSchemeAsBasemap:ja,_showPopup:ca,_calculateClickTolerance:xa,_getVisibleFeatureLayers:ha,_updateLayerScaleInfo:ma,_checkUrl:S,_isHostedService:pa,_isAgolService:qa,_getLegendLayers:ya};l.setObject("arcgis.utils",K,e);return K});